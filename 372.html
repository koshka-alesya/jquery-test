<!-- Load and read SSO data '[SSOData.Locale]' -->
<script>
  let PO_CompleteDeliveryLogicCheck = false;
  let QODCheck = false;
  function elog(r) {
	errorLog = {
	  app: config.dataset,
	  sso: global.data,
	  xrf: reference.xref
	};
	if (typeof(r) !== "undefined" && r != null)
	  errorLog.r = r;
	crud.create("3592", {
	  LOG: JSON.stringify(errorLog)
	}, function(d) {
	  console.info("Error log created successfully");
	})
  } // create error log
  const assigntoteamValues = [
	{
	  teamName: "Aruba AAS",
	  region: "WW",
	  PO_BackgroundGroup: "Edge"
	},
	{
	  teamName: "Aruba-HPEN Request Only",
	  region: "AMS",
	  PO_BackgroundGroup: "Edge"
	},
	{
	  teamName: "OTC WW ComputeStorage EAAS",
	  region: "WW",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC EMEA Aruba Orders",
	  region: "EMEA",
	  PO_BackgroundGroup: "Edge"
	},
	{
	  teamName: "OTC EMEA Order Processing",
	  region: "EMEA",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC APJ OP India",
	  region: "APJ, India",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC AMS OP Brazil",
	  region: "AMS, Latin America, North America, Brazil",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC AMS OP MEX/MCA",
	  region: "AMS, Latin America, North America",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC APJ OP HK & TW",
	  region: "APJ, Hong Kong, Taiwan",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC APJ OP South PAC",
	  region: "APJ, Australia, New Zealand",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC APJ OP Korea",
	  region: "APJ, Korea",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC APJ OP SEA",
	  region: "APJ",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "OTC APJ OP Japan",
	  region: "APJ, Japan",
	  PO_BackgroundGroup: "Hybrid IT"
	},
	{
	  teamName: "None",
	  region: "APJ",
	  PO_BackgroundGroup: "Edge"
	}
  ];
  let global = {
	ready: false,
	data: {
	  brt: {
		code: null,
		name: null,
		channel: null,
		pas: null
	  },
	  company: {
		party: null,
		country: null,
		global: null,
		brt: null,
		PreferredBusinessRelationship: null,
		name: null
	  },
	  geo: {
		//name: "India", //CFI
		//code: "IN" //CFI
		name: null,
		code: null
	  },
	  user: {
		email: null,
		fname: null,
		lname: null,
		hpp: "[SSOData.HPPUserId]",
		locale: "en_US",
		language: null,
		planguage: null
	  },
	  brts: [
		{
		  code: "RS1",
		  name: "T1 Solution Provider",
		  channel: ["ICMChannelT1"]
		},
		{
		  code: "DT1",
		  name: "Distributor",
		  channel: ["ICMChannelT1", "ICMChannelDistributor"] //ICMChannelDistributor
		},
		{
		  code: "ODP",
		  name: "OEM Distributor",
		  channel: ["ICMOEM"]
		},
		{
		  code: "SI1",
		  name: "System Integrator",
		  channel: ["ICMChannelGeneral"]
		},
		{
		  code: "MAP",
		  name: "Master Area Partner",
		  channel: ["ICMChannelT1"]
		}
	  ]
	},
	init: function(cb) {
	  let self = this;

	  global.data.user.internal = false;
	  if("[SSOData.Email]".indexOf('@hpe.com') > -1)
		global.data.user.internal = true;

	  if(!global.data.user.internal) {
		this.sso();
		this.sor(function() {
		  self.ready = true;
		  // set channel data; required for iCertis;
		  for(let i=0;i<global.data.brts.length;i++)
			if(self.data.brt.code.toLowerCase() == self.data.brts[i].code.toLowerCase())
			  self.data.brt.channel = self.data.brts[i].channel;
		  // execute callback when all said and done
		  if(typeof(cb) === 'function')
			cb(self);
		});
	  }
	},
	sso: function() {
	  global.data.brt.code = JSON.parse(`[SSOData.PreferredBusinessRelationship]`).businessRelationshipTypeCode;
	  global.data.brt.name = JSON.parse(`[SSOData.PreferredBusinessRelationship]`).businessRelationshipTypeName;
	  //global.data.brt.channel = [];
	  // SETTING THE CHANNEL IS IMPORTANT
	  // IT NEEDS TO BE AVAILABLE FOR THE iCERTIS CALL
	  for(let i=0;i<global.data.brts.length;i++) {
		if(global.data.brt.code.toLowerCase() == global.data.brts[i].code.toLowerCase())
		  global.data.brt.channel = global.data.brts[i].channel;
	  }
	  global.data.brt.pas = [];

	  global.data.company.party = "[SSOData.PartyId]";
	  global.data.company.country = "[SSOData.CountryEntityId]";
	  global.data.company.global = "[SSOData.GlobalEntityId]";
	  global.data.company.brt = JSON.parse(`[SSOData.PreferredBusinessRelationship]`).businessRelationshipTypeName;
	  global.data.company.PreferredBusinessRelationship = JSON.parse(`[SSOData.PreferredBusinessRelationship]`);
	  global.data.company.name = "[SSOData.PartnerName]";

	  global.data.geo.name = "[SSOData.PhysCountry]"; //CFI
	  global.data.geo.code = "[SSOData.CountryCode]"; //CFI

	  //global.data.geo.name = "India";
	  //global.data.geo.code = "IN";

	  global.data.user.email = "[SSOData.Email]";
	  global.data.user.fname = "[SSOData.FirstName]";
	  global.data.user.lname = "[SSOData.LastName]";
	  global.data.user.hpp = "[SSOData.HPPUserId]";
	  global.data.user.locale = "[SSOData.Locale]";
	  global.data.user.language = "[SSOData.PreferredLanguageCode]";
	  global.data.user.planguage = "[SSOData.Language]";
	},
	sor: function(cb) {
	  profile.get({
		email: '[SSOData.Email]',
		relationship: true,
		company: true,
		geography: true,
		business: true
	  }, function(d) {
		if (d.success) {
		  global.data.company.country = d.business.GroupId;
		  global.data.company.global = d.business.GroupId;
		  global.data.company.name = d.company.Name;
		  global.data.geo.name = d.geography.Name; //CFI
		  global.data.geo.code = d.geography.ISO2; //CFI
		  //global.data.geo.name = "India";
		  //global.data.geo.code = "IN";
		  global.data.geo.geography = d.geography.GEO;
		  global.data.geo.region = d.geography.Region;
		  global.data.geo.subregion = d.geography.SubRegion;
		  global.data.user.hpp = d.user.HPPId;
		  global.data.user.locale = d.user.Locale;
		  global.data.user.language = d.user.PreferredLanguage;
		  global.data.user.planguage = d.user.PreferredLanguage;
		  global.data.sim = d.sim.map(function(item) {
			return item['ISO2'];
		  });
		  let brtCode = global.data.brts.filter(function(item) {
			return (item.name.toLowerCase() == global.data.brt.name.toLowerCase())
		  });
		  global.data.brt.code = brtCode[0].code;
		}
	  });
	}
  }


  if ("[SSOData.Email]".indexOf('@hpe.com') > -1) global.data.user.internal = true;
  else global.data.user.internal = false;

  if (!global.data.user.internal) {
	global.data.brt.code = JSON.parse(`[SSOData.PreferredBusinessRelationship]`).businessRelationshipTypeCode;
	global.data.brt.name = JSON.parse(`[SSOData.PreferredBusinessRelationship]`).businessRelationshipTypeName;
	//global.data.brt.channel = [];
	// SETTING THE CHANNEL IS IMPORTANT
	// IT NEEDS TO BE AVAILABLE FOR THE iCERTIS CALL
	for(let i=0;i<global.data.brts.length;i++) {
	  if(global.data.brt.code.toLowerCase() == global.data.brts[i].code.toLowerCase())
		global.data.brt.channel = global.data.brts[i].channel;
	}
	global.data.brt.pas = [];

	global.data.company.party = "[SSOData.PartyId]";
	global.data.company.country = "[SSOData.CountryEntityId]";
	global.data.company.global = "[SSOData.GlobalEntityId]";
	global.data.company.brt = JSON.parse(`[SSOData.PreferredBusinessRelationship]`).businessRelationshipTypeName;
	global.data.company.PreferredBusinessRelationship = JSON.parse(`[SSOData.PreferredBusinessRelationship]`);
	global.data.company.name = "[SSOData.PartnerName]";

	global.data.geo.name = "[SSOData.PhysCountry]"; //CFI
	global.data.geo.code = "[SSOData.CountryCode]"; //CFI

	//global.data.geo.name = "India";
	//global.data.geo.code = "IN";

	global.data.user.email = "[SSOData.Email]";
	global.data.user.fname = "[SSOData.FirstName]";
	global.data.user.lname = "[SSOData.LastName]";
	global.data.user.hpp = "[SSOData.HPPUserId]";
	global.data.user.locale = "[SSOData.Locale]";
	global.data.user.language = "[SSOData.PreferredLanguageCode]";
	global.data.user.planguage = "[SSOData.Language]";

	profile.get({
	  email: '[SSOData.Email]',
	  relationship: true,
	  company: true,
	  geography: true,
	  business: true
	},
				function(d) {
	  if (d.success) {
		global.data.company.country = d.business.GroupId;
		global.data.company.global = d.business.GroupId;
		global.data.company.name = d.company.Name;
		global.data.geo.name = d.geography.Name; //CFI
		global.data.geo.code = d.geography.ISO2; //CFI
		//global.data.geo.name = "India";
		//global.data.geo.code = "IN";
		global.data.geo.geography = d.geography.GEO;
		global.data.geo.region = d.geography.Region;
		global.data.geo.subregion = d.geography.SubRegion;
		global.data.user.hpp = d.user.HPPId;
		global.data.user.locale = d.user.Locale;
		global.data.user.language = d.user.PreferredLanguage;
		global.data.user.planguage = d.user.PreferredLanguage;
		global.data.sim = d.sim.map(function(item) {
		  return item['ISO2'];
		});
		let brtCode = global.data.brts.filter(function(item) {
		  return (item.name.toLowerCase() == global.data.brt.name.toLowerCase())
		});
		global.data.brt.code = brtCode[0].code;
		global.ready = true;
	  }
	});
  }
</script>

<!-- Load reference data based on SSO data standard object
<script src="https://hpe-rfb.it.hpe.com/resources/rs/custom/nor/reference-data.js">-->
<script>
  const reference = {
	xref: '',
	countriesInLA: [],
	countriesArray: [],
	countriesData: [],
	agreements: [],
	currencies: [],
	sim: [],
	countriesRequest: function() {
	  hpe.api.dataset({
		form: '989',
		dataset: 'NOR_COUNTRIES',
		payload: {
		  pageSize: '1000'
		}
	  }, function(d) {
		if (typeof(d) === 'object' && d.Success) {
		  reference.countriesData = d.Data;
		  for (let i = 0; i < reference.countriesData.length; i++) {
			if (reference.countriesData[i].Name == global.data.geo.name) {
			  global.data.geo.geography = reference.countriesData[i].GEO;
			  global.data.geo.region = reference.countriesData[i].Region;
			  global.data.geo.subregion = reference.countriesData[i].SubRegion;
			}
		  }
		  let LAcountriesRAW = reference.countriesData.filter(function(item) {
			return (item.GEO == "Latin America" || item.GEO == "North America")
		  });
		  reference.currencies = reference.countriesData.filter(function(item) {
			return (item.ISO2 == global.data.geo.code)
		  });
		  if (reference.currencies.length == 1 && reference.currencies[0].Country_Currencies)
			reference.currencies = reference.currencies[0].Country_Currencies.split(',');
		  else reference.currencies = ['USD']

		  reference.countriesInLA = LAcountriesRAW.map(function(item) {
			return item.Name
		  });
		  reference.countriesArray = reference.countriesData.map(function(item) {
			return item.Name
		  }).sort();
		}
	  })
	}
  }
</script>

<!-- Load and read agreements from ICM data
<script src="https://hpe-rfb.it.hpe.com/resources/rs/custom/nor/icm-agreements.js"> -->
<script>
  const request = {
	// ICM Agreement data
	agreements: function(profile, callback) {
	  let cacheLog = [];
	  cacheLog.push('ICM Cache: Attempting to fetch cached ICM data');
	  crud.read('4688', 'pid=' + profile.company.party + '&brt=' + profile.brt.code, function(d) {
		let cachedICM = false;
		let sourceICM = false;

		if (typeof(d) !== 'object')
		  cacheLog.push('ICM Cache: Failed fetching cached ICM data');
		else if (d.Rows.length == 0)
		  cacheLog.push('ICM Cache: No cached ICM data available');
		else {
		  cachedICM = d.Rows[0];
		  let threshold = 30 * 24 * 60 * 60 * 1000;
		  let delta = new Date().getTime() - new Date(cachedICM.Modified).getTime();
		  if (delta > threshold)
			cacheLog.push('ICM Cache: Expired cached ICM response found');
		  else {
			cacheLog.push('ICM Cache: Cached ICM response found');
			console.log(cacheLog);
			return callback(JSON.parse(cachedICM.JSON));
		  }
		}

		// attempt to fetch directly from EMDM
		cacheLog.push('ICM Cache: Attempting to fetch ICM data directly');

		// payload
		let payload = {
		  "partyId": profile.company.party,
		  "config": {
			"type": profile.brt.channel,
			"brt": [profile.brt.code],
			"status": {
			  "draft": false,
			  "pending": false,
			  "inactive": false,
			  "active": true,
			  "cancelled": false
			},
			"columns": [
			  "ICMParticipatingParties",
			  "ICMParticipatingCEs",
			  "ICMParticipatingGEs",
			  "ICMCountry",
			  "ICMPartyID",
			  "ICMS4Status",
			  "ICMPANumber",
			  "ICMBusinessRelationshipCode",
			  "ICMBusinessRelationshipDescription",
			  "status"
			],
			"coe": false,
			"amendment": false,
			"participating": true
		  },
		  "debug": true,
		  "page": 1,
		  "pageSize": 100
		};
		// add CE
		if (profile.company.country)
		  payload.countryEntity = profile.company.country;

		// add GE
		if (profile.company.global)
		  payload.globalEntity = profile.company.global;

		// request ICM
		var xhr = new XMLHttpRequest();
		xhr.addEventListener("readystatechange", function() {
		  if (this.readyState === 4) {
			try {
			  let icm = JSON.parse(this.responseText);
			  if (
				typeof(icm) === 'object' &&
				icm.Code && icm.Code == 'XAAS-00' &&
				icm.Response && icm.Response.data
			  ) {
				cacheLog.push('ICM Cache: Valid ICM data fetched successfully, attempting to create cached response');
				if (cachedICM) {
				  crud.update('4688', cachedICM.EntryId, {
					PartyId: profile.company.party,
					CountryEntity: profile.company.country,
					GlobalEntity: profile.company.global,
					BRT: profile.brt.code,
					//Channel: profile.brt.channel,
					Channel: JSON.stringify(profile.brt.channel),
					JSON: JSON.stringify(icm.Response.data)
				  }, function(d) {
					if (d.EntryId) cacheLog.push('ICM Cache: Cached ICM response updated successfully');
					else cacheLog.push('Cache: Failed to update ICM cache');
				  });
				} else {
				  crud.create('4689', {
					PartyId: profile.company.party,
					CountryEntity: profile.company.country,
					GlobalEntity: profile.company.global,
					BRT: profile.brt.code,
					//Channel: profile.brt.channel,
					Channel: JSON.stringify(profile.brt.channel),
					JSON: JSON.stringify(icm.Response.data)
				  }, function(d) {
					if (d.EntryId) cacheLog.push('ICM Cache: Cached ICM response created successfully');
					else cacheLog.push('ICM Cache: Failed to create ICM cache');
				  });
				}
				sourceICM = icm.Response.data;
			  }
			} catch (e) {
			  console.error(e);
			  cacheLog.push('ICM Cache: Critical failure parsing ICM response for cache management');
			}

			console.log(cacheLog);
			// absolute failed case
			if (!sourceICM && !cachedICM)
			  return callback(false);
			// success or partial success
			else if (sourceICM)
			  return callback(sourceICM);
			return callback(JSON.parse(cachedICM.JSON));
		  }
		});
		xhr.open("POST", "https://hpe-rfb.it.hpe.com/resources/rs/custom/php/xaas/search.php");
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.send(JSON.stringify(payload));
	  });
	},
	// CENTRAL TIMESTAMP
	timestamp: function(callback) {
	  var response = null;
	  var xhr = new XMLHttpRequest();
	  xhr.timeout = 2000;
	  xhr.addEventListener("readystatechange", function() {
		if (this.readyState === 4) {
		  if (new Date(this.responseText) == 'Invalid Date')
			return callback(new Date().toISOString().split('.')[0]);
		  return callback(this.responseText);
		}
	  });
	  xhr.open("GET", "https://hpe-rfb.it.hpe.com/resources/rs/custom/onb/timestamp.php");
	  xhr.send(response);
	}
  }
</script>

<!-- NBSF Config
<script src="https://hpe-rfb.it.hpe.com/resources/rs/custom/nor/config.js"> -->
<script>
  // INTERNALS
  const pageFirst = {
	title: "Form001",
	subtitle: "Form00200",
	description: "Form003",
	internal: true,
	nav: true,
	structure: [{
	  header: "FormCFI01",
	  description: "FormCFI02",
	  group: [
		[{
		  label: "Form533",
		  data: "OnBehalf_Type",
		  required: true,
		  type: "select",
		  options: ["Form533_Option1", "Form533_Option2"],
		  values: ["User", "Company"]
		}]
	  ]
	}, {
	  group: [
		[{
		  label: "Form086",
		  data: "OnBehalf_PartyId",
		  required: true,
		  type: "text",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault"
		}],
	  ]
	},
				{
				  group: [
					[{
					  label: "Email",
					  data: "OnBehalf_CreatedBy",
					  required: true,
					  type: "text",
					  tooltip: true,
					  minLen: 6,
					  maxLen: 256,
					  minVal: 6,
					  maxVal: 23,
					  decimals: 4,
					  placeholder: "",
					  validation: ["isEmail", "minLen|6", "maxLen|256", "noBlanksv2"],
					  typing: "kpDefault"
					}],
				  ]
				}
			   ],
	callback: function() {
	  callbacks.pageFirst();
	},
	validation: function() {
	  var result = {
		fail: [],
		pass: []
	  };
	  return result;
	}
  };
  let languages = [];
  const page0 = {
	title: "Form001",
	subtitle: "Form00200",
	description: "Form003",
	internal: true,
	nav: true,
	structure: [{
	  header: "FormCFI01",
	  description: "FormCFI02",
	  group: [
		[{
		  label: "Email",
		  data: "OnBehalf_CreatedBy",
		  required: true,
		  type: "text",
		  tooltip: true,
		  disabled: true,
		  minLen: 6,
		  maxLen: 256,
		  minVal: 6,
		  maxVal: 23,
		  decimals: 4,
		  placeholder: "",
		  validation: ["isEmail", "minLen|6", "maxLen|256", "noBlanksv2"],
		  typing: "kpDefault"
		},
		 {
		   label: "FirstName",
		   data: "FirstName",
		   required: false,
		   disabled: true,
		   type: "text",
		   placeholder: ""
		 },
		 {
		   label: "LastName",
		   data: "LastName",
		   required: true,
		   disabled: true,
		   type: "text",
		   placeholder: ""
		 },
		 {
		   label: "FormCFI05",
		   data: "Language",
		   required: false,
		   disabled: true,
		   type: "select",
		   placeholder: "",
		   options: [],
		   values: []
		 }
		]
	  ]
	},
				{
				  header: "FormCFI03",
				  description: "FormCFI04",
				  group: [
					[{
					  label: "Country Entity",
					  data: "CountryEntity",
					  required: false,
					  disabled: true,
					  type: "text",
					  placeholder: "",
					  validation: ["partnerIds", "minLen|1", "maxLen|50"],
					  typing: "partnerIds"
					},
					 {
					   label: "PartyId",
					   data: "PartyId",
					   required: false,
					   disabled: true,
					   type: "text",
					   placeholder: "",
					   validation: ["partnerIds", "minLen|1", "maxLen|50"],
					   typing: "partnerIds"
					 },
					 {
					   label: "Business Relationship Type",
					   data: "PartnerBRT",
					   required: false,
					   disabled: true,
					   type: "text",
					   placeholder: ""
					 },
					 {
					   label: "Partner name",
					   data: "PartnerName",
					   required: false,
					   disabled: true,
					   type: "text",
					   placeholder: ""
					 },
					 {
					   label: "Country",
					   data: "Country",
					   required: false,
					   disabled: true,
					   type: "text",
					   placeholder: ""
					 },
					 {
					   label: "Region",
					   data: "Region",
					   required: false,
					   disabled: true,
					   type: "text",
					   placeholder: ""
					 },
					 {
					   label: "GEO",
					   data: "Geo",
					   required: false,
					   disabled: true,
					   type: "text",
					   placeholder: ""
					 }
					]
				  ]
				}
			   ],
	callback: function() {
	  callbacks.page0();
	},
	validation: function() {
	  var result = {
		fail: [],
		pass: []
	  };
	  return result;
	}
  };

  // SSO, PO, QOD, PA, PT
  const page1 = {
	title: "Form001",
	subtitle: "Form002",
	description: "Form003",
	ready: false,
	goExternal: true,
	isValidQuote: true,
	nav: true,
	structure: [
	  // HIDDEN INPUTS
	  {
		hidden: true,
		group: [
		  [{
			data: "Email",
			type: "hidden"
		  },
		   {
			 data: "xrefFail",
			 type: "hidden",
			 value: "No"
		   },
		   {
			 data: "FirstName",
			 type: "hidden"
		   },
		   {
			 data: "LastName",
			 type: "hidden"
		   },
		   {
			 data: "HPPUserId",
			 type: "hidden"
		   },
		   {
			 data: "PreferredLanguageCode",
			 type: "hidden"
		   },
		   {
			 data: "Language",
			 type: "hidden"
		   },
		   {
			 data: "PartyId",
			 type: "hidden"
		   },
		   {
			 data: "CountryEntity",
			 type: "hidden"
		   },
		   {
			 data: "GlobalEntity",
			 type: "hidden"
		   },
		   {
			 data: "PartnerBRT",
			 type: "hidden"
		   },
		   {
			 data: "Region",
			 type: "hidden"
		   },
		   {
			 data: "SubRegion",
			 type: "hidden"
		   },
		   {
			 data: "Geo",
			 type: "hidden"
		   },
		   // SFDC
		   {
			 data: "CaseReason",
			 type: "hidden",
			 value: "Manual Order Submission"
		   },
		   {
			 data: "CaseScenario",
			 type: "hidden",
			 value: "Order Receipt"
		   },
		   {
			 data: "InternalScenario",
			 type: "hidden",
			 value: "Order Cleansing/Acceptance"
		   },
		   {
			 data: "AssignToTeam",
			 type: "hidden"
		   },
		   {
			 data: "CaseTitle_aaS",
			 type: "hidden"
		   }
		  ]
		]
	  },
	  //  END CUSTOMER COUNTRY - QUOTE
	  {
		header: "FormCFI016",
		filter: {
		  field: "hideQECC",
		  operator: "neq",
		  value: 'Y'
		},
		group: [
		  [{
			label: "FormCFI017",
			data: "QECC_Country",
			required: false,
			disabled: true,
			type: "text",
			validation: ["kpDefault"],
			typing: "kpDefault"
		  }]
		]
	  },	
	  // SELL INTO MARKET
	  {
		header: "FormCFI016",
		filter: {
		  field: "hideSIM",
		  operator: "neq",
		  value: 'Y'
		},
		group: [
		  [{
			label: "FormCFI017",
			data: "SIM_Country",
			required: true,
			type: "select",
			values: function() {
			  var simz = [];
			  var allowedCty = global.data.sim;
			  var uniqueAllowedCty = [...new Set(allowedCty)];
			  uniqueAllowedCty.forEach(function(sim) {
				let simOne = reference.countriesData.filter(function(item) {
				  return (item.ISO2 == sim)
				})
				if(simOne[0])
				  simz.push(simOne[0]);
			  });
			  let finalC = simz.map(function(item) {
				return item.Name
			  });
			  return finalC;
			}
		  }]
		]
	  },	  
	  // PO INFORMATION
	  {
		header: "Form004",
		group: [
		  [
			// CONFIRMED VALIDATION
			{
			  label: "Form462",
			  data: "PO_BackgroundGroup",
			  required: true,
			  type: "select",
			  options: ["Form463", "Form464", "Form509", "Form510"],
			  values: ["Edge", "Hybrid IT", "Pointnext", "Hybrid IT"],
			  validation: ["inArray"],
			  change: ["inArray"]
			}
		  ]
		]
	  },
	  {
		filter: {
		  field: "CountryCode",
		  operator: "in",
		  value: ["CZ", "PL", "HU", "TR", "RO", "KZ"]
		},
		header: "",
		group: [
		  [{
			label: "Form514",
			data: "PO_HPEEntity",
			required: true,
			filtered: "true",
			type: "select",
			options: ["Form515", "Form516"],
			values: ["HPE BV (NL60)", "HPE Local"],
			validation: ["inArray"],
			change: ["inArray"]
		  }]
		]
	  },
	  {
		filter: {
		  field: "Region",
		  operator: "eq",
		  value: "AMS"
		},
		header: "",
		group: [
		  [{
			label: "Form465",
			data: "PO_BusinessModel",
			required: true,
			filtered: "true",
			type: "select",
			options: ["Form466", "Form467", "Form468", "Form469", "Form470", "Form471"],
			values: ["Trade", "Agent Model", "HPFS", "HPFS & Agent Model", "3rd Party Leasing", "Non Stop"],
			validation: ["inArray"],
			change: ["inArray"]
		  }]
		]
	  },
	  {
		header: "",
		group: [
		  [{
			label: "Form005",
			data: "PO_Number",
			required: true,
			type: "text",
			placeholder: "Form006",
			validation: ["ascii", "minLen|1", "maxLen|30"],
			typing: "ascii"
		  }]
		]
	  },
	  {
		filter: {
		  logic: "or",
		  filters: [
			{
			  field: "CountryCode",
			  operator: "in",
			  value: ["JP", "KR"]
			},
			{
			  logic: "and",
			  filters: [
				{
				  field: "Region",
				  operator: "neq",
				  value: "APJ"
				},
				{
				  field: "SubRegion",
				  operator: "neq",
				  value: "UKI"
				},
				{
				  field: "Geo",
				  operator: "nin",
				  value: ["DACH", "Europe South", "North West Europe"]
				}
			  ]
			}
		  ]
		},
		header: "",
		group: [
		  [
			// PENDING CURRENCY TO COUNTRY MAPPING
			{
			  label: "Form007",
			  data: "PO_Currency",
			  required: true,
			  filtered: "true",
			  type: "select",
			  values: function() {
				return reference.currencies
			  },
			  validation: ["inArray"],
			  change: ["inArray"]
			},
			// CONFIRMED VALIDATION
			{
			  label: "Form008",
			  data: "PO_Value",
			  required: true,
			  type: "text",
			  placeholder: "Form009",
			  validation: ["povalue", "minLen|1", "maxLen|15", "noBlanksv2"],
			  typing: "povaluetyping"
			}
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [
			{
			  field: "CountryCode",
			  operator: "eq",
			  value: "IN"
			},
			{
			  logic: "or",
			  filters: [
				{
				  field: "Region",
				  operator: "neq",
				  value: "AMS"
				},
				{
				  field: "PO_BusinessModel",
				  operator: "eq",
				  value: "Trade"
				},
			  ]
			},
		  ]
		},
		header: "",
		group: [
		  [
			// CONFIRMED VALIDATION
			{
			  label: "Form010",
			  data: "PO_Category",
			  required: true,
			  type: "select",
			  options: ["Form012", "Form013"],
			  values: ["Stock", "Stage"],
			  validation: ["inArray"],
			  change: ["inArray"]
			}
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [
			{
			  field: "CountryCode",
			  operator: "eq",
			  value: "IN"
			},
			{
			  field: "Region",
			  operator: "eq",
			  value: "AMS"
			},
			{
			  field: "PO_BusinessModel",
			  operator: "neq",
			  value: "Trade"
			},
		  ]
		},
		header: "",
		group: [
		  [
			// CONFIRMED VALIDATION
			{
			  label: "Form010",
			  data: "PO_Category",
			  required: true,
			  type: "select",
			  options: ["Form013"],
			  values: ["Stage"],
			  validation: ["inArray"],
			  change: ["inArray"]
			}
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [
			{
			  field: "CountryCode",
			  operator: "neq",
			  value: "IN"
			},
			{
			  field: "Region",
			  operator: "eq",
			  value: "AMS"
			},
			{
			  field: "PO_BusinessModel",
			  operator: "neq",
			  value: "Trade"
			},
		  ]
		},
		header: "",
		group: [
		  [
			// CONFIRMED VALIDATION
			{
			  label: "Form010",
			  data: "PO_Category",
			  required: true,
			  type: "select",
			  options: ["Form011", "Form013"],
			  values: ["Drop", "Stage"],
			  validation: ["inArray"],
			  change: ["inArray"]
			}
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [
			{
			  field: "CountryCode",
			  operator: "neq",
			  value: "IN"
			},
			{
			  logic: "or",
			  filters: [
				{
				  field: "Region",
				  operator: "neq",
				  value: "AMS"
				},
				{
				  field: "PO_BusinessModel",
				  operator: "eq",
				  value: "Trade"
				},
			  ]
			},
		  ]
		},
		header: "",
		group: [
		  [
			// CONFIRMED VALIDATION
			{
			  label: "Form010",
			  data: "PO_Category",
			  required: true,
			  type: "select",
			  options: ["Form011", "Form012", "Form013"],
			  values: ["Drop", "Stock", "Stage"],
			  validation: ["inArray"],
			  change: ["inArray"]
			}
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "BRT",
			operator: "neq",
			value: "T1 Solution Provider"
		  },
					{
					  field: "PO_Category",
					  operator: "in",
					  value: ["Stage", "Drop"]
					}
				   ]
		},
		header: "",
		group: [
		  [
			// CONFIRMED VALIDATION
			{
			  label: "Form014",
			  data: "Rs_PO_Number",
			  required: false,
			  filtered: "true",
			  type: "text",
			  placeholder: "Form015",
			  validation: ["ascii", "minLen|1", "maxLen|70"],
			  typing: "ascii"
			}
		  ]
		]
	  },
	  {
		filter: {
		  logic: "or",
		  filters: [{
			field: "PO_Category",
			operator: "eq",
			value: "Drop"
		  },
					{
					  field: "PO_Category",
					  operator: "eq",
					  value: "Stage"
					}
				   ]
		},
		header: "",
		group: [
		  [
			// CONFIRMED VALIDATION
			{
			  label: "Form016",
			  data: "Cx_PO_Number",
			  required: false,
			  type: "text",
			  placeholder: "Form017",
			  validation: ["ascii", "minLen|1", "maxLen|70"],
			  typing: "ascii"
			}
		  ]
		]
	  },
	  // PA & PT
	  {
		filter: {
		  field: "aggrVal",
		  operator: "eq",
		  value: "0"
		},
		header: "Form023",
		group: [
		  [{
			label: "Form024",
			data: "PA_Number",
			required: true,
			type: "text",
			filtered: "true",
			placeholder: "Form025",
			validation: ["alphanumeric", "minLen|5", "maxLen|5", "noBlanksv2"],
			typing: "alphanumeric"
		  },
		   {
			 label: "Form026",
			 data: "Payment_Terms",
			 required: true,
			 type: "text",
			 placeholder: "Form478",
			 validation: ["ascii", "minLen|1", "maxLen|60"],
			 typing: "ascii"
		   }
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "aggrVal",
			operator: "eq",
			value: "1"
		  },
					{
					  logic: "or",
					  filters: [{
						field: "Region",
						operator: "eq",
						value: "AMS"
					  },
								{
								  field: "Geo",
								  operator: "eq",
								  value: "Central Europe"
								},
								{
								  field: "SubRegion",
								  operator: "eq",
								  value: "MESA"
								},
								{
								  field: "Geo",
								  operator: "eq",
								  value: "CERTA"
								}
							   ]
					}
				   ]
		},
		header: "Form023",
		group: [
		  [{
			label: "Form024",
			data: "PA_Number",
			filtered: "true",
			required: true,
			type: "select",
			values: function() {
			  return global.data.brt.pas
			}
		  },
		   {
			 label: "Form026",
			 data: "Payment_Terms",
			 required: true,
			 type: "text",
			 placeholder: "Form478",
			 validation: ["ascii", "minLen|1", "maxLen|60"],
			 typing: "ascii"
		   }
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Region",
			operator: "neq",
			value: "AMS"
		  },
					{
					  field: "aggrVal",
					  operator: "eq",
					  value: "1"
					},
					{
					  field: "Geo",
					  operator: "nin",
					  value: ["CERTA"]
					},
					{
					  field: "SubRegion",
					  operator: "nin",
					  value: ["Central Europe", "MESA"]
					}
				   ]
		},
		header: "",
		group: [
		  [{
			data: "PA_NumberPlaceholder",
			type: "hidden"
		  },
		   {
			 label: "Form024",
			 data: "PA_Number",
			 filtered: "true",
			 required: true,
			 type: "select",
			 values: function() {
			   return global.data.brt.pas
			 }
		   }
		  ]
		]
	  },
	  // QOD filter
	  {
		filter: {
		  field: "Geo",
		  operator: "eq",
		  value: "North America"
		},
		header: "Form075",
		group: [
		  [{
			label: "Form530",
			data: "Config_aaS",
			filtered: "true",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }, {
			label: "Form018",
			data: "Config_Quote",
			required: true,
			type: "toggle",
			value: "Y",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		filter: {
		  field: "Geo",
		  operator: "neq",
		  value: "North America"
		},
		header: "Form075",
		group: [
		  [{
			label: "Form018",
			data: "Config_Quote",
			required: true,
			type: "toggle",
			value: "Y",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  // QOD no filter ams / UCID-CONFIG NO
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "N"
		  },
					{
					  field: "Region",
					  operator: "eq",
					  value: "AMS"
					},
					{
					  field: "PartnerBRT",
					  operator: "neq",
					  value: "Master Area Partner"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form021",
			data: "Requestor_PO_Deal_ID",
			filtered: "true",
			required: false,
			type: "text",
			placeholder: "Form022",
			validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			typing: "isIntegerAndComma"
		  },
		   {
			 label: "Form479",
			 data: "Requestor_PO_Opp_ID",
			 filtered: "true",
			 required: false,
			 type: "text",
			 placeholder: "Form480",
			 validation: ["ascii", "maxLen|14", "IsOpportunityID"],
			 typing: "ascii"
		   }
		  ]
		]
	  },
	  // QOD with filter ams / UCID-CONFIG NO
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "Y"
		  },
					{
					  field: "Region",
					  operator: "eq",
					  value: "AMS"
					},
					{
					  field: "PartnerBRT",
					  operator: "neq",
					  value: "Master Area Partner"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form019",
			data: "Requestor_PO_Quote_ID",
			required: true,
			type: "text",
			filtered: "true",
			placeholder: "Form020",
			validation: ["kpDefault", "minLen|13", "maxLen|13", "noBlanksv2"],
			typing: "kpDefault"
		  },
		   {
			 label: "Form456",
			 data: "Config_UCID",
			 required: false,
			 type: "text",
			 placeholder: "Form457",
			 validation: ["IsUCID", "minLen|1", "noBlanksv2"],
			 typing: "IsUCID"
		   },
		   {
			 label: "Form458",
			 data: "Config_UCIDQ",
			 required: false,
			 type: "text",
			 placeholder: "Form459",
			 validation: ["IsUCIDQ", "minLen|1", "noBlanksv2"],
			 typing: "IsUCIDQ"
		   },
		   {
			 label: "Form460",
			 data: "Config_ConfigId",
			 required: false,
			 type: "text",
			 placeholder: "Form461",
			 validation: ["isIntegerAndComma", "minLen|1", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form021",
			 data: "Requestor_PO_Deal_ID",
			 required: false,
			 type: "text",
			 placeholder: "Form022",
			 validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form479",
			 data: "Requestor_PO_Opp_ID",
			 filtered: "true",
			 required: false,
			 type: "text",
			 value: "OPE-",
			 placeholder: "Form480",
			 validation: ["ascii", "maxLen|14", "IsOpportunityID"],
			 typing: "ascii"
		   }
		  ]
		]
	  },
	  // QOD no filter no ams / UCID-CONFIG NO
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "N"
		  },
					{
					  field: "Region",
					  operator: "neq",
					  value: "AMS"
					},
					{
					  field: "PartnerBRT",
					  operator: "neq",
					  value: "Master Area Partner"
					},
					{
					  field: "CountryCode",
					  operator: "neq",
					  value: "TR"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form021",
			data: "Requestor_PO_Deal_ID",
			filtered: "true",
			required: false,
			type: "text",
			placeholder: "Form022",
			validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			typing: "isIntegerAndComma"
		  }]
		]
	  },
	  // QOD with filter no ams / UCID-CONFIG NO
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "Y"
		  },
					{
					  field: "Region",
					  operator: "neq",
					  value: "AMS"
					},
					{
					  field: "PartnerBRT",
					  operator: "neq",
					  value: "Master Area Partner"
					},
					{
					  field: "CountryCode",
					  operator: "neq",
					  value: "TR"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form019",
			data: "Requestor_PO_Quote_ID",
			required: true,
			type: "text",
			filtered: "true",
			placeholder: "Form020",
			validation: ["kpDefault", "minLen|1", "maxLen|15", "noBlanksv2"],
			typing: "kpDefault"
		  },
		   {
			 label: "Form456",
			 data: "Config_UCID",
			 required: false,
			 type: "text",
			 placeholder: "Form457",
			 validation: ["IsUCID", "minLen|1", "noBlanksv2"],
			 typing: "IsUCID"
		   },
		   {
			 label: "Form458",
			 data: "Config_UCIDQ",
			 required: false,
			 type: "text",
			 placeholder: "Form459",
			 validation: ["IsUCIDQ", "minLen|1", "noBlanksv2"],
			 typing: "IsUCIDQ"
		   },
		   {
			 label: "Form460",
			 data: "Config_ConfigId",
			 required: false,
			 type: "text",
			 placeholder: "Form461",
			 validation: ["isIntegerAndComma", "minLen|1", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form021",
			 data: "Requestor_PO_Deal_ID",
			 required: false,
			 type: "text",
			 placeholder: "Form022",
			 validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   }
		  ]
		]
	  },

	  // QOD no filter ams / UCID-CONFIG YES
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "N"
		  },
					{
					  field: "Region",
					  operator: "eq",
					  value: "AMS"
					},
					{
					  field: "PartnerBRT",
					  operator: "eq",
					  value: "Master Area Partner"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form456",
			data: "Config_UCID",
			required: false,
			type: "text",
			placeholder: "Form457",
			validation: ["IsUCID", "minLen|1", "noBlanksv2"],
			typing: "IsUCID"
		  },
		   {
			 label: "Form458",
			 data: "Config_UCIDQ",
			 required: false,
			 type: "text",
			 placeholder: "Form459",
			 validation: ["IsUCIDQ", "minLen|1", "noBlanksv2"],
			 typing: "IsUCIDQ"
		   },
		   {
			 label: "Form460",
			 data: "Config_ConfigId",
			 required: false,
			 type: "text",
			 placeholder: "Form461",
			 validation: ["isIntegerAndComma", "minLen|1", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form021",
			 data: "Requestor_PO_Deal_ID",
			 filtered: "true",
			 required: false,
			 type: "text",
			 placeholder: "Form022",
			 validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form479",
			 data: "Requestor_PO_Opp_ID",
			 filtered: "true",
			 required: false,
			 type: "text",
			 placeholder: "Form480",
			 validation: ["ascii", "minLen|1", "maxLen|14", "IsOpportunityID"],
			 typing: "ascii"
		   }
		  ]
		]
	  },
	  // QOD with filter ams / UCID-CONFIG YES
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "Y"
		  },
					{
					  field: "Region",
					  operator: "eq",
					  value: "AMS"
					},
					{
					  field: "PartnerBRT",
					  operator: "eq",
					  value: "Master Area Partner"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form019",
			data: "Requestor_PO_Quote_ID",
			required: true,
			type: "text",
			filtered: "true",
			placeholder: "Form020",
			validation: ["kpDefault", "minLen|1", "maxLen|15", "noBlanksv2"],
			typing: "kpDefault"
		  },
		   {
			 label: "Form456",
			 data: "Config_UCID",
			 required: false,
			 type: "text",
			 placeholder: "Form457",
			 validation: ["IsUCID", "minLen|1", "noBlanksv2"],
			 typing: "IsUCID"
		   },
		   {
			 label: "Form458",
			 data: "Config_UCIDQ",
			 required: false,
			 type: "text",
			 placeholder: "Form459",
			 validation: ["IsUCIDQ", "minLen|1", "noBlanksv2"],
			 typing: "IsUCIDQ"
		   },
		   {
			 label: "Form460",
			 data: "Config_ConfigId",
			 required: false,
			 type: "text",
			 placeholder: "Form461",
			 validation: ["isIntegerAndComma", "minLen|1", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form021",
			 data: "Requestor_PO_Deal_ID",
			 required: false,
			 type: "text",
			 placeholder: "Form022",
			 validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form479",
			 data: "Requestor_PO_Opp_ID",
			 filtered: "true",
			 required: false,
			 type: "text",
			 value: "OPE-",
			 placeholder: "Form480",
			 validation: ["ascii", "minLen|1", "maxLen|14", "IsOpportunityID"],
			 typing: "ascii"
		   }
		  ]
		]
	  },
	  // QOD no filter no ams / UCID-CONFIG YES
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "N"
		  },
					{
					  field: "Region",
					  operator: "neq",
					  value: "AMS"
					},
					{
					  logic: "or",
					  filters: [{
						field: "PartnerBRT",
						operator: "eq",
						value: "Master Area Partner"
					  },
								{
								  field: "CountryCode",
								  operator: "eq",
								  value: "TR"
								}
							   ]
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form456",
			data: "Config_UCID",
			required: false,
			type: "text",
			placeholder: "Form457",
			validation: ["IsUCID", "minLen|1", "noBlanksv2"],
			typing: "IsUCID"
		  },
		   {
			 label: "Form458",
			 data: "Config_UCIDQ",
			 required: false,
			 type: "text",
			 placeholder: "Form459",
			 validation: ["IsUCIDQ", "minLen|1", "noBlanksv2"],
			 typing: "IsUCIDQ"
		   },
		   {
			 label: "Form460",
			 data: "Config_ConfigId",
			 required: false,
			 type: "text",
			 placeholder: "Form461",
			 validation: ["isIntegerAndComma", "minLen|1", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form021",
			 data: "Requestor_PO_Deal_ID",
			 filtered: "true",
			 required: false,
			 type: "text",
			 placeholder: "Form022",
			 validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   }
		  ]
		]
	  },
	  // QOD with filter no ams / UCID-CONFIG YES
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_Quote",
			operator: "eq",
			value: "Y"
		  },
					{
					  field: "Region",
					  operator: "neq",
					  value: "AMS"
					},
					{
					  logic: "or",
					  filters: [{
						field: "PartnerBRT",
						operator: "eq",
						value: "Master Area Partner"
					  },
								{
								  field: "CountryCode",
								  operator: "eq",
								  value: "TR"
								}
							   ]
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form019",
			data: "Requestor_PO_Quote_ID",
			required: true,
			type: "text",
			filtered: "true",
			placeholder: "Form020",
			validation: ["kpDefault", "minLen|1", "maxLen|15", "noBlanksv2"],
			typing: "kpDefault"
		  },
		   {
			 label: "Form456",
			 data: "Config_UCID",
			 required: false,
			 type: "text",
			 placeholder: "Form457",
			 validation: ["IsUCID", "minLen|1", "noBlanksv2"],
			 typing: "IsUCID"
		   },
		   {
			 label: "Form458",
			 data: "Config_UCIDQ",
			 required: false,
			 type: "text",
			 placeholder: "Form459",
			 validation: ["IsUCIDQ", "minLen|1", "noBlanksv2"],
			 typing: "IsUCIDQ"
		   },
		   {
			 label: "Form460",
			 data: "Config_ConfigId",
			 required: false,
			 type: "text",
			 placeholder: "Form461",
			 validation: ["isIntegerAndComma", "minLen|1", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   },
		   {
			 label: "Form021",
			 data: "Requestor_PO_Deal_ID",
			 required: false,
			 type: "text",
			 placeholder: "Form022",
			 validation: ["isIntegerAndComma", "minLen|8", "noBlanksv2"],
			 typing: "isIntegerAndComma"
		   }
		  ]
		]
	  },
	  // Delivery
	  {
		filter: {
		  field: "Region",
		  operator: "neq",
		  value: "AMS"
		},
		header: "Form472",
		group: [
		  [{
			label: "Form039",
			placeholder: "Form040",
			data: "PO_DeliveryDate",
			required: false,
			type: "date",
			placeholder: "DD/MM/YYYY",
			dtp: {
			  format: 'd/m/Y',
			  formatDate: 'd/m/Y',
			  timepicker: false,
			  minDate: 0,
			  maxDate: new Date(new Date().setDate(new Date().getDate() + 90)).toLocaleDateString('en-GB'),
			  onChangeDateTime: function(dp, $input) {

			  }
			}
		  }]
		]
	  },
	  {
		filter: {
		  field: "Region",
		  operator: "eq",
		  value: "AMS"
		},
		header: "Form472",
		group: [
		  [{
			label: "Form039",
			placeholder: "Form040",
			data: "PO_DeliveryDate",
			required: false,
			type: "date",
			placeholder: "DD/MM/YYYY",
			dtp: {
			  format: 'd/m/Y',
			  formatDate: 'd/m/Y',
			  timepicker: false,
			  minDate: 0,
			  maxDate: new Date(new Date().setDate(new Date().getDate() + 90)).toLocaleDateString('en-GB'),
			  onChangeDateTime: function(dp, $input) {

			  }
			}
		  },
		   {
			 label: "Form476",
			 data: "PO_DeliveryIncoterms",
			 required: true,
			 type: "select",
			 filtered: "true",
			 options: ["Form473", "Form474", "Form475"],
			 values: ["DDP", "EXW", "FCA"]
		   }

		  ]
		]
	  },
	  {
		filter: {
		  logic: "or",
		  filters: [{
			field: "Region",
			operator: "eq",
			value: "APJ"
		  },
					{
					  field: "Geo",
					  operator: "in",
					  value: ["Latin America", "North America"]
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form477",
			data: "PO_CompleteDelivery",
			filtered: "true",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  // Invoice Details
	  {
		filter: {
		  field: "CountryCode",
		  operator: "eq",
		  value: "JP"
		},
		header: "Form248",
		group: [
		  [{
			label: "Form249",
			data: "Invoice_Format",
			required: true,
			type: "select",
			filtered: "true",
			values: ["HPE Form - No individual instructions to CSM",
					 "HPE Form - With individual instructions to CSM (individual instruction content input required)",
					 "Monthly Invoice",
					 "Customer Form",
					 "Customer System"
					],
			options: ["Form251", "Form252", "Form253", "Form254", "Form255"]
		  }]
		]
	  },
	  {
		filter: {
		  field: "CountryCode",
		  operator: "eq",
		  value: "JP"
		},
		header: "",
		group: [
		  [{
			label: "Form250",
			data: "Invoice_SendEmail",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  // Notification
	  {
		header: "Form031",
		description: 'Form032',
		group: [
		  [{
			label: "Form215",
			data: "Notification_CC",
			required: false,
			type: "text",
			placeholder: "Form033",
			validation: [],
			typing: "kpDefault"
		  }]
		]
	  }
	],
	callback: function() {
	  let inputField = document.querySelector('[data-name="Requestor_PO_Quote_ID"]');

	  if (inputField) {
		inputField.addEventListener('input', function(e) {
		  let value = this.value.toUpperCase();
		  this.value = value;
		  
		  // ensure that first two characters are 'NQ' or 'DQ' or '30'
		  if (this.value.length <= 2 && !/^(N|D|NQ|DQ|3|30|NI)?$/.test(this.value)) {
			this.value = this.value.slice(0, -1);
		  }
		  
		  // allow only digits after 'NQ' or 'DQ' and limit them to 8 or 300000
		  if (this.value.length > 2 && this.value.length <= 10 && /^(NQ|DQ|NI)/.test(this.value) && !/^(NQ|DQ|NI)\d*$/.test(this.value)) {
			this.value = this.value.slice(0, -1);
		  }
		  
		  // allow only 00000 after '3' - 300000XXXXX 
		  if (this.value.length > 2 && this.value.length <= 6 && /^30/.test(this.value) && !/^3[0]{2,5}$/.test(this.value)) {
			this.value = this.value.slice(0, -1);
		  }
		  
		  // allow only digits after '300000' - 300000XXXXX 
		  if (this.value.length > 6 && this.value.length <= 11 && /^30/.test(this.value) && !/^300000\d*$/.test(this.value)) {
			this.value = this.value.slice(0, -1);
		  }
		  
		  // 300000XXXXX 
		  if (this.value.length > 11 && /^30/.test(this.value) && !/^300000\d{5}$/.test(this.value)) {
			this.value = this.value.slice(0, -1);
		  }
		  
		  // automatically append hyphen after 8 digits
		  if (this.value.length === 10 && /^(NQ|DQ|D2)/.test(this.value)) {
			this.value += "-";
		  }
		  
		  // allow '01', '02', '03' after the hyphen (example - DQXXXXXXXX-XX)
		  if (this.value.length > 11 && /^(NQ|DQ|NI)/.test(this.value) && !/^([0-9]|[0-9][0-9])?$/.test(this.value.slice(11))) {
			this.value = this.value.slice(0, -1);
		  }
		    
		  // read quote 
		  if (this.value) {
			// const quotePattern = /(^(NQ|DQ)\d{8}-([0-9][0-9]))|^(300000)\d{5}$/;
			// for testing
			const quotePattern = /(^(NQ|DQ|N2|NI)\d{8}-([0-9][0-9]))|^(300000)\d{5}$/;
			if (quotePattern.test(this.value)) {
			 mo.fn.overlay.show({
				loading: true,
				close: false
			  });
			  quoteHelper.readQuote(this.value, function(quote) {
				mo.fn.overlay.hide();
				mo.fn.events.closeAll();
				const { valid, text } = quoteHelper.validateQuote(quote);
				page1.isValidQuote = valid;
				// call validation
				$("input[data-name=Requestor_PO_Quote_ID]").trigger("change", !valid);
				if (!valid) {
				 mo.fn.modal.show({
				   close: false,
				   ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				   title: hpe.fn.lang(text, config.locale, config.localizations),
				   content: '',
				   ctaCallback: function() {
					 mo.fn.overlay.hide();
					 mo.fn.events.closeAll();
				   }
				 });		  
				}
			  });
			}
		  }
		});

		// modify backspace behavior
		inputField.addEventListener('keydown', function(e) {
		  if (e.key === "Backspace" && this.value.length === 11) {
			e.preventDefault();
			this.value = this.value.slice(0, -2);
		  }
		});
	  }
	  callbacks.page1();
	},
	validation: function() {
	  var result = {
		fail: [],
		pass: []
	  };
	  var Notification_CC = document.querySelector('input[data-name=Notification_CC]');
	  if (Notification_CC.value && !nbsf.vld.isCarbonCC(Notification_CC.value)) result.fail.push(Notification_CC.closest('label'));

	  // check if quote ID respects the format
	  var quoteID = document.querySelector('input[data-name=Requestor_PO_Quote_ID]');

	  if (quoteID) {
		// const quotePattern = /(^(NQ|DQ)\d{8}-([0-9][0-9]))|^(300000)\d{5}$/;
		// for testing
		const quotePattern = /(^(NQ|DQ|NI)\d{8}-([0-9][0-9]))|^(300000)\d{5}$/;

		if (!quotePattern.test(quoteID.value) || !page1.isValidQuote) {
		  // add  the error only if the value is the right length and wrong format, for a smaller length, nbsf built in min length
		  result.fail.push(quoteID.closest('label'));
		} else {
		  result.pass.push(quoteID.closest('label'));
		}
	  }

	  return result;
	}
  };
	
  // QUOTE PREVIEW FOR AMS GEO - MESA / CERTA or MEA / CETA
  const pageQuotePreview = {
	title: "Form001",
	subtitle: "Subtitle",
	description: "Description",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		{
		  field: "Config_Quote",
		  operator: "eq",
		  value: "Y"
		},
		{
		  logic: "or",
		  filters: [
			{
			  field: "Geo",
			  operator: "in",
			  value: ["CERTA", "CETA", "Latin America", "North America"]
			},
			{
			  field: "SubRegion",
			  operator: "eq",
			  value: "MESA"
			},
		  ]
		}
	  ]
	},
	structure: [
	  // SoldTo Config
	  {
		header: "Form081",
		group: [
            [{
              label: "Form257",
              data: "Config_PPC_SoldTo",
              value: "Y",
              required: true,
              type: "toggle",
              values: ["Y", "N"]
            }],
          ]
	  },
	  {
		header: "Form081",
		group: [
		  	[
			 {
			   data: "PPC_SoldTo",
			   type: "hidden"
			 }
			],
          ]
        },
	  // Payer Config
	  {
		header: "Form081",
		group: [
		  [
            {
              label: "Form257",
              data: "Config_PPC_Payer",
              value: "Y",
              required: true,
              type: "toggle",
              values: ["Y", "N"]
            }
            ]
          ]
        },
	  {
		header: "Form081",
		group: [
		  [
			{
			   data: "PPC_Payer",
			   type: "hidden"
			 }
            ]
          ]
        },
	  // BillTo Config
	  {
		header: "Form081",
		group: [
		  [
            {
              label: "Form257",
              data: "Config_PPC_BillTo",
              value: "Y",
              required: true,
              type: "toggle",
              values: ["Y", "N"]
            }
            ]
          ]
        },
	  {
		header: "Form081",
		group: [
		  [
			{
			   data: "PPC_BillTo",
			   type: "hidden"
			 }
            ]
          ]
        },
	  // ShipTo Config
	  {
		header: "Form045",
		group: [
            [{
              label: "Form257",
              data: "Config_PPC_ShipTo",
              value: "Y",
              required: true,
              type: "toggle",
              values: ["Y", "N"]
            }
            ]
          ]
        },
	  {
		header: "Form045",
		group: [
            [
			 {
			   data: "PPC_ShipTo",
			   type: "hidden"
			 }
            ]
          ]
        },		
	  // End Customer Config
	  {
		header: "End Customer Information",
		group: [
            [
            {
              label: "Form257",
              data: "Config_PPC_EndCx",
              value: "Y",
              required: true,
              type: "toggle",
              values: ["Y", "N"]
            }
            ]
          ]
        },
	  {
		header: "End Customer Information",
		group: [
            [
			 {
			   data: "PPC_EndCx",
			   type: "hidden"
			 }
            ]
          ]
        },		
	  // Reseller Config
	  {
		header: "Reseller Information",
		filter: {
            logic: "and",
            filters: [
			  {
				field: "PartnerBRT",
				operator: "in",
				value: ["Distributor", "OEM Distributor", "System Integrator"]
			  },
			  {
				field: "PO_BusinessModel",
				operator: "nin",
				value: ["Agent Model", "HPFS & Agent Model"]
			  },
			  {
				field: "PO_Category",
				operator: "neq",
				value: "Stock"
			  }
            ]
          },
		group: [
            [
            {
              label: "Form257",
              data: "Config_PPC_Reseller",
              value: "Y",
              required: true,
              type: "toggle",
              values: ["Y", "N"]
            }
            ]
          ]
        },
	  {
		header: "Reseller Information",
		filter: {
            logic: "and",
            filters: [
			  {
				field: "PartnerBRT",
				operator: "in",
				value: ["Distributor", "OEM Distributor", "System Integrator"]
			  },
			  {
				field: "PO_BusinessModel",
				operator: "nin",
				value: ["Agent Model", "HPFS & Agent Model"]
			  },
			  {
				field: "PO_Category",
				operator: "neq",
				value: "Stock"
			  }
            ]
		},
		group: [
            [
			  {
			   data: "PPC_Reseller",
			   type: "hidden"
			 }
            ]
          ]
        },			  
	],
	callback: function() {
	  quoteHelper.buildQuotePreviewPage(config);
	}
  };
  
  // PO, RESERVATION, CONFIGURATION
  const page2 = {
	title: "Form001",
	subtitle: "Form037",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		{
		  field: "Geo",
		  operator: "nin",
		  value: ["CERTA", "CETA", "Latin America", "North America"]
		},
		{
		  field: "internalUser",
		  operator: "neq",
		  value: true
		},
		{
		  field: "SubRegion",
		  operator: "neq",
		  value: "MESA"
		},
	  ]
	},
	structure: [
	  // UPLOAD PO
	  {
		header: "Form038",
		group: [
		  [{
			label: "FormCFI06",
			data: "PO_Attachment",
			type: "kUpload",
			required: true,
			uploadConfig: {
			  formId: 989,
			  extensions: [".pdf", ".zip", ".xlxs", ".xlsx", ".xls", ".doc", ".docx"],
			  maxFileSize: 4
			}
		  }],
		]
	  },
	  {
		header: "Form081",
		group: [
		  [{
			// TODO: On MTP change the localization instead
			label: "Form041",
			//	label: "Is your Sold to information available on the attached purchase order?",
			data: "Config_SoldToDetails",
			value: "N",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  },
		   /*   {
               label: "Form042",
               data: "Config_SoldToDetails_Contact",
               value: "N",
               required: true,
               type: "toggle",
               values: ["N", "Y"],
               options: ["No", "Yes"]
             },*/
		   {
			 label: "Form043",
			 data: "Config_PayerDetails",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		   {
			 label: "Form044",
			 data: "Config_BillToDetails",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   }
		  ]
		]
	  },
	  {
		filter: {
		  field: "PO_Category",
		  operator: "eq",
		  value: "Stock"
		},
		header: "Form045",
		description: "Form046",
		group: [
		  [{
			label: "Form047",
			data: "Config_ShipToDetails",
			value: "N",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  },
		   {
			 label: "Form048",
			 data: "Config_ShipToDetails_Contact",
			 value: "N",
			 required: false,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   }
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "PartnerBRT",
			operator: "nin",
			value: ["Distributor", "OEM Distributor", "System Integrator"]
		  },
					{
					  field: "PO_Category",
					  operator: "neq",
					  value: "Stock"
					}
				   ]
		},
		header: "Form049",
		description: "Form050",
		group: [
		  [{
			label: "Form047",
			data: "Config_ShipToDetails",
			value: "N",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  },
		   {
			 label: "Form048",
			 data: "Config_ShipToDetails_Contact",
			 value: "N",
			 required: false,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		   {
			 label: "Form084",
			 data: "Config_EndCxDetails",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		   {
			 label: "Form085",
			 data: "Config_EndCxDetails_Contact",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   }
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "PartnerBRT",
			operator: "in",
			value: ["Distributor", "OEM Distributor", "System Integrator"]
		  },
					{
					  field: "PO_BusinessModel",
					  operator: "nin",
					  value: ["Agent Model", "HPFS & Agent Model"]
					},
					{
					  field: "PO_Category",
					  operator: "neq",
					  value: "Stock"
					}
				   ]
		},
		header: "Form049",
		description: "Form050",
		group: [
		  [{
			label: "Form047",
			data: "Config_ShipToDetails",
			value: "N",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  },
		   {
			 label: "Form048",
			 data: "Config_ShipToDetails_Contact",
			 value: "N",
			 required: false,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		   {
			 label: "Form084",
			 data: "Config_EndCxDetails",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		   {
			 label: "Form085",
			 data: "Config_EndCxDetails_Contact",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		   {
			 label: "Form082",
			 data: "Config_ResellerDetails",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		   {
			 label: "Form083",
			 data: "Config_ResellerDetails_Contact",
			 value: "N",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   },
		  ]
		]
	  },
	  {
		filter: {
		  field: "CountryCode",
		  operator: "eq",
		  value: "IN"
		},
		header: "Form521",
		group: [
		  [{
			label: "Form522",
			data: "Config_Tier1",
			value: "Y",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "CountryCode",
			operator: "eq",
			value: "IN"
		  },
					{
					  field: "Config_Tier1",
					  operator: "neq",
					  value: "Y"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form523",
			data: "Config_Business_Justification",
			required: true,
			type: "text",
			placeholder: "Form524",
			validation: ["minLen|1"],
			typing: "ascii"
		  }]
		]
	  },
	  {
		filter: {
		  field: "CountryCode",
		  operator: "eq",
		  value: "IN"
		},
		header: "",
		group: [
		  [{
			label: "Form525",
			data: "Config_Tier2",
			value: "Y",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  },
		   {
			 label: "Form526",
			 data: "Config_Shipment_India",
			 value: "Y",
			 required: true,
			 type: "toggle",
			 values: ["N", "Y"],
			 options: ["No", "Yes"]
		   }
		  ]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "CountryCode",
			operator: "eq",
			value: "IN"
		  },
					{
					  field: "Config_Shipment_India",
					  operator: "neq",
					  value: "Y"
					}
				   ]
		},
		header: "",
		group: [
		  [{
			label: "Form527",
			data: "Config_OEM",
			value: "N",
			required: true,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	],
	callback: function() {
	  callbacks.page2();
	}
  };

  // SOLD TO PAGE
  const page3 = {
	title: "Form054",
	subtitle: "Form055",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		  {
			field: "Config_SoldToDetails",
			operator: "neq",
			value: "Y"
		  },
		  {
			field: "Config_PPC_SoldTo",
			operator: "neq",
			value: "Y"
		  },
		]
	},
	structure: [{
	  //header: "Form056",
	  header: "Address",
	  filter: {
		logic: "and",
		filters: [{
		  field: "Config_SoldToDetails",
		  operator: "neq",
		  value: "Y"
		},
				  {
					field: "xrefFail",
					operator: "eq",
					value: "No"
				  }
				 ]
	  },
	  group: [
		[{
		  label: "Form086",
		  data: "SoldTo_PartyId",
		  required: false,
		  type: "text",
		  //placeholder: "Form057",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault"
		}],
		[{
		  label: "Form058",
		  data: "SoldTo_CompanyName",
		  required: true,
		  type: "text",
		  //placeholder: "Form059",
		  validation: ["kpDefault", "minLen|2", "maxLen|140"],
		  typing: "kpDefault"
		},
		 {
		   label: "Address",
		   data: "SoldTo_Address_Street",
		   required: true,
		   type: "text",
		   //placeholder: "Form216",
		   validation: ["kpDefault", "minLen|2", "maxLen|55"],
		   typing: "kpDefault"
		 },
		 {
		   label: "AddressLineOptional",
		   data: "SoldTo_Address_Street2",
		   required: false,
		   type: "text",
		   //placeholder: "Form061",
		   validation: ["kpDefault", "minLen|2", "maxLen|50"],
		   typing: "kpDefault"
		 },
		 {
		   label: "City",
		   data: "SoldTo_Address_City",
		   required: true,
		   type: "text",
		   //placeholder: "Form062",
		   validation: ["kpDefault", "minLen|2", "maxLen|35"],
		   typing: "kpDefault"
		 },
		 {
		   label: "StateProvince",
		   data: "SoldTo_Address_State",
		   required: false,
		   type: "text",
		   //placeholder: "Form063",
		   validation: ["kpDefault", "minLen|2"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Postal code",
		   data: "SoldTo_Address_Postal",
		   required: true,
		   type: "text",
		   //placeholder: "Form087",
		   validation: ["kpDefault", "minLen|2", "maxLen|10"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Country",
		   data: "SoldTo_Address_Country",
		   required: true,
		   type: "select",
		   values: function() {
			 return reference.countriesArray
			 /*var simz = [];
                                  global.data.sim.forEach(function(sim) {
                                    let simOne = reference.countriesData.filter(function(item) {
                                      return (item.ISO2 == sim)
                                    })
                                    simz.push(simOne[0])
                                  });

                                  let finalC = simz.map(function(item) {
                                    return item.Name
                                  });
                                  return finalC;*/
		   }
		 }
		]
	  ]
	},
				{
				  //header: "Form056",
				  header: "Address",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_SoldToDetails",
					  operator: "neq",
					  value: "Y"
					},
							  {
								field: "xrefFail",
								operator: "eq",
								value: "Yes"
							  }
							 ]
				  },
				  group: [
					[{
					  label: "Form086",
					  data: "SoldTo_PartyId",
					  required: false,
					  type: "text",
					  //placeholder: "Form057",
					  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
					  typing: "kpDefault"
					}]
				  ]
				},
				{
				  header: "Contact",
				  filter: {
					field: "Config_SoldToDetails",
					operator: "neq",
					value: "Y"
				  },
				  group: [
					[{
					  label: "FirstName",
					  data: "SoldTo_Contact_FirstName",
					  required: false,
					  type: "text",
					  //placeholder: "Form065",
					  validation: ["kpDefault", "minLen|1"],
					  typing: "kpDefault"
					},
					 {
					   label: "Surname",
					   data: "SoldTo_Contact_LastName",
					   required: true,
					   type: "text",
					   //placeholder: "Form066",
					   validation: ["kpDefault", "minLen|1", "maxLen|60"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Telephone",
					   data: "SoldTo_Contact_Phone",
					   required: false,
					   type: "text",
					   //placeholder: "1-888-666-5555",
					   validation: ["typePhone", "minLen|8", "maxLen|18"],
					   typing: "typePhone"
					 },
					 {
					   label: "Email",
					   data: "SoldTo_Contact_Email",
					   required: true,
					   type: "text",
					   //placeholder: "Form067",
					   validation: ["isEmail", "maxLen|96"],
					   typing: "typeEmail"
					 },
					 {
					   label: "CountryOfResidence",
					   data: "SoldTo_Contact_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }
					 }
					]
				  ]
				}
			   ],
	callback: function() {
	  callbacks.page3();
	}
  };

  // PAYER INFORMATION [Config_PayerDetails != "Y"]
  const page4 = {
	title: "Form068",
	subtitle: "Form088",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		  {
			field: "Config_PayerDetails",
			operator: "neq",
			value: "Y"
		  },
		  {
			field: "Config_PPC_Payer",
			operator: "neq",
			value: "Y"
		  },
		]
	},
	structure: [{
	  header: "Address",
	  group: [
		[{
		  label: "Form086",
		  data: "Payer_PartyId",
		  required: false,
		  type: "text",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  //placeholder: "Form090",
		  typing: "kpDefault"
		}],
		[{
		  label: "Form058",
		  data: "Payer_CompanyName",
		  required: true,
		  type: "text",
		  //placeholder: "Form091",
		  validation: ["kpDefault", "minLen|2", "maxLen|140"],
		  typing: "kpDefault"
		},
		 {
		   label: "Address",
		   data: "Payer_Address_Street",
		   required: true,
		   type: "text",
		   //placeholder: "Form092",
		   validation: ["kpDefault", "minLen|2", "maxLen|55"],
		   typing: "kpDefault"
		 },
		 {
		   label: "AddressLineOptional",
		   data: "Payer_Address_Street2",
		   required: false,
		   type: "text",
		   //placeholder: "Form093",
		   validation: ["kpDefault", "minLen|2", "maxLen|50"],
		   typing: "kpDefault"
		 },
		 {
		   label: "City",
		   data: "Payer_Address_City",
		   required: true,
		   type: "text",
		   //placeholder: "Form094",
		   validation: ["kpDefault", "minLen|2", "maxLen|35"],
		   typing: "kpDefault"
		 },
		 {
		   label: "StateProvince",
		   data: "Payer_Address_State",
		   required: false,
		   type: "text",
		   //placeholder: "Form095",
		   validation: ["kpDefault", "minLen|2"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Postal code",
		   data: "Payer_Address_Postal",
		   required: true,
		   type: "text",
		   //placeholder: "Form096",
		   validation: ["kpDefault", "minLen|2", "maxLen|10"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Country",
		   data: "Payer_Address_Country",
		   required: true,
		   type: "select",
		   values: function() {
			 return reference.countriesArray
		   }
		 }
		]
	  ]
	},
				{
				  header: "Contact",
				  group: [
					[{
					  label: "FirstName",
					  data: "Payer_Contact_FirstName",
					  required: false,
					  type: "text",
					  //placeholder: "Form098",
					  validation: ["kpDefault", "minLen|1"],
					  typing: "kpDefault"
					},
					 {
					   label: "Surname",
					   data: "Payer_Contact_LastName",
					   required: false,
					   type: "text",
					   //placeholder: "Form099",
					   validation: ["kpDefault", "minLen|1", "maxLen|60"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Telephone",
					   data: "Payer_Contact_Phone",
					   required: false,
					   type: "text",
					   //placeholder: "1-888-666-5555",
					   validation: ["typePhone", "minLen|8", "maxLen|18"],
					   typing: "typePhone"
					 },
					 {
					   label: "Email",
					   data: "Payer_Contact_Email",
					   required: false,
					   type: "text",
					   //placeholder: "Form100",
					   validation: ["isEmail", "maxLen|96"],
					   typing: "typeEmail"
					 },
					 {
					   label: "CountryOfResidence",
					   data: "Payer_Contact_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }
					 }
					]
				  ]
				}
			   ],
	callback: function() {
	  callbacks.page4();
	}
  };

  // BILL INFORMATION [Config_BillToDetails != "Y"]
  const page5 = {
	title: "Form101",
	subtitle: "Form102",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		  {
			field: "Config_BillToDetails",
			operator: "neq",
			value: "Y"
		  },
		  {
			field: "Config_PPC_BillTo",
			operator: "neq",
			value: "Y"
		  },
		]
	},
	structure: [{
	  header: "Address",
	  group: [
		[{
		  label: "Form086",
		  data: "BillTo_PartyId",
		  required: false,
		  type: "text",
		  //placeholder: "Form104",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault"
		}],
		[{
		  label: "Form058",
		  data: "BillTo_CompanyName",
		  required: false,
		  type: "text",
		  //placeholder: "Form105",
		  validation: ["kpDefault", "minLen|2", "maxLen|140"],
		  typing: "kpDefault"
		},
		 {
		   label: "Address",
		   data: "BillTo_Address_Street",
		   required: false,
		   type: "text",
		   //placeholder: "Form106",
		   validation: ["kpDefault", "minLen|2", "maxLen|55"],
		   typing: "kpDefault"
		 },
		 {
		   label: "AddressLineOptional",
		   data: "BillTo_Address_Street2",
		   required: false,
		   type: "text",
		   //placeholder: "Form107",
		   validation: ["kpDefault", "minLen|2", "maxLen|50"],
		   typing: "kpDefault"
		 },
		 {
		   label: "City",
		   data: "BillTo_Address_City",
		   required: false,
		   type: "text",
		   //placeholder: "Form108",
		   validation: ["kpDefault", "minLen|2", "maxLen|35"],
		   typing: "kpDefault"
		 },
		 {
		   label: "StateProvince",
		   data: "BillTo_Address_State",
		   required: false,
		   type: "text",
		   //placeholder: "Form109",
		   validation: ["kpDefault", "minLen|2"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Postal code",
		   data: "BillTo_Address_Postal",
		   required: false,
		   type: "text",
		   //placeholder: "Form110",
		   validation: ["kpDefault", "minLen|2", "maxLen|10"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Country",
		   data: "BillTo_Address_Country",
		   required: false,
		   type: "select",
		   values: function() {
			 return reference.countriesArray
		   }
		 }
		]
	  ]
	},
				{
				  header: "Contact",
				  group: [
					[{
					  label: "FirstName",
					  data: "BillTo_Contact_FirstName",
					  required: false,
					  type: "text",
					  //placeholder: "Form111",
					  validation: ["kpDefault", "minLen|1"],
					  typing: "kpDefault"
					},
					 {
					   label: "Surname",
					   data: "BillTo_Contact_LastName",
					   required: false,
					   type: "text",
					   //placeholder: "Form112",
					   validation: ["kpDefault", "minLen|1", "maxLen|60"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Telephone",
					   data: "BillTo_Contact_Phone",
					   required: false,
					   type: "text",
					   //placeholder: "1-888-666-5555",
					   validation: ["typePhone", "minLen|8", "maxLen|18"],
					   typing: "typePhone"
					 },
					 {
					   label: "Email",
					   data: "BillTo_Contact_Email",
					   required: false,
					   type: "text",
					   //placeholder: "Form113",
					   validation: ["isEmail", "maxLen|96"],
					   typing: "typeEmail"
					 },
					 {
					   label: "CountryOfResidence",
					   data: "BillTo_Contact_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }

					 }
					]
				  ]
				}
			   ],
	callback: function() {
	  callbacks.page5();
	}
  };

  // SHIP TO INFORMATION
  const page6 = {
	title: "Form114",
	subtitle: "Form115",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		{
		  logic: "or",
		  filters: [
			{
			  field: "Config_ShipToDetails",
			  operator: "neq",
			  value: "Y"
			},
			{
			  field: "Config_ShipToDetails_Contact",
			  operator: "neq",
			  value: "Y"
			}
		  ]
		},
		{
		  field: "Config_PPC_ShipTo",
		  operator: "neq",
		  value: "Y"
		},
	  ]
	},
	structure: [{
	  header: "Address",
	  filter: {
		logic: "and",
		filters: [{
		  field: "Config_ShipToDetails",
		  operator: "neq",
		  value: "Y"
		},
				  {
					logic: "or",
					filters: [{
					  field: "ShipTo_PartyId",
					  operator: "doesnotstartwith",
					  value: "2"
					},
							  {
								field: "ShipTo_PartyId",
								operator: "isnull",
								value: "2"
							  }
							 ]
				  }
				 ]
	  },
	  group: [
		[{
		  label: "Form086",
		  data: "ShipTo_PartyId",
		  required: false,
		  type: "text",
		  //placeholder: "Form057",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault",
		}],
		[{
		  label: "Form058",
		  data: "ShipTo_CompanyName",
		  required: true,
		  type: "text",
		  //placeholder: "Form117",
		  validation: ["kpDefault", "minLen|2", "maxLen|140"],
		  typing: "kpDefault"
		},
		 {
		   label: "Address",
		   data: "ShipTo_Address_Street",
		   required: true,
		   type: "text",
		   //placeholder: "Form118",
		   validation: ["kpDefault", "minLen|2", "maxLen|55"],
		   typing: "kpDefault"
		 },
		 {
		   label: "AddressLineOptional",
		   data: "ShipTo_Address_Street2",
		   required: false,
		   type: "text",
		   //placeholder: "Form119",
		   validation: ["kpDefault", "minLen|2", "maxLen|50"],
		   typing: "kpDefault"
		 },
		 {
		   label: "City",
		   data: "ShipTo_Address_City",
		   required: true,
		   type: "text",
		   //placeholder: "Form120",
		   validation: ["kpDefault", "minLen|2", "maxLen|35"],
		   typing: "kpDefault"
		 },
		 {
		   label: "StateProvince",
		   data: "ShipTo_Address_State",
		   required: false,
		   type: "text",
		   //placeholder: "Form121",
		   validation: ["kpDefault", "minLen|2"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Postal code",
		   data: "ShipTo_Address_Postal",
		   required: true,
		   type: "text",
		   //placeholder: "Form122",
		   validation: ["kpDefault", "minLen|2", "maxLen|10"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Country",
		   data: "ShipTo_Address_Country",
		   required: true,
		   type: "select",
		   values: function() {
			 return reference.countriesArray
		   }
		 }
		]
	  ]
	},
				{
				  header: "Address",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_ShipToDetails",
					  operator: "neq",
					  value: "Y"
					},
							  {
								field: "ShipTo_PartyId",
								operator: "startswith",
								value: "2"
							  }
							 ]
				  },
				  group: [
					[{
					  label: "Form086",
					  data: "ShipTo_PartyId",
					  required: false,
					  type: "text",
					  //placeholder: "Form057",
					  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
					  typing: "kpDefault",
					}],
					[{
					  label: "Form058",
					  data: "ShipTo_CompanyName",
					  required: false,
					  type: "text",
					  //placeholder: "Form117",
					  validation: ["kpDefault", "minLen|2", "maxLen|140"],
					  typing: "kpDefault"
					},
					 {
					   label: "Address",
					   data: "ShipTo_Address_Street",
					   required: false,
					   type: "text",
					   //placeholder: "Form118",
					   validation: ["kpDefault", "minLen|2", "maxLen|55"],
					   typing: "kpDefault"
					 },
					 {
					   label: "AddressLineOptional",
					   data: "ShipTo_Address_Street2",
					   required: false,
					   type: "text",
					   //placeholder: "Form119",
					   validation: ["kpDefault", "minLen|2", "maxLen|50"],
					   typing: "kpDefault"
					 },
					 {
					   label: "City",
					   data: "ShipTo_Address_City",
					   required: false,
					   type: "text",
					   //placeholder: "Form120",
					   validation: ["kpDefault", "minLen|2", "maxLen|35"],
					   typing: "kpDefault"
					 },
					 {
					   label: "StateProvince",
					   data: "ShipTo_Address_State",
					   required: false,
					   type: "text",
					   //placeholder: "Form121",
					   validation: ["kpDefault", "minLen|2"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Postal code",
					   data: "ShipTo_Address_Postal",
					   required: false,
					   type: "text",
					   //placeholder: "Form122",
					   validation: ["kpDefault", "minLen|2", "maxLen|10"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Country",
					   data: "ShipTo_Address_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }
					 }
					]
				  ]
				},
				{
				  header: "",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_ShipToDetails",
					  operator: "neq",
					  value: "Y"
					}, {
					  field: "ShipTo_Address_Country",
					  operator: "in",
					  value: ["Mexico", "Turkey"]
					}]
				  },
				  group: [
					[{
					  label: "Form495",
					  data: "ShipTo_NationalID",
					  required: true,
					  type: "text",
					  validation: ["nationalID", "minLen|1", "maxLen|14"],
					  typing: "nationalID"
					}]
				  ]
				},
				{
				  header: "",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_ShipToDetails",
					  operator: "neq",
					  value: "Y"
					}, {
					  field: "ShipTo_Address_Country",
					  operator: "nin",
					  value: ["Mexico", "Turkey"]
					}]
				  },
				  group: [
					[{
					  label: "Form495",
					  data: "ShipTo_NationalID",
					  required: false,
					  type: "text",
					  validation: ["nationalID", "minLen|1", "maxLen|14"],
					  typing: "nationalID"
					}]
				  ]
				},
				{
				  header: "Contact",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_ShipToDetails_Contact",
					  operator: "neq",
					  value: "Y"
					}, {
					  field: "SoldTo_Address_Country",
					  operator: "neq",
					  value: "Korea (Rep.)"
					}]
				  },
				  group: [
					[{
					  label: "FirstName",
					  data: "ShipTo_Contact_FirstName",
					  required: false,
					  type: "text",
					  //placeholder: "Form124",
					  validation: ["kpDefault", "minLen|1"],
					  typing: "kpDefault"
					},
					 {
					   label: "Surname",
					   data: "ShipTo_Contact_LastName",
					   required: false,
					   type: "text",
					   //placeholder: "Form125",
					   validation: ["kpDefault", "minLen|1", "maxLen|60"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Telephone",
					   data: "ShipTo_Contact_Phone",
					   required: false,
					   type: "text",
					   //placeholder: "1-888-666-5555",
					   validation: ["typePhone", "minLen|8", "maxLen|18"],
					   typing: "typePhone"
					 },
					 {
					   label: "Email",
					   data: "ShipTo_Contact_Email",
					   required: false,
					   type: "text",
					   //placeholder: "Form218",
					   validation: ["isEmail", "maxLen|96"],
					   typing: "typeEmail"
					 },
					 {
					   label: "CountryOfResidence",
					   data: "ShipTo_Contact_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }
					 }
					]
				  ]
				},
				{
				  header: "Contact",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_ShipToDetails_Contact",
					  operator: "neq",
					  value: "Y"
					}, {
					  field: "SoldTo_Address_Country",
					  operator: "eq",
					  value: "Korea (Rep.)"
					}]
				  },
				  group: [
					[{
					  label: "FirstName",
					  data: "ShipTo_Contact_FirstName",
					  required: false,
					  type: "text",
					  //placeholder: "Form124",
					  validation: ["kpDefault", "minLen|1"],
					  typing: "kpDefault"
					},
					 {
					   label: "Surname",
					   data: "ShipTo_Contact_LastName",
					   required: true,
					   type: "text",
					   //placeholder: "Form125",
					   validation: ["kpDefault", "minLen|1", "maxLen|60"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Telephone",
					   data: "ShipTo_Contact_Phone",
					   required: true,
					   type: "text",
					   //placeholder: "1-888-666-5555",
					   validation: ["typePhone", "minLen|8", "maxLen|18"],
					   typing: "typePhone"
					 },
					 {
					   label: "Email",
					   data: "ShipTo_Contact_Email",
					   required: true,
					   type: "text",
					   //placeholder: "Form218",
					   validation: ["isEmail", "maxLen|96"],
					   typing: "typeEmail"
					 },
					 {
					   label: "CountryOfResidence",
					   data: "ShipTo_Contact_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }
					 }
					]
				  ]
				}
			   ],
	callback: function() {
	  callbacks.page6();
	}
  };

  // END CX INFORMATION
  const page7 = {
	title: "Form138",
	subtitle: "Form139",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		{
		  logic: "or",
		  filters: [
			{
			  field: "Config_EndCxDetails",
			  operator: "neq",
			  value: "Y"
			},
			{
			  field: "Config_EndCxDetails_Contact",
			  operator: "neq",
			  value: "Y"
			}
		  ]
		},
		{
		  field: "Config_PPC_EndCx",
		  operator: "neq",
		  value: "Y"
		},
	  ]
	},	
	structure: [{
	  header: "Address",
	  filter: {
		field: "Config_EndCxDetails",
		operator: "neq",
		value: "Y"
	  },
	  group: [
		[{
		  label: "Form086",
		  data: "EndCx_PartyId",
		  required: false,
		  type: "text",
		  //placeholder: "Form057",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault",
		}],
		[{
		  label: "Form058",
		  data: "EndCx_CompanyName",
		  required: true,
		  type: "text",
		  //placeholder: "Form141",
		  validation: ["kpDefault", "minLen|2", "maxLen|140"],
		  typing: "kpDefault"
		},
		 {
		   label: "Address",
		   data: "EndCx_Address_Street",
		   required: true,
		   type: "text",
		   //placeholder: "Form142",
		   validation: ["kpDefault", "minLen|2", "maxLen|55"],
		   typing: "kpDefault"
		 },
		 {
		   label: "AddressLineOptional",
		   data: "EndCx_Address_Street2",
		   required: false,
		   type: "text",
		   //placeholder: "Form143",
		   validation: ["kpDefault", "minLen|2", "maxLen|50"],
		   typing: "kpDefault"
		 },
		 {
		   label: "City",
		   data: "EndCx_Address_City",
		   required: true,
		   type: "text",
		   //placeholder: "Form144",
		   validation: ["kpDefault", "minLen|2", "maxLen|35"],
		   typing: "kpDefault"
		 },
		 {
		   label: "StateProvince",
		   data: "EndCx_Address_State",
		   required: false,
		   type: "text",
		   //placeholder: "Form145",
		   validation: ["kpDefault", "minLen|2"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Postal code",
		   data: "EndCx_Address_Postal",
		   required: true,
		   type: "text",
		   //placeholder: "Form146",
		   validation: ["kpDefault", "minLen|2", "maxLen|10"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Form219",
		   data: "EndCx_Address_Country",
		   required: true,
		   type: "select",
		   values: function() {
			 return reference.countriesArray
		   }
		 }
		]
	  ]
	},
				{
				  header: "",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_EndCxDetails",
					  operator: "neq",
					  value: "Y"
					}, {
					  field: "EndCx_Address_Country",
					  operator: "in",
					  value: ["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Turkey", "Puerto Rico"]
					}]
				  },
				  group: [
					[{
					  label: "Form495",
					  data: "EndCx_NationalID",
					  required: true,
					  type: "text",
					  validation: ["nationalID", "minLen|1", "maxLen|14"],
					  typing: "nationalID"
					}]
				  ]
				},
				{
				  header: "",
				  filter: {
					logic: "and",
					filters: [{
					  field: "Config_EndCxDetails",
					  operator: "neq",
					  value: "Y"
					}, {
					  field: "EndCx_Address_Country",
					  operator: "nin",
					  value: ["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Turkey", "Puerto Rico"]
					}]
				  },
				  group: [
					[{
					  label: "Form495",
					  data: "EndCx_NationalID",
					  required: false,
					  type: "text",
					  validation: ["nationalID", "minLen|1", "maxLen|14"],
					  typing: "nationalID"
					}]
				  ]
				},
				{
				  header: "Contact",
				  filter: {
					field: "Config_EndCxDetails_Contact",
					operator: "neq",
					value: "Y"
				  },
				  group: [
					[{
					  label: "FirstName",
					  data: "EndCx_Contact_FirstName",
					  required: false,
					  type: "text",
					  //placeholder: "Form149",
					  validation: ["kpDefault", "minLen|1"],
					  typing: "kpDefault"
					},
					 {
					   label: "Surname",
					   data: "EndCx_Contact_LastName",
					   required: true,
					   type: "text",
					   //placeholder: "Form150",
					   validation: ["kpDefault", "minLen|1", "maxLen|60"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Telephone",
					   data: "EndCx_Contact_Phone",
					   required: true,
					   type: "text",
					   //placeholder: "1-888-666-5555",
					   validation: ["typePhone", "minLen|8", "maxLen|18"],
					   typing: "typePhone"
					 },
					 {
					   label: "Email",
					   data: "EndCx_Contact_Email",
					   required: true,
					   type: "text",
					   //placeholder: "Form151",
					   validation: ["isEmail", "maxLen|96"],
					   typing: "typeEmail"
					 },
					 {
					   label: "CountryOfResidence",
					   data: "EndCx_Contact_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }
					 }
					]
				  ]
				}
			   ],
	callback: function() {
	  callbacks.page7();
	}
  };

  // RESELLER INFORMATION
  const page8 = {
	title: "Form126",
	subtitle: "Form127",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [
		{
		  field: "PartnerBRT",
		  operator: "in",
		  value: ["Distributor", "OEM Distributor", "System Integrator"]
		},
		{
		  logic: "and",
		  filters: [
			{
			  logic: "or",
			  filters: [
			{
			  field: "Config_ResellerDetails",
			  operator: "neq",
			  value: "Y"
			},
			{
			  field: "Config_ResellerDetails_Contact",
			  operator: "neq",
			  value: "Y"
			}
		  ]
		},
		{
		  field: "Config_PPC_Reseller",
		  operator: "neq",
		  value: "Y"
		},
	  ]
		},
		{
		  field: "PO_BusinessModel",
		  operator: "nin",
		  value: ["Agent Model", "HPFS & Agent Model"]
		},
		{
		  field: "PO_Category",
		  operator: "neq",
		  value: "Stock"
		}
	  ]
	},
	structure: [{
	  header: "Address",
	  filter: {
		logic: "and",
		filters: [{
		  field: "Config_ResellerDetails",
		  operator: "neq",
		  value: "Y"
		}]
	  },
	  group: [
		[{
		  label: "Form086",
		  data: "Reseller_PartyId",
		  required: false,
		  type: "text",
		  //placeholder: "Form057",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault"
		}],
		[

		  {
			label: "Form058",
			data: "Reseller_CompanyName",
			required: true,
			type: "text",
			//placeholder: "Form129",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		  {
			label: "Address",
			data: "Reseller_Address_Street",
			required: true,
			type: "text",
			//placeholder: "Form130",
			validation: ["kpDefault", "minLen|2", "maxLen|55"],
			typing: "kpDefault"
		  },
		  {
			label: "AddressLineOptional",
			data: "Reseller_Address_Street2",
			required: false,
			type: "text",
			//placeholder: "Form131",
			validation: ["kpDefault", "minLen|2", "maxLen|50"],
			typing: "kpDefault"
		  },
		  {
			label: "City",
			data: "Reseller_Address_City",
			required: true,
			type: "text",
			//placeholder: "Form132",
			validation: ["kpDefault", "minLen|2", "maxLen|35"],
			typing: "kpDefault"
		  },
		  {
			label: "StateProvince",
			data: "Reseller_Address_State",
			required: false,
			type: "text",
			//placeholder: "Form133",
			validation: ["kpDefault", "minLen|2"],
			typing: "kpDefault"
		  },
		  {
			label: "Postal code",
			data: "Reseller_Address_Postal",
			required: true,
			type: "text",
			//placeholder: "Form134",
			validation: ["kpDefault", "minLen|2", "maxLen|10"],
			typing: "kpDefault"
		  },
		  {
			label: "Country",
			data: "Reseller_Address_Country",
			required: true,
			type: "select",
			values: function() {
			  return reference.countriesArray
			}
		  },
		]
	  ]
	},
				/*{
                  header: "",
                  filter: {
                      logic: "and",
                      filters: [{
                          field: "Config_ResellerDetails",
                          operator: "neq",
                          value: "Y"
                      }, {
                          field: "Reseller_Address_Country",
                          operator: "in",
                          value: ["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"]
                      }]
                  },
                  group: [
                      [{
                          label: "Form495",
                          data: "Reseller_NationalID",
                          required: true,
                          type: "text",
                          //placeholder: "Form496",
                          validation: ["kpDefault", "minLen|1", "maxLen|14"],
                          typing: "kpDefault"
                      }]
                  ]
              },*/
				{
				  header: "Contact",
				  filter: {
					field: "Config_ResellerDetails_Contact",
					operator: "neq",
					value: "Y"
				  },
				  group: [
					[{
					  label: "FirstName",
					  data: "Reseller_Contact_FirstName",
					  required: false,
					  type: "text",
					  //placeholder: "Form135",
					  validation: ["kpDefault", "minLen|1"],
					  typing: "kpDefault"
					},
					 {
					   label: "Surname",
					   data: "Reseller_Contact_LastName",
					   required: true,
					   type: "text",
					   //placeholder: "Form136",
					   validation: ["kpDefault", "minLen|1", "maxLen|60"],
					   typing: "kpDefault"
					 },
					 {
					   label: "Telephone",
					   data: "Reseller_Contact_Phone",
					   required: false,
					   type: "text",
					   //placeholder: "1-888-666-5555",
					   validation: ["typePhone", "minLen|8", "maxLen|18"],
					   typing: "typePhone"
					 },
					 {
					   label: "Email",
					   data: "Reseller_Contact_Email",
					   required: true,
					   type: "text",
					   //placeholder: "Form137",
					   validation: ["isEmail", "maxLen|96"],
					   typing: "typeEmail"
					 },
					 {
					   label: "CountryOfResidence",
					   data: "Reseller_Contact_Country",
					   required: false,
					   type: "select",
					   values: function() {
						 return reference.countriesArray
					   }
					 }
					]
				  ]
				}
			   ],
	callback: function() {
	  callbacks.page8();
	}
  };

  // CUSTOM SHIP TO PARTY INFORMATION
  const page9 = {
	title: "Form486",
	subtitle: "Form487",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "or",
	  filters: [{
		logic: "and",
		filters: [{
		  field: "SubRegion",
		  operator: "eq",
		  value: "Latin America"
		},
				  {
					field: "PO_DeliveryIncoterms",
					operator: "neq",
					value: "DDP"
				  }
				 ]
	  },
				{
				  logic: "and",
				  filters: [{
					field: "SubRegion",
					operator: "eq",
					value: "North America"
				  },
							{
							  field: "PO_DeliveryIncoterms",
							  operator: "neq",
							  value: "DDP"
							}
						   ]
				}
			   ]
	},
	structure: [{
	  header: "Address",
	  group: [
		[{
		  label: "Form086",
		  data: "CustomShipTo_PartyId",
		  required: false,
		  type: "text",
		  //placeholder: "Form057",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault"
		}],
		[{
		  label: "Form058",
		  data: "CustomShipTo_CompanyName",
		  required: true,
		  type: "text",
		  //placeholder: "Form489",
		  validation: ["kpDefault", "minLen|2", "maxLen|140"],
		  typing: "kpDefault"
		},
		 {
		   label: "Address",
		   data: "CustomShipTo_Address",
		   required: true,
		   type: "text",
		   //placeholder: "Form490",
		   validation: ["kpDefault", "minLen|2", "maxLen|55"],
		   typing: "kpDefault"
		 },
		 {
		   label: "AddressLineOptional",
		   data: "CustomShipTo_Address_Street2",
		   required: false,
		   type: "text",
		   //placeholder: "Form491",
		   validation: ["kpDefault", "minLen|2", "maxLen|50"],
		   typing: "kpDefault"
		 },
		 {
		   label: "City",
		   data: "CustomShipTo_Address_City",
		   required: true,
		   type: "text",
		   //placeholder: "Form492",
		   validation: ["kpDefault", "minLen|2", "maxLen|35"],
		   typing: "kpDefault"
		 },
		 {
		   label: "StateProvince",
		   data: "CustomShipTo_Address_State",
		   required: false,
		   type: "text",
		   //placeholder: "Form493",
		   validation: ["kpDefault", "minLen|2"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Postal code",
		   data: "CustomShipTo_Address_Postal",
		   required: true,
		   type: "text",
		   //placeholder: "Form494",
		   validation: ["kpDefault", "minLen|2", "maxLen|10"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Country",
		   data: "CustomShipTo_Address_Country",
		   required: true,
		   type: "select",
		   values: function() {
			 return reference.countriesArray
		   }
		 }
		]
	  ]
	}],
	callback: function() {
	  callbacks.page9();
	}
  };

  // AGENT PROGRAM INFORMATION
  const page10 = {
	title: "Form500",
	subtitle: "Form501",
	description: "Form003",
	ready: false,
	nav: true,
	filter: {
	  logic: "and",
	  filters: [{
		logic: "or",
		filters: [{
		  field: "PartnerBRT",
		  operator: "eq",
		  value: "Distributor"
		},
				  {
					field: "PartnerBRT",
					operator: "eq",
					value: "OEM Distributor"
				  },
				  {
					field: "PartnerBRT",
					operator: "eq",
					value: "System Integrator"
				  }
				 ]
	  },
				{
				  logic: "or",
				  filters: [{
					field: "PO_BusinessModel",
					operator: "eq",
					value: "Agent Model"
				  },
							{
							  field: "PO_BusinessModel",
							  operator: "eq",
							  value: "HPFS & Agent Model"
							}
						   ]
				}
			   ]
	},
	structure: [{
	  header: "Address",
	  group: [
		[{
		  label: "Form086",
		  data: "AgentProgram_PartyId",
		  required: false,
		  type: "text",
		  //placeholder: "Form057",
		  validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
		  typing: "kpDefault"
		}],
		[{
		  label: "Form058",
		  data: "AgentProgram_CompanyName",
		  required: true,
		  type: "text",
		  //placeholder: "Form503",
		  validation: ["kpDefault", "minLen|2", "maxLen|140"],
		  typing: "kpDefault"
		},
		 {
		   label: "Address",
		   data: "AgentProgram_Address",
		   required: true,
		   type: "text",
		   //placeholder: "Form504",
		   validation: ["kpDefault", "minLen|2", "maxLen|55"],
		   typing: "kpDefault"
		 },
		 {
		   label: "AddressLineOptional",
		   data: "AgentProgram_Address_Street2",
		   required: false,
		   type: "text",
		   //placeholder: "Form505",
		   validation: ["kpDefault", "minLen|2", "maxLen|50"],
		   typing: "kpDefault"
		 },
		 {
		   label: "City",
		   data: "AgentProgram_Address_City",
		   required: true,
		   type: "text",
		   //placeholder: "Form506",
		   validation: ["kpDefault", "minLen|2", "maxLen|35"],
		   typing: "kpDefault"
		 },
		 {
		   label: "StateProvince",
		   data: "AgentProgram_Address_State",
		   required: false,
		   type: "text",
		   //placeholder: "Form507",
		   validation: ["kpDefault", "minLen|2"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Postal code",
		   data: "AgentProgram_Address_Postal",
		   required: true,
		   type: "text",
		   //placeholder: "Form508",
		   validation: ["kpDefault", "minLen|2", "maxLen|10"],
		   typing: "kpDefault"
		 },
		 {
		   label: "Country",
		   data: "AgentProgram_Address_Country",
		   required: true,
		   type: "select",
		   values: function() {
			 return reference.countriesArray
		   }
		 }
		]
	  ]
	}],
	callback: function() {
	  callbacks.page10();
	}
  };

  // ASSET LOCATION & ENTITLED PARTY & SYSTEM MANAGER
  const page11 = {
	title: "Form152",
	subtitle: "Form153",
	description: "Form003",
	ready: false,
	nav: true,
	structure: [
	  // optional attachment
	  {
		header: "FormCFI08",
		group: [
		  [{
			label: "FormCFI06",
			data: "Optional_Attachment",
			type: "kUpload",
			required: false,
			uploadConfig: {
			  formId: 989,
			  extensions: [".pdf", ".zip", ".xlxs", ".xls", ".xlsx", ".doc", ".docx", ".msg"],
			  maxFileSize: 4
			}
		  }],
		]
	  },
	  /*  {
          filter: {
            field: "PO_Category",
            operator: "neq",
            value: "Stock"
          },
          header: "FormCFI07",
          group: [
            [{
              label: "Form052",
              data: "Config_LocationDetails",
              value: "Y",
              required: false,
              type: "toggle",
              values: ["N", "Y"],
              options: ["No", "Yes"]
            },
             {
               label: "Form053",
               data: "Config_EntitledDetails",
               value: "Y",
               required: false,
               type: "toggle",
               values: ["N", "Y"],
               options: ["No", "Yes"]
             },
             {
               label: "Form528",
               data: "Config_PSP",
               required: false,
               type: "toggle",
               values: ["N", "Y"],
               options: ["No", "Yes"]
             }
            ]
          ]
        }*/
	  // INVOICE, RESERVATION, LOID, PLEDGING
	  {
		header: "Form154",
		description: "Form155",
		group: [
		  [{
			label: "Form156",
			data: "Config_PI",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]

	  },
	  {
		filter: {
		  field: "Config_PI",
		  operator: "eq",
		  value: "Y"
		},
		group: [
		  [{
			label: "Form157",
			data: "Config_SystemManager",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]

	  },
	  // SYSTEM MANAGER
	  {
		header: "Form158",
		filter: {
		  field: "Config_SystemManager",
		  operator: "eq",
		  value: "Y"
		},
		//description: "Form159",
		group: [
		  [{
			label: "FirstName",
			data: "EndCx_SysMng_FirstName",
			required: false,
			type: "text",
			//placeholder: "Form160",
			validation: ["kpDefault", "minLen|1"],
			typing: "kpDefault"
		  },
		   {
			 label: "LastName",
			 data: "EndCx_SysMng_LastName",
			 required: true,
			 type: "text",
			 //placeholder: "Form161",
			 validation: ["mixA", "minLen|1", "maxLen|60"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Telephone",
			 data: "EndCx_SysMng_Phone",
			 required: true,
			 type: "text",
			 //placeholder: "1-888-666-5555",
			 validation: ["typePhone", "minLen|8", "maxLen|18"],
			 typing: "typePhone"
		   },
		   {
			 label: "Email",
			 data: "EndCx_SysMng_Email",
			 required: true,
			 type: "text",
			 //placeholder: "Form162",
			 validation: ["isEmail", "maxLen|96"],
			 typing: "typeEmail"
		   },
		   {
			 label: "CountryOfResidence",
			 data: "EndCx_SysMng_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  // REMARKETING DETAILS
	  {
		/*header: "Remarketing details",
                  description: "Provide additional information, if available, for orders containing remarketing products",*/
		group: [
		  [{
			label: "Form163",
			data: "Config_ResId",
			required: false,
			type: "text",
			placeholder: "Form164",
			validation: ["alphanumeric", "minLen|1", "maxLen|30", "noBlanksv2"],
			typing: "alphanumeric"
		  },
		   {
			 label: "Form165",
			 data: "Config_LOID",
			 required: false,
			 type: "text",
			 placeholder: "Form166",
			 validation: ["alphanumeric", "minLen|1", "maxLen|30", "noBlanksv2"],
			 typing: "alphanumeric"
		   }
		  ]
		]
	  },
	  {
		/*header: "Remarketing details",
                  description: "Provide additional information, if available, for orders containing remarketing products",*/
		filter: {
		  field: "Region",
		  operator: "eq",
		  value: "EMEA"
		},
		group: [
		  [{
			label: "Form454",
			data: "Config_LogCode",
			required: false,
			type: "multiselect",
			values: ["AI", "AX", "BX", "CX", "I2", "L5", "PZ", "S5", "S7", "SH", "SW", "SY", "XA", "XP", "YX", "ZX"],
			options: ["Form454_Option1", "Form454_Option2", "Form454_Option3", "Form454_Option4", "Form454_Option5", "Form454_Option6", "Form454_Option7", "Form454_Option8", "Form454_Option9", "Form454_Option10", "Form454_Option11", "Form454_Option12", "Form454_Option13", "Form454_Option14", "Form454_Option15", "Form454_Option16"]
		  }]
		]
	  },
	  {
		group: [
		  [{
			label: "Form481",
			data: "Config_PublicSectionPartner",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		filter: {
		  logic: "and",
		  filters: [{
			field: "CountryCode",
			operator: "eq",
			value: "IT"
		  },
					{
					  field: "Config_PublicSectionPartner",
					  operator: "eq",
					  value: "Y"
					}
				   ]
		},
		group: [
		  [{
			label: "Form482",
			data: "Config_CIG",
			required: true,
			type: "text",
			placeholder: "Form483",
			validation: ["kpDefault", "minLen|1", "maxLen|40"],
			typing: "kpDefault"
		  },
		   {
			 label: "Form484",
			 data: "Config_CUP",
			 required: true,
			 type: "text",
			 placeholder: "Form485",
			 validation: ["kpDefault", "minLen|1", "maxLen|40"],
			 typing: "kpDefault"
		   }
		  ]
		]
	  },
	  // ASSET LOCATION
	  {
		/*	filter: {
            logic: "and",
            filters: [{
              logic: "or",
              filters: [{
                field: "Geo",
                operator: "in",
                value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
              },
                        {
                          field: "CountryCode",
                          operator: "in",
                          value: ["IL", "GR"]
                        }
                       ]
            }]
          },*/
		header: "Additional Address Information",
		description: "",
		group: [
		  [{
			label: "Form052",
			data: "Config_LocationDetails",
			value: "Y",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		header: "",
		description: "",
		header: "Form167",
		description: "Form168",
		filter: {
		  logic: "and",
		  filters: [{
			logic: "or",
			filters: [{
			  field: "Geo",
			  operator: "in",
			  value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
			},
					  {
						field: "CountryCode",
						operator: "in",
						value: ["IL", "GR"]
					  }
					 ]
		  },
					{
					  field: "Config_LocationDetails",
					  operator: "neq",
					  value: "Y"
					}
				   ]
		},
		group: [
		  [{
			label: "Form086",
			data: "AssLoc_PartyId",
			required: false,
			type: "text",
			//placeholder: "Form057",
			validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
			typing: "kpDefault"
		  }],
		  [{
			label: "Form058",
			data: "AssLoc_CompanyName",
			required: false,
			type: "text",
			//placeholder: "Form169",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Address",
			 data: "AssLoc_Address_Street",
			 required: false,
			 type: "text",
			 //placeholder: "Form170",
			 validation: ["kpDefault", "minLen|2", "maxLen|55"],
			 typing: "kpDefault"
		   },
		   {
			 label: "AddressLineOptional",
			 data: "AssLoc_Address_Street2",
			 required: false,
			 type: "text",
			 //placeholder: "Form171",
			 validation: ["kpDefault", "minLen|2", "maxLen|50"],
			 typing: "kpDefault"
		   },
		   {
			 label: "City",
			 data: "AssLoc_Address_City",
			 required: false,
			 type: "text",
			 //placeholder: "Form172",
			 validation: ["kpDefault", "minLen|2", "maxLen|35"],
			 typing: "kpDefault"
		   },
		   {
			 label: "StateProvince",
			 data: "AssLoc_Address_State",
			 required: false,
			 type: "text",
			 //placeholder: "Form173",
			 validation: ["kpDefault", "minLen|2"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Postal code",
			 data: "AssLoc_Address_Postal",
			 required: false,
			 type: "text",
			 //placeholder: "Form174",
			 validation: ["kpDefault", "minLen|2", "maxLen|10"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Country",
			 data: "AssLoc_Address_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  {
		header: "Form167",
		description: "Form168",
		filter: {
		  logic: "and",
		  filters: [{
			field: "Geo",
			operator: "nin",
			value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
		  },
					{
					  field: "CountryCode",
					  operator: "nin",
					  value: ["IL", "GR"]
					},
					{
					  field: "Config_LocationDetails",
					  operator: "neq",
					  value: "Y"
					}
				   ]
		},
		group: [
		  [{
			label: "Form086",
			data: "AssLoc_PartyId",
			required: false,
			type: "text",
			//placeholder: "Form057",
			validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
			typing: "kpDefault"
		  }],
		  [{
			label: "Form058",
			data: "AssLoc_CompanyName",
			required: false,
			type: "text",
			//placeholder: "Form169",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Address",
			 data: "AssLoc_Address_Street",
			 required: false,
			 type: "text",
			 //placeholder: "Form170",
			 validation: ["kpDefault", "minLen|2", "maxLen|55"],
			 typing: "kpDefault"
		   },
		   {
			 label: "AddressLineOptional",
			 data: "AssLoc_Address_Street2",
			 required: false,
			 type: "text",
			 //placeholder: "Form171",
			 validation: ["kpDefault", "minLen|2", "maxLen|50"],
			 typing: "kpDefault"
		   },
		   {
			 label: "City",
			 data: "AssLoc_Address_City",
			 required: false,
			 type: "text",
			 //placeholder: "Form172",
			 validation: ["kpDefault", "minLen|2", "maxLen|35"],
			 typing: "kpDefault"
		   },
		   {
			 label: "StateProvince",
			 data: "AssLoc_Address_State",
			 required: false,
			 type: "text",
			 //placeholder: "Form173",
			 validation: ["kpDefault", "minLen|2"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Postal code",
			 data: "AssLoc_Address_Postal",
			 required: false,
			 type: "text",
			 //placeholder: "Form174",
			 validation: ["kpDefault", "minLen|2", "maxLen|10"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Country",
			 data: "AssLoc_Address_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  // ENTITLED PARTY
	  {
		/*	filter: {
            logic: "and",
            filters: [{
              logic: "or",
              filters: [{
                field: "Geo",
                operator: "in",
                value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
              },
                        {
                          field: "CountryCode",
                          operator: "in",
                          value: ["IL", "GR"]
                        }
                       ]
            }]
          },*/
		header: "",
		description: "",
		group: [
		  [{
			label: "Form053",
			data: "Config_EntitledDetails",
			value: "Y",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		header: "Form175",
		description: "Form176",
		filter: {
		  logic: "and",
		  filters: [{
			logic: "or",
			filters: [{
			  field: "Geo",
			  operator: "in",
			  value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
			},
					  {
						field: "CountryCode",
						operator: "in",
						value: ["IL", "GR"]
					  }
					 ]
		  },
					{
					  field: "Config_EntitledDetails",
					  operator: "neq",
					  value: "Y"
					}
				   ]
		},
		group: [
		  [{
			label: "Form086",
			data: "EntPrty_PartyId",
			required: false,
			type: "text",
			//placeholder: "Form057",
			validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
			typing: "kpDefault"
		  }],
		  [{
			label: "Form058",
			data: "EntPrty_CompanyName",
			required: false,
			type: "text",
			//placeholder: "Form177",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Address",
			 data: "EntPrty_Address_Street",
			 required: false,
			 type: "text",
			 //placeholder: "Form175",
			 validation: ["kpDefault", "minLen|2", "maxLen|55"],
			 typing: "kpDefault"
		   },
		   {
			 label: "AddressLineOptional",
			 data: "EntPrty_Address_Street2",
			 required: false,
			 type: "text",
			 //placeholder: "Form178",
			 validation: ["kpDefault", "minLen|2", "maxLen|50"],
			 typing: "kpDefault"
		   },
		   {
			 label: "City",
			 data: "EntPrty_Address_City",
			 required: false,
			 type: "text",
			 //placeholder: "Form179",
			 validation: ["kpDefault", "minLen|2", "maxLen|35"],
			 typing: "kpDefault"
		   },
		   {
			 label: "StateProvince",
			 data: "EntPrty_Address_State",
			 required: false,
			 type: "text",
			 //placeholder: "Form180",
			 validation: ["kpDefault", "minLen|2"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Postal code",
			 data: "EntPrty_Address_Postal",
			 required: false,
			 type: "text",
			 //placeholder: "Form181",
			 validation: ["kpDefault", "minLen|2", "maxLen|10"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Country",
			 data: "EntPrty_Address_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  {
		header: "Form175",
		description: "Form176",
		filter: {
		  logic: "and",
		  filters: [{
			field: "Geo",
			operator: "nin",
			value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
		  },
					{
					  field: "CountryCode",
					  operator: "nin",
					  value: ["IL", "GR"]
					},
					{
					  field: "Config_EntitledDetails",
					  operator: "neq",
					  value: "Y"
					}
				   ]
		},
		group: [
		  [{
			label: "Form086",
			data: "EntPrty_PartyId",
			required: false,
			type: "text",
			//placeholder: "Form057",
			validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
			typing: "kpDefault"
		  }],
		  [{
			label: "Form058",
			data: "EntPrty_CompanyName",
			required: false,
			type: "text",
			//placeholder: "Form177",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Address",
			 data: "EntPrty_Address_Street",
			 required: false,
			 type: "text",
			 //placeholder: "Form175",
			 validation: ["kpDefault", "minLen|2", "maxLen|55"],
			 typing: "kpDefault"
		   },
		   {
			 label: "AddressLineOptional",
			 data: "EntPrty_Address_Street2",
			 required: false,
			 type: "text",
			 //placeholder: "Form178",
			 validation: ["kpDefault", "minLen|2", "maxLen|50"],
			 typing: "kpDefault"
		   },
		   {
			 label: "City",
			 data: "EntPrty_Address_City",
			 required: false,
			 type: "text",
			 //placeholder: "Form179",
			 validation: ["kpDefault", "minLen|2", "maxLen|35"],
			 typing: "kpDefault"
		   },
		   {
			 label: "StateProvince",
			 data: "EntPrty_Address_State",
			 required: false,
			 type: "text",
			 //placeholder: "Form180",
			 validation: ["kpDefault", "minLen|2"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Postal code",
			 data: "EntPrty_Address_Postal",
			 required: false,
			 type: "text",
			 //placeholder: "Form181",
			 validation: ["kpDefault", "minLen|2", "maxLen|10"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Country",
			 data: "EntPrty_Address_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  {
		header: "Form182",
		filter: {
		  logic: "and",
		  filters: [{
			field: "Config_EntitledDetails",
			operator: "neq",
			value: "Y"
		  }]
		},
		group: [
		  [{
			label: "FirstName",
			data: "EntPrty_Contact_FirstName",
			required: false,
			type: "text",
			//placeholder: "Form183",
			validation: ["kpDefault", "minLen|1"],
			typing: "kpDefault"
		  },
		   {
			 label: "Surname",
			 data: "EntPrty_Contact_LastName",
			 required: false,
			 type: "text",
			 //placeholder: "Form184",
			 validation: ["kpDefault", "minLen|1", "maxLen|60"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Telephone",
			 data: "EntPrty_Contact_Phone",
			 required: false,
			 type: "text",
			 //placeholder: "1-888-666-5555",
			 validation: ["typePhone", "minLen|8", "maxLen|18"],
			 typing: "typePhone"
		   },
		   {
			 label: "Email",
			 data: "EntPrty_Contact_Email",
			 required: false,
			 type: "text",
			 //placeholder: "Form185",
			 validation: ["isEmail", "maxLen|96"],
			 typing: "typeEmail"
		   },
		   {
			 label: "CountryOfResidence",
			 data: "EntPrty_Contact_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  {
		header: "",
		description: "",
		/*	filter: {
            logic: "and",
            filters: [{
              logic: "or",
              filters: [{
                field: "Geo",
                operator: "in",
                value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
              },
                        {
                          field: "CountryCode",
                          operator: "in",
                          value: ["IL", "GR"]
                        }
                       ]
            }]
          },*/
		group: [
		  [{
			label: "Form528",
			data: "Config_PSP",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		//header: "Form167",
		//description: "Form168",
		header: "Form529",
		description: "FormCFI09",
		filter: {
		  logic: "and",
		  filters: [{
			logic: "or",
			filters: [{
			  field: "Geo",
			  operator: "in",
			  value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
			},
					  {
						field: "CountryCode",
						operator: "in",
						value: ["IL", "GR"]
					  }
					 ]
		  },
					{
					  field: "Config_PSP",
					  operator: "eq",
					  value: "Y"
					}
				   ]
		},
		group: [
		  [{
			label: "Form086",
			data: "PSP_PartyId",
			required: false,
			type: "text",
			//placeholder: "Form057",
			validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
			typing: "kpDefault"
		  }],
		  [{
			label: "Form058",
			data: "PSP_CompanyName",
			required: false,
			type: "text",
			//placeholder: "Form169",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Address",
			 data: "PSP_Address_Street",
			 required: false,
			 type: "text",
			 //placeholder: "Form170",
			 validation: ["kpDefault", "minLen|2", "maxLen|55"],
			 typing: "kpDefault"
		   },
		   {
			 label: "AddressLineOptional",
			 data: "PSP_Address_Street2",
			 required: false,
			 type: "text",
			 //placeholder: "Form171",
			 validation: ["kpDefault", "minLen|2", "maxLen|50"],
			 typing: "kpDefault"
		   },
		   {
			 label: "City",
			 data: "PSP_Address_City",
			 required: false,
			 type: "text",
			 //placeholder: "Form172",
			 validation: ["kpDefault", "minLen|2", "maxLen|35"],
			 typing: "kpDefault"
		   },
		   {
			 label: "StateProvince",
			 data: "PSP_Address_State",
			 required: false,
			 type: "text",
			 //placeholder: "Form173",
			 validation: ["kpDefault", "minLen|2"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Postal code",
			 data: "PSP_Address_Postal",
			 required: false,
			 type: "text",
			 //placeholder: "Form174",
			 validation: ["kpDefault", "minLen|2", "maxLen|10"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Country",
			 data: "PSP_Address_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  {
		header: "Form529",
		description: "FormCFI09",
		filter: {
		  logic: "and",
		  filters: [{
			field: "Geo",
			operator: "nin",
			value: ["CERTA", "CETA", "MESA", "Latin America", "North America"]
		  },
					{
					  field: "CountryCode",
					  operator: "nin",
					  value: ["IL", "GR"]
					},
					{
					  field: "Config_PSP",
					  operator: "eq",
					  value: "Y"
					}
				   ]
		},
		group: [
		  [{
			label: "Form086",
			data: "PSP_PartyId",
			required: false,
			type: "text",
			//placeholder: "Form057",
			validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
			typing: "kpDefault"
		  }],
		  [{
			label: "Form058",
			data: "PSP_CompanyName",
			required: false,
			type: "text",
			//placeholder: "Form169",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Address",
			 data: "PSP_Address_Street",
			 required: false,
			 type: "text",
			 //placeholder: "Form170",
			 validation: ["kpDefault", "minLen|2", "maxLen|55"],
			 typing: "kpDefault"
		   },
		   {
			 label: "AddressLineOptional",
			 data: "PSP_Address_Street2",
			 required: false,
			 type: "text",
			 //placeholder: "Form171",
			 validation: ["kpDefault", "minLen|2", "maxLen|50"],
			 typing: "kpDefault"
		   },
		   {
			 label: "City",
			 data: "PSP_Address_City",
			 required: false,
			 type: "text",
			 //placeholder: "Form172",
			 validation: ["kpDefault", "minLen|2", "maxLen|35"],
			 typing: "kpDefault"
		   },
		   {
			 label: "StateProvince",
			 data: "PSP_Address_State",
			 required: false,
			 type: "text",
			 //placeholder: "Form173",
			 validation: ["kpDefault", "minLen|2"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Postal code",
			 data: "PSP_Address_Postal",
			 required: false,
			 type: "text",
			 //placeholder: "Form174",
			 validation: ["kpDefault", "minLen|2", "maxLen|10"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Country",
			 data: "PSP_Address_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  {
		header: "",
		description: "",
		filter: {
		  field: "CountryCode",
		  operator: "eq",
		  value: "JP",
		},
		group: [
		  [{
			label: "Form240",
			data: "Config_ALI",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		header: "Form241",
		description: "",
		filter: {
		  logic: "and",
		  filters: [{
			field: "CountryCode",
			operator: "eq",
			value: "JP"
		  },
					{
					  field: "Config_ALI",
					  operator: "eq",
					  value: "Y"
					}]
		},
		group: [
		  [{
			label: "Form086",
			data: "ALI_PartyId",
			required: false,
			type: "text",
			validation: ["kpDefault", "minLen|2", "maxLen|10", "noBlanksv2"],
			typing: "kpDefault"
		  }],
		  [{
			label: "Form058",
			data: "ALI_CompanyName",
			required: false,
			type: "text",
			validation: ["kpDefault", "minLen|2", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Address",
			 data: "ALI_Address_Street",
			 required: false,
			 type: "text",
			 validation: ["kpDefault", "minLen|2", "maxLen|55"],
			 typing: "kpDefault"
		   },
		   {
			 label: "AddressLineOptional",
			 data: "ALI_Address_Street2",
			 required: false,
			 type: "text",
			 validation: ["kpDefault", "minLen|2", "maxLen|50"],
			 typing: "kpDefault"
		   },
		   {
			 label: "City",
			 data: "ALI_Address_City",
			 required: false,
			 type: "text",
			 validation: ["kpDefault", "minLen|2", "maxLen|35"],
			 typing: "kpDefault"
		   },
		   {
			 label: "StateProvince",
			 data: "ALI_Address_State",
			 required: false,
			 type: "text",
			 validation: ["kpDefault", "minLen|2"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Postal code",
			 data: "ALI_Address_Postal",
			 required: false,
			 type: "text",
			 validation: ["kpDefault", "minLen|2", "maxLen|10"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Country",
			 data: "ALI_Address_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ],
		  [{
			label: "FirstName",
			data: "ALI_Contact_FirstName",
			required: false,
			type: "text",
			validation: ["kpDefault", "minLen|1"],
			typing: "kpDefault"
		  },
		   {
			 label: "Surname",
			 data: "ALI_Contact_LastName",
			 required: false,
			 type: "text",
			 validation: ["kpDefault", "minLen|1", "maxLen|60"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Telephone",
			 data: "ALI_Contact_Phone",
			 required: false,
			 type: "text",
			 validation: ["typePhone", "minLen|8", "maxLen|18"],
			 typing: "typePhone"
		   },
		   {
			 label: "Email",
			 data: "ALI_Contact_Email",
			 required: false,
			 type: "text",
			 validation: ["isEmail", "maxLen|96"],
			 typing: "typeEmail"
		   },
		   {
			 label: "CountryOfResidence",
			 data: "ALI_Contact_Country",
			 required: false,
			 type: "select",
			 values: function() {
			   return reference.countriesArray
			 }
		   }
		  ]
		]
	  },
	  {
		header: "Form243",
		description: "",
		filter: {
		  field: "CountryCode",
		  operator: "eq",
		  value: "JP"
		},
		group: [
		  [{
			label: "Form242",
			data: "Config_CombinedOrder",
			required: false,
			type: "toggle",
			values: ["N", "Y"],
			options: ["No", "Yes"]
		  }]
		]
	  },
	  {
		header: "",
		description: "",
		filter: {
		  logic: "and",
		  filters: [{
			field: "CountryCode",
			operator: "eq",
			value: "JP"
		  },
					{
					  field: "Config_CombinedOrder",
					  operator: "eq",
					  value: "Y"
					}]
		},
		group: [
		  [{
			label: "Form244",
			data: "CombinedOrder_Team",
			required: true,
			type: "text",
			validation: ["kpDefault", "minLen|1", "maxLen|140"],
			typing: "kpDefault"
		  },
		   {
			 label: "Form245",
			 data: "CombinedOrder_Total",
			 required: true,
			 type: "text",
			 validation: ["kpDefault", "minLen|1", "maxLen|140"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Form246",
			 data: "CombinedOrder_SharePointID",
			 required: true,
			 type: "text",
			 validation: ["kpDefault", "minLen|1", "maxLen|140"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Form247",
			 data: "CombinedOrder_Owner",
			 required: true,
			 type: "text",
			 validation: ["kpDefault", "minLen|2", "maxLen|140"],
			 typing: "kpDefault"
		   },
		  ],
		]
	  },
	],
	callback: function() {
	  callbacks.page11();
	},
	validation: function() {
	  var result = {
		fail: [],
		pass: []
	  };
	  var Optional_Attachment = document.querySelector('input[data-name=Optional_Attachment]');
	  if (Optional_Attachment.value) result.pass.push(Optional_Attachment);
	  return result;
	}
  };

  // COMMENTS
  const page12 = {
	title: "Form186",
	subtitle: "Form187",
	description: "Form003",
	ready: false,
	nav: true,
	structure: [
	  // COMMENTS
	  {
		header: "Form186",
		description: "Form188",
		group: [
		  [{
			label: "Form189",
			data: "Comment_Tax",
			required: false,
			type: "textarea",
			placeholder: "Form190",
			validation: ["kpDefault"],
			typing: "kpDefault"
		  },
		   {
			 label: "Form191",
			 data: "Comment_Invoice",
			 required: false,
			 type: "textarea",
			 placeholder: "Form192",
			 validation: ["kpDefault"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Form193",
			 data: "Comment_Delivery",
			 required: false,
			 type: "textarea",
			 placeholder: "Form220",
			 validation: ["kpDefault"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Form195",
			 data: "Comment_Packing",
			 required: false,
			 type: "textarea",
			 placeholder: "Form196",
			 validation: ["kpDefault"],
			 typing: "kpDefault"
		   },
		   {
			 label: "Form197",
			 data: "Comment_Extra",
			 required: false,
			 type: "textarea",
			 placeholder: "Form198",
			 validation: ["kpDefault"],
			 typing: "kpDefault"
		   }
		  ]
		]
	  }
	],
	callback: function() {
	  callbacks.page12();
	}
  };

  // OVERVIEW PAGE
  const overviewPage = {
	title: "Form221",
	subtitle: "Form222",
	ready: false,
	nav: true,
	structure: [{
	  hidden: false,
	  group: [
		[{
		  data: "CFI",
		  type: "hidden"
		}]
	  ]
	}],
	callback: function() {
	  // POPULATE ORID
	  var orid = document.querySelectorAll(".header .ORID");
	  for (i = 0; i < orid.length; i++) orid[i].innerText = config.dataset.EntryId;
	  document.querySelector('input[data-name="CFI"]').parentElement.parentElement.parentElement.parentElement.classList.add("output");
	  //document.querySelector('input[data-name="CFI"]').parentElement.parentElement.parentElement.parentElement.innerHTML = '';
	  // CONFIGURATION FOR DATA REVIEW UI
	  var reviewSetup = {
		request: {
		  title: hpe.fn.lang('Form201', config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang('Form443', config.locale, config.localizations), "EntryId"],
			[hpe.fn.lang('Form444', config.locale, config.localizations), "SubmittedTimestamp"],
			[hpe.fn.lang('Form445', config.locale, config.localizations), "Status"],
			[hpe.fn.lang('Form446', config.locale, config.localizations), "PO_Order_ID"],
			[hpe.fn.lang('Form44x', config.locale, config.localizations), "SuccessResult"],
			[hpe.fn.lang('Form447', config.locale, config.localizations), "Email"],
			[hpe.fn.lang('Form086', config.locale, config.localizations), "PartyId"]
		  ]
		},
		po: {
		  title: hpe.fn.lang("Form202", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form462", config.locale, config.localizations), "PO_BackgroundGroup"],
			[hpe.fn.lang("Form514", config.locale, config.localizations), "PO_HPEEntity"],
			[hpe.fn.lang("Form465", config.locale, config.localizations), "PO_BusinessModel"],
			[hpe.fn.lang("Form005", config.locale, config.localizations), "PO_Number"],
			[hpe.fn.lang("Form007", config.locale, config.localizations), "PO_Currency"],
			[hpe.fn.lang("Form335", config.locale, config.localizations), "PO_Value"],
			[hpe.fn.lang("Form334", config.locale, config.localizations), "PO_Category"],
			[hpe.fn.lang("Form014", config.locale, config.localizations), "Rs_PO_Number"],
			[hpe.fn.lang("Form016", config.locale, config.localizations), "Cx_PO_Number"],
			[hpe.fn.lang("Form024", config.locale, config.localizations), "PA_Number"],
			[hpe.fn.lang("Form026", config.locale, config.localizations), "Payment_Terms"],
			[hpe.fn.lang("Form530", config.locale, config.localizations), "Config_aaS"],
			[hpe.fn.lang("Form337", config.locale, config.localizations), "Requestor_PO_Quote_ID"],
			[hpe.fn.lang("Form456", config.locale, config.localizations), "Config_UCID"],
			[hpe.fn.lang("Form458", config.locale, config.localizations), "Config_UCIDQ"],
			[hpe.fn.lang("Form460", config.locale, config.localizations), "Config_ConfigId"],
			[hpe.fn.lang("Form021", config.locale, config.localizations), "Requestor_PO_Deal_ID"],
			[hpe.fn.lang("Form026", config.locale, config.localizations), "Requestor_PO_Opp_ID"],
			[hpe.fn.lang("Form039", config.locale, config.localizations), "PO_DeliveryDate"],
			[hpe.fn.lang("Form476", config.locale, config.localizations), "PO_DeliveryIncoterms"],
			/*[hpe.fn.lang("Form215", config.locale, config.localizations), "Notification_CC"],*/
			[hpe.fn.lang("Form336", config.locale, config.localizations), "PO_Attachment"],
			/*[hpe.fn.lang("Form041", config.locale, config.localizations), "Config_SoldToDetails"],
                          [hpe.fn.lang("Form042", config.locale, config.localizations), "Config_SoldToDetails_Contact"],
                          [hpe.fn.lang("Form043", config.locale, config.localizations), "Config_PayerDetails"],
                          [hpe.fn.lang("Form044", config.locale, config.localizations), "Config_BillToDetails"],
                          [hpe.fn.lang("Form047", config.locale, config.localizations), "Config_ShipToDetails"],
                          [hpe.fn.lang("Form048", config.locale, config.localizations), "Config_ShipToDetails_Contact"],*/
			//[hpe.fn.lang("Form522", config.locale, config.localizations), "Config_Tier1"],
			[hpe.fn.lang("Form523", config.locale, config.localizations), "Config_Business_Justification"],
			/*[hpe.fn.lang("Form525", config.locale, config.localizations), "Config_Tier2"],
                          [hpe.fn.lang("Form526", config.locale, config.localizations), "Config_Shipment_India"],
                          [hpe.fn.lang("Form527", config.locale, config.localizations), "Config_OEM"],
                          [hpe.fn.lang("Form052", config.locale, config.localizations), "Config_LocationDetails"],
                          [hpe.fn.lang("Form053", config.locale, config.localizations), "Config_EntitledDetails"]*/



		  ]
		},
		soldto: {
		  title: hpe.fn.lang("Form054", config.locale, config.localizations),
		  filter: {
			field: "Config_SoldToDetails",
			operator: "neq",
			value: "Y"
		  },
		  /*  filter: {
              logic: "or",
              filters: [{
                field: "Config_SoldToDetails",
                operator: "neq",
                value: "Y"
              },
                        {
                          field: "Config_SoldToDetails_Contact",
                          operator: "neq",
                          value: "Y"
                        }
                       ]
            },*/
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "SoldTo_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "SoldTo_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "SoldTo_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "SoldTo_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "SoldTo_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "SoldTo_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "SoldTo_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "SoldTo_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "SoldTo_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "SoldTo_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "SoldTo_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "SoldTo_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "SoldTo_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "SoldTo_Contact_Country"]
		  ]
		},
		payer: {
		  title: hpe.fn.lang("Form206", config.locale, config.localizations),
		  filter: {
			field: "Config_PayerDetails",
			operator: "neq",
			value: "Y"
		  },
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "Payer_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "Payer_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "Payer_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "Payer_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "Payer_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "Payer_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "Payer_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "Payer_Address_Country"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "Payer_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "Payer_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "Payer_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "Payer_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "Payer_Contact_Country"]
		  ]
		},
		billto: {
		  title: hpe.fn.lang("Form204", config.locale, config.localizations),
		  filter: {
			field: "Config_BillToDetails",
			operator: "neq",
			value: "Y"
		  },
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "BillTo_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "BillTo_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "BillTo_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "BillTo_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "BillTo_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "BillTo_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "BillTo_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "BillTo_Address_Country"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "BillTo_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "BillTo_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "BillTo_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "BillTo_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "BillTo_Contact_Country"]
		  ]
		},
		shipping: {
		  title: hpe.fn.lang("Form205", config.locale, config.localizations),
		  filter: {
			logic: "or",
			filters: [{
			  field: "Config_ShipToDetails",
			  operator: "neq",
			  value: "Y"
			},
					  {
						field: "Config_ShipToDetails_Contact",
						operator: "neq",
						value: "Y"
					  }
					 ]
		  },
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "ShipTo_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "ShipTo_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "ShipTo_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "ShipTo_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "ShipTo_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "ShipTo_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "ShipTo_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "ShipTo_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "ShipTo_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "ShipTo_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "ShipTo_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "ShipTo_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "ShipTo_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "ShipTo_Contact_Country"]
		  ]
		},
		reseller: {
		  title: hpe.fn.lang("Form126", config.locale, config.localizations),
		  filter: {
			logic: "or",
			filters: [{
			  field: "Config_ResellerDetails",
			  operator: "neq",
			  value: "Y"
			},
					  {
						field: "Config_ResellerDetails_Contact",
						operator: "neq",
						value: "Y"
					  }
					 ]
		  },
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "Reseller_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "Reseller_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "Reseller_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "Reseller_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "Reseller_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "Reseller_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "Reseller_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "Reseller_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "Reseller_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "Reseller_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "Reseller_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "Reseller_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "Reseller_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "Reseller_Contact_Country"]
		  ]
		},
		endcx: {
		  title: hpe.fn.lang("Form138", config.locale, config.localizations),
		  filter: {
			logic: "or",
			filters: [{
			  field: "Config_EndCxDetails",
			  operator: "neq",
			  value: "Y"
			},
					  {
						field: "Config_EndCxDetails_Contact",
						operator: "neq",
						value: "Y"
					  }
					 ]
		  },
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "EndCx_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "EndCx_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "EndCx_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "EndCx_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "EndCx_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "EndCx_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "EndCx_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "EndCx_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "EndCx_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "EndCx_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "EndCx_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "EndCx_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "EndCx_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "EndCx_Contact_Country"]
		  ]
		},
		customershipto: {
		  title: hpe.fn.lang("Form486", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "CustomShipTo_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "CustomShipTo_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "CustomShipTo_Address"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "CustomShipTo_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "CustomShipTo_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "CustomShipTo_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "CustomShipTo_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "CustomShipTo_Address_Country"]
		  ]
		},
		agentprogram: {
		  title: hpe.fn.lang("Form500", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "AgentProgram_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "AgentProgram_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "AgentProgram_Address"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "AgentProgram_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "AgentProgram_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "AgentProgram_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "AgentProgram_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "AgentProgram_Address_Country"]
		  ]
		},
		additionalinfo: {
		  title: hpe.fn.lang("Form152", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("FormCFI08", config.locale, config.localizations), "Optional_Attachment"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "EndCx_SysMng_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "EndCx_SysMng_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "EndCx_SysMng_Phone"],
			[hpe.fn.lang("Email", config.locale, config.localizations), "EndCx_SysMng_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "EndCx_SysMng_Country"],
			[hpe.fn.lang("Form086", config.locale, config.localizations), "PSP_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "PSP_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "PSP_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "PSP_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "PSP_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "PSP_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "PSP_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "PSP_Address_Country"],
			[hpe.fn.lang("Form163", config.locale, config.localizations), "Config_ResId"],
			[hpe.fn.lang("Form165", config.locale, config.localizations), "Config_LOID"],
			[hpe.fn.lang("Form454", config.locale, config.localizations), "Config_LogCode"],
			[hpe.fn.lang("Form482", config.locale, config.localizations), "Config_CIG"],
			[hpe.fn.lang("Form484", config.locale, config.localizations), "Config_CUP"],
			[hpe.fn.lang("Form086", config.locale, config.localizations), "AssLoc_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "AssLoc_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "AssLoc_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "AssLoc_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "AssLoc_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "AssLoc_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "AssLoc_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "AssLoc_Address_Country"],
			[hpe.fn.lang("Form086", config.locale, config.localizations), "EntPrty_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "EntPrty_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "EntPrty_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "EntPrty_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "EntPrty_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "EntPrty_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "EntPrty_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "EntPrty_Address_Country"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "EntPrty_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "EntPrty_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "EntPrty_Contact_Phone"],
			[hpe.fn.lang("Email", config.locale, config.localizations), "EntPrty_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "EntPrty_Contact_Country"],
		  ]
		},
		comments: {
		  title: hpe.fn.lang("Form207", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form442", config.locale, config.localizations), "Comment_Tax"],
			[hpe.fn.lang("Form191", config.locale, config.localizations), "Comment_Invoice"],
			[hpe.fn.lang("Form193", config.locale, config.localizations), "Comment_Delivery"],
			[hpe.fn.lang("Form195", config.locale, config.localizations), "Comment_Packing"],
			[hpe.fn.lang("Form197", config.locale, config.localizations), "Comment_Extra"]
		  ]
		}
	  };
	  var app = document.querySelector(".output");
	  document.querySelector(".output").innerHTML += '<div id="msg" class="active nfo"><p>' + hpe.fn.lang("InfoCurrent", config.locale, config.localizations) + '</p><span></span></div>';
	  $('#msg.nfo').show();

	  let objK = Object.keys(reviewSetup);
	  for (i = 0; i < objK.length; i++) {
		let key = objK[i];
		if (key == "customershipto") {
		  var main = reviewSetup[key];
		  var filterobj = {};
		  if (["Latin America", "North America"].indexOf(global.data.geo.geography) == -1) {
			filterobj = {
			  "field": "SubRegion",
			  "operator": "eq",
			  "value": config.dataset.SubRegion
			};
		  } else {
			filterobj = {
			  "field": "PO_DeliveryIncoterms",
			  "operator": "neq",
			  "value": "DDP"
			};
		  }
		  var mergeobj = Object.assign(main, {
			"filter": filterobj
		  });
		  reviewSetup[key] = mergeobj;
		} else if (key == "agentprogram") {
		  var main = reviewSetup[key];
		  if (["Latin America", "North America"].indexOf(global.data.geo.geography) == -1) {
			var subRegionFilterObj = {
			  "field": "SubRegion",
			  "operator": "eq",
			  "value": global.data.geo.subregion
			};
			var mergeobj = Object.assign(main, {
			  "filter": subRegionFilterObj
			});
			reviewSetup[key] = mergeobj;
		  } else {
			if (global.data.brt.name == "Distributor") {
			  var businessModelFilterObj = [{
				"field": "PO_BusinessModel",
				"operator": "eq",
				"value": "Agent Model"
			  },
											{
											  "field": "PO_BusinessModel",
											  "operator": "eq",
											  "value": "HPFS & Agent Model"
											}
										   ];
			  var filters = {
				logic: "or",
				filters: businessModelFilterObj
			  }
			  var mergeobj = Object.assign(main, {
				"filter": filters
			  });
			  reviewSetup[key] = mergeobj;
			} else {
			  var partnerBRTFilterObj = {
				"field": "PartnerBRT",
				"operator": "eq",
				"value": "Distributor"
			  };
			  var mergeobj = Object.assign(main, {
				"filter": partnerBRTFilterObj
			  });
			  reviewSetup[key] = mergeobj;
			}
		  }
		} else if (key == "endcx") {
		  var POOptionalValidArray = ["Latin America", "Central Europe", "UKIMESA", "CERTA", "MESA", "North America"];
		  if (POOptionalValidArray.indexOf(global.data.geo.geography) > -1) {
			var main = reviewSetup[key];
			var FilterObj = {
			  "field": "PO_Category",
			  "operator": "neq",
			  "value": "Stock"
			};
			var mergeobj = Object.assign(main, {
			  "filter": FilterObj
			});
			reviewSetup[key] = mergeobj;
		  }
		} else if (key == "reseller") {
		  var POOptionalValidArray = ["Latin America", "Central Europe", "UKIMESA", "CERTA", "MESA", "North America"];
		  if (POOptionalValidArray.indexOf(global.data.geo.geography) > -1) {
			if (global.BRT != "Distributor") {
			  var main = reviewSetup[key];
			  var FilterObj = {
				"field": "PartnerBRT",
				"operator": "eq",
				"value": "Distributor"
			  };

			  var mergeobj = Object.assign(main, {
				"filter": FilterObj
			  });
			  reviewSetup[key] = mergeobj;
			} else {
			  var main = reviewSetup[key];
			  var FilterObj = [{
				"field": "PO_BusinessModel",
				"operator": "notcontains",
				"value": "Agent Model"
			  },
							   {
								 "field": "PO_Category",
								 "operator": "neq",
								 "value": "Stock"
							   }
							  ];
			  var filters = {
				logic: "and",
				filters: FilterObj
			  }
			  var mergeobj = Object.assign(main, {
				"filter": filters
			  });
			  reviewSetup[key] = mergeobj;
			}
		  }
		}
		var filter = true;
		if (typeof(reviewSetup[key].filter) === "object") filter = nbsf.fn.filter(config.dataset, reviewSetup[key].filter);
		if (reviewSetup[key].fieldset.length > 0 && filter) {
		  console.log('reviewSetup[key]', reviewSetup[key]);
		  if (app.querySelector(".row[review-id=" + key + "]") == null)
			app.innerHTML += '<div class="row" review-id="' + key + '"><h4>' + reviewSetup[key].title + '</h4></div>';
		  var row = app.querySelector(".row[review-id=" + key + "]");
		  var headerchk = false;
		  for (j = 0; j < reviewSetup[key].fieldset.length; j++) {
			var item = reviewSetup[key].fieldset[j];
			var label = item[0];
			var value = config.dataset[item[1]];

			if (typeof(value) === "undefined" || value == null || value == "" || value == "OPE-") value = "N/A";

			// VALUE EXCEPTIONS
			if (item[1] == "Status")
			  switch (config.dataset[item[1]]) {
				case "0":
				  value = "Incomplete";
				  break;
				case "1":
				  value = "Processing";
				  break;
				case "2":
				  value = "Processing";
				  break;
				case "3":
				  value = "Completed";
				  break;
				case "4":
				  value = "You will be contacted by an HPE representative";
				  break;
				default:
				  value = "Unknown";
			  }
			else if (
			  item[1] == "PO_Order_ID" && (
				typeof(config.dataset[item[1]]) !== "string" || config.dataset[item[1]] == null ||
				(typeof(config.dataset[item[1]]) === "string" && config.dataset[item[1]].length < 4)
			  )
			) value = "Pending";
			else if (item[1] == "SuccessResult" && config.dataset[item[1]] != null) {
			  value = JSON.parse(config.dataset[item[1]]).CaseNumber;
			} else if (item[1] == "SuccessResult" && config.dataset[item[1]] == null) {
			  value = "N/A";
			} else if (item[1] == "PO_Order_ID" && config.dataset.Status == "4")
			  value = "N/A";

			else if (
			  (item[1] == "PO_Attachment" && typeof(config.dataset[item[1]]) === "string" && config.dataset[item[1]].length > 3)
			)
			  value = '<a href="https://hpe-rfb.it.hpe.com/form/989/attachments/' + config.dataset.EntryId + '/' + item[1] + '?name=' + value + '">' + hpe.fn.lang('Form332', config.locale, config.localizations) + '</a>';

			else if (
			  (item[1] == "Optional_Attachment" && typeof(config.dataset[item[1]]) === "string" && config.dataset[item[1]].length > 3)
			)
			  value = '<a href="https://hpe-rfb.it.hpe.com/form/989/attachments/' + config.dataset.EntryId + '/' + item[1] + '?name=' + value + '">' + hpe.fn.lang('Form517', config.locale, config.localizations) + '</a>';

			else if (item[1] == "SubmittedTimestamp" && config.dataset[item[1]] != null && config.dataset[item[1]].indexOf("T") > -1)
			  value = config.dataset[item[1]].split("T")[0];

			if (["N/A", "NA", "Select one", "+1000000000", "NA@IGNOREME.COM", " "].indexOf(value) == -1) {
			  var type = "";
			  var optiondata = "";
			  var valuesdata = "";
			  for (a = 0; a < config.pages.length; a++) {
				for (b = 0; b < config.pages[a].structure.length; b++) {
				  for (l = 0; l < config.pages[a].structure[b].group.length; l++) {
					for (k = 0; k < config.pages[a].structure[b].group[l].length; k++) {
					  if (config.pages[a].structure[b].group[l][k].data == item[1]) {
						type = config.pages[a].structure[b].group[l][k].type;
						if (type == "select") {
						  if (config.pages[a].structure[b].group[l][k].options != null)
							optiondata = config.pages[a].structure[b].group[l][k].options;

						  valuesdata = config.pages[a].structure[b].group[l][k].values;
						}
						break;
					  }
					}
				  }
				}
			  }
			  if (type == "select") {
				if (optiondata == "")
				  row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + value + '</p></div>';
				else {
				  if (["PO_BackgroundGroup"].indexOf(item[1]) > -1) {
					var indexval = 0;
					if (optiondata.length >= 4 || valuesdata.length >= 4) {
					  if (["EMEA", "APJ", "AMS"].indexOf(global.data.geo.region) > -1) {
						valuesdata.splice(1, 1);
						valuesdata.splice(1, 1);
						optiondata.splice(1, 1);
						optiondata.splice(1, 1);
					  } else {
						valuesdata.splice(3, 1);
						valuesdata.splice(2, 1);
						optiondata.splice(3, 1);
						optiondata.splice(2, 1);
					  }
					}
					for (g = 0; g < valuesdata.length; g++) {
					  if (valuesdata[g] == value)
						indexval = g;
					}
					row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + hpe.fn.lang(optiondata[indexval], config.locale, config.localizations) + '</p></div>';
				  } else {
					var indexval = 0;
					for (g = 0; g < valuesdata.length; g++) {
					  if (valuesdata[g] == value)
						indexval = g;
					}
					row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + hpe.fn.lang(optiondata[indexval], config.locale, config.localizations) + '</p></div>';
				  }
				}
			  } else
				row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + value + '</p></div>';

			  headerchk = true;
			}

			if (j == reviewSetup[key].fieldset.length - 1) {
			  if (headerchk)
				row.innerHTML += '<div class="cfix"></div>';
			  else
				row.innerHTML = "";
			}
		  }
		}
	  }
	  $('#msg.nfo span').click(function() {
		$('#msg.nfo').hide();
	  });
	  $('.nbsf .buttons .back').after($('<div class="btn draft">Save as draft</div>'));
	  config.dataset.isDraft = false;
	  $(".nbsf .buttons .draft").click(function() {
		config.dataset.isDraft = true;
		config.onSubmit();
	  });
	  if (config.dataset.Status == '1') $('.buttons').hide();
	}
  };
</script>
<script>
  // MAIN CONFIG
  const config = {
	dom: null,
	locale: global.data.user.locale,
	localizations: {},
	dataset: {
	  currentEmail: '[SSOData.Email]',
	  xrefFail: 'No'
	},
	pages: [page1, page2, pageQuotePreview, page3, page4, page5, page6, page7, page8, page9, page10, page11, page12, overviewPage],
	onNext: function() {
	  if (config.dataset.xrefFail == 'Yes') config.dataset.xrefFail = 'No';

	  function doNext() {
		mo.fn.overlay.show({
		  loading: true,
		  close: false
		});

		let vl = config.dataset.PO_BackgroundGroup;
		result = assigntoteamValues.filter(x => (x.region.indexOf(config.dataset.Region) > -1 && x.PO_BackgroundGroup == vl));
		if (config.dataset.Region == "EMEA") {
		  config.dataset.AssignToTeam = result[0].teamName;
		} else if (config.dataset.Region == "AMS") {
		  if (vl == "Edge") config.dataset.AssignToTeam = result[0].teamName;
		  else {
			if (config.dataset.CountryCode != "BR") config.dataset.AssignToTeam = result[1].teamName;
			else config.dataset.AssignToTeam = result[0].teamName;
		  }
		} else if (config.dataset.Region == "APJ") {
		  if (vl == "Edge") config.dataset.AssignToTeam = result[0].teamName;
		  else {
			if (config.dataset.CountryCode == "IN") config.dataset.AssignToTeam = result[0].teamName;
			else if (config.dataset.CountryCode == "JP") config.dataset.AssignToTeam = result[5].teamName;
			else if (config.dataset.CountryCode == "KR") config.dataset.AssignToTeam = result[3].teamName;
			else if (config.dataset.CountryCode == "AU" || config.dataset.CountryCode == "NZ") config.dataset.AssignToTeam = result[2].teamName;
			else if (config.dataset.CountryCode == "HK" || config.dataset.CountryCode == "TW") config.dataset.AssignToTeam = result[1].teamName;
			else config.dataset.AssignToTeam = result[4].teamName;
		  }
		} else config.dataset.AssignToTeam = "OTC WW ComputeStorage EAAS";


		// 1.1 PREVENT DUPLICATE PURCHASE ORDER
		// 1.1.1 SET REQUEST ARGUEMENTS
		var params = "pon=" + config.dataset.PO_Number + "&pid=" + config.dataset.PartyId;
		var view = "3179";
		// 1.1.2 REQUEST REFERENCE DATA TO CHECK FOR EXISTING PURCHASE ORDER
		crud.read(view, params, function(data) {
		  // 1.1.3 EXISTING RECORD IDENTIFIED
		  if (data.Rows.length > 0) {
			if (!config.dataset.EntryId) {
			  var template = hpe.fn.lang("Form449", config.locale, config.localizations);
			  // Content template
			  if (data.Rows.length > 1)
				template = template + '<br>' + '<span id="viewExisting" style="text-decoration:underline;cursor:pointer">' + hpe.fn.lang("Form451", config.locale, config.localizations) + '</span>';
			  else
				template = template + '<br>' + '<span id="viewExisting" style="text-decoration:underline;cursor:pointer">' + hpe.fn.lang("Form452", config.locale, config.localizations) + ' ' + data.Rows[0].PO_Number + '</span>';

			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
				content: template,
				contentCallback: function() {
				  document.querySelector("#viewExisting").addEventListener("click", function(e) {
					config.dataset = data.Rows[0];
					mo.fn.modal.hide();
					mo.fn.overlay.show({
					  loading: true,
					  close: false
					});
					nbsf.init(config, 0);
					nbsf.init(config, 0);
					mo.fn.events.closeAll();
					mo.fn.overlay.hide();
				  });
				},
				title: hpe.fn.lang('Form450', config.locale, config.localizations),
				closeLabel: hpe.fn.lang("CLOSE", config.locale, config.localizations),
				ctaCallback: function() {
				  if (config.dataset.Config_Quote == 'Y' && quoteHelper.quote) {
					config.dataset.QuoteResponse = JSON.stringify(quoteHelper.quote);
				  }
				  crud.create(3158, config.dataset, function(data) {
					if (typeof(data.EntryId) === "number") {
					  // UPDATE REFERENCE APPLICATION WITH RESPONSE
					  config.dataset = data;
					  nbsf.init(config, config.page + 1);
					  mo.fn.events.closeAll();
					  mo.fn.overlay.hide();
					} else {
					  mo.fn.overlay.hide();
					  mo.fn.modal.show({
						ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
						title: hpe.fn.lang("ErrorGeneric2", config.locale, config.localizations),
						content: '<p>' + hpe.fn.lang("ErrorSubmit", config.locale, config.localizations) + '</p>'
					  });
					}
				  });
				}
			  })
			} else {
			  //config.dataset.aggrVal = JSON.stringify(global.data.brt.pas);
			  config.dataset.aggrVal = "0";
			  if (global.data.brt.pas.length > 0) {
				config.dataset.aggrVal = "1";
			  }

			  config.dataset.Status = '0';
			  var OptAtt = document.querySelector('[data-name="Optional_Attachment"]');
			  if (
				config.dataset.Optional_Attachment &&
				OptAtt &&
				$(OptAtt).data('kendoUpload') &&
				$(OptAtt).data('kendoUpload').getFiles() &&
				$(OptAtt).data('kendoUpload').getFiles().length > 0
			  ) {
				config.dataset.Optional_Attachment =
				  new DOMParser().parseFromString($(OptAtt).data('kendoUpload').getFiles()[0].name, "text/html").documentElement.textContent;
			  }
			  if (config.dataset.Config_Quote == 'Y' && quoteHelper.quote) {
				config.dataset.QuoteResponse = JSON.stringify(quoteHelper.quote);
			  }
			  crud.update("3163", config.dataset.EntryId, config.dataset, function(data) {
				if (typeof(data.EntryId) === "number") {
				  // UPDATE REFERENCE APPLICATION WITH RESPONSE
				  config.dataset = data;
				  config.dataset.internalUser = global.data.user.internal;
				  nbsf.init(config, config.page + 1);
				  mo.fn.overlay.hide();
				} else {
				  mo.fn.overlay.hide();
				  mo.fn.modal.show({
					ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
					title: hpe.fn.lang("ErrorGeneric2", config.locale, config.localizations),
					content: '<p>' + hpe.fn.lang("ErrorSubmit", config.locale, config.localizations) + '</p>'
				  });
				}
			  });
			}
		  } else {
			//config.dataset.aggrVal = JSON.stringify(global.data.brt.pas);
			config.dataset.aggrVal = "0";
			if (global.data.brt.pas.length > 0)
			  config.dataset.aggrVal = "1";
			config.dataset.Status = '0';
			if (config.dataset.EntryId) {
			  if (config.dataset.Config_Quote == 'Y' && quoteHelper.quote) {
				config.dataset.QuoteResponse = JSON.stringify(quoteHelper.quote);
			  }
			  crud.update("3163", config.dataset.EntryId, config.dataset, function(data) {
				if (typeof(data.EntryId) === "number") {
				  // UPDATE REFERENCE APPLICATION WITH RESPONSE
				  config.dataset = data;
				  config.dataset.internalUser = global.data.user.internal;
				  nbsf.init(config, config.page + 1);
				  mo.fn.overlay.hide();
				} else {
				  mo.fn.overlay.hide();
				  mo.fn.modal.show({
					ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
					title: hpe.fn.lang("ErrorGeneric2", config.locale, config.localizations),
					content: '<p>' + hpe.fn.lang("ErrorSubmit", config.locale, config.localizations) + '</p>'
				  });
				}
			  });
			} else {
			  //config.dataset.OnBehalf_CreatedBy = '[SSOData.Email]';
			  if (config.dataset.Config_Quote == 'Y' && quoteHelper.quote) {
				config.dataset.QuoteResponse = JSON.stringify(quoteHelper.quote);
			  }
			  crud.create(3158, config.dataset, function(data) {
				if (typeof(data.EntryId) === "number") {
				  // UPDATE REFERENCE APPLICATION WITH RESPONSE
				  config.dataset = data;
				  config.dataset.internalUser = global.data.user.internal;
				  nbsf.init(config, config.page + 1);
				  mo.fn.overlay.hide();
				} else {
				  elog('Failed to create record in RFB');
				  mo.fn.overlay.hide();
				  mo.fn.modal.show({
					ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
					title: hpe.fn.lang("ErrorGeneric2", config.locale, config.localizations),
					content: '<p>' + hpe.fn.lang("ErrorSubmit", config.locale, config.localizations) + '</p>'
				  });
				}
			  });
			}
		  }
		});

		window.scrollTo({
		  top: 0,
		  behavior: 'smooth'
		});
		window.parent.postMessage(JSON.stringify({
		  "top": true
		}), "*");
	  }

	  function optionalInfoModal() {
		mo.fn.modal.show({
		  ctaLabel: hpe.fn.lang("Yes", config.locale, config.localizations),
		  title: hpe.fn.lang("OptionalInformation", config.locale, config.localizations),
		  content: '<p>' + hpe.fn.lang("ModalOptMSG", config.locale, config.localizations) + '</p>',
		  close: true,
		  closeLabel: "No",
		  contentCallback: function() {
			setTimeout(function() {
			  mo.fn.overlay.show({
				close: false
			  });
			}, 100);
			function closeAndGo() {
			  nbsf.init(config, config.pages.length - 1);
			  document.querySelector(".dxpModalFooter .modalCloseButton").removeEventListener("click", closeAndGo);
			}
			document.querySelector(".dxpModalFooter .modalCloseButton").addEventListener("click", closeAndGo);
		  },
		  ctaCallback: function() {
			console.log("config.pages", config.pages)
			nbsf.init(config, config.pages.length - 3);
			mo.fn.events.closeAll();
		  }
		});
	  }

	  function delivery(value) {
		if (typeof(value) === "undefined" || value == null || value.indexOf("/") == -1) return true;
		else {
		  var ddate = value.split("/");
		  var unix = new Date(ddate[2], parseInt(ddate[1]) - 1, parseInt(ddate[0]) + 1, 0, 0, 0, 0).getTime();
		  var delta = unix - new Date().getTime();
		  if (delta < 7862400000 && delta > 0) return true;
		  else return false;
		}
	  }

	  

	  //if PartnerBRT is one of the Distributor, OEM Distributor, System Integrator and the PO_BusinessModel is Agent Model" or HPFS & Agent Model, open the optional info modal
	  if (
		["Distributor", "OEM Distributor", "System Integrator"].includes(config.dataset.PartnerBRT) &&
		["Agent Model", "HPFS & Agent Model"].includes(config.dataset.PO_BusinessModel) &&
		(document.querySelector("input[data-name=AgentProgram_CompanyName]"))
	  ) {
		optionalInfoModal();  
	  }
	  //if the page is Custom Ship To Party Information and the PO_DeliveryIncoterms is not DDP (for Americas), open the optional info modal
	  else if (
		(
		  (config.dataset.SubRegion == "Latin America" && config.dataset.PO_DeliveryIncoterms != "DDP") ||
		  (config.dataset.SubRegion == "North America" && config.dataset.PO_DeliveryIncoterms != "DDP")
		) &&
		(
		  !["Distributor", "OEM Distributor", "System Integrator"].includes(config.dataset.PartnerBRT) ||
		  !["Agent Model", "HPFS & Agent Model"].includes(config.dataset.PO_BusinessModel)
		) &&
		(document.querySelector("input[data-name=CustomShipTo_CompanyName]"))
	  ) {
		optionalInfoModal();  
	  }
	  //if the page is ship to information and the PO category is stocking, open the optional info modal
	  else if (
		(
		  (config.dataset.SubRegion != "Latin America" || config.dataset.PO_DeliveryIncoterms == "DDP") &&
		  (config.dataset.SubRegion != "North America" || config.dataset.PO_DeliveryIncoterms == "DDP")
		) &&
		config.dataset.PO_Category == "Stock" &&
		(document.querySelector("input[data-name=ShipTo_PartyId]") || document.querySelector("input[data-name=ShipTo_Contact_FirstName]"))
	  ) {
		optionalInfoModal();  
	  }
	  //else for the PO category staging or drop shipment
	  else if (["Stage", "Drop"].includes(config.dataset.PO_Category) &&
			   (
		(document.querySelector("input[data-name=EndCx_PartyId]") || document.querySelector("input[data-name=EndCx_Contact_FirstName]")) ||
		(document.querySelector("input[data-name=Reseller_PartyId]") || document.querySelector("input[data-name=Reseller_Contact_FirstName]")) ||
		(document.querySelector("input[data-name=ShipTo_PartyId]") || document.querySelector("input[data-name=ShipTo_Contact_FirstName]"))
	  )) {
		//opens the modal on the end customer or reseller page, depending the switches
		if ((document.querySelector("input[data-name=EndCx_PartyId]") || document.querySelector("input[data-name=EndCx_Contact_FirstName]")) &&
			!["Distributor", "OEM Distributor", "System Integrator"].includes(config.dataset.PartnerBRT)) {
		  optionalInfoModal();
		}
		else if (!["Distributor", "OEM Distributor", "System Integrator"].includes(config.dataset.PartnerBRT) &&
				 config.dataset.Config_EndCxDetails == 'Y' && config.dataset.Config_EndCxDetails_Contact == 'Y' &&
				 (document.querySelector("input[data-name=ShipTo_PartyId]") || document.querySelector("input[data-name=ShipTo_Contact_FirstName]"))) {
		  optionalInfoModal();
		}
		else if (["Distributor", "OEM Distributor", "System Integrator"].includes(config.dataset.PartnerBRT) &&
				 config.dataset.Config_ResellerDetails == 'Y' && config.dataset.Config_ResellerDetails_Contact == 'Y' &&
				 config.dataset.Config_EndCxDetails == 'Y' && config.dataset.Config_EndCxDetails_Contact == 'Y' &&
				 (document.querySelector("input[data-name=ShipTo_PartyId]") || document.querySelector("input[data-name=ShipTo_Contact_FirstName]"))) {
		  optionalInfoModal();
		}
		else if (config.dataset.Config_ResellerDetails == 'Y' && config.dataset.Config_ResellerDetails_Contact == 'Y' &&
				 (document.querySelector("input[data-name=EndCx_PartyId]") || document.querySelector("input[data-name=EndCx_Contact_FirstName]"))) {
		  optionalInfoModal();
		}
		else if (
		  (
			(config.dataset.SubRegion != "Latin America" || config.dataset.PO_DeliveryIncoterms == "DDP") &&
			(config.dataset.SubRegion != "North America" || config.dataset.PO_DeliveryIncoterms == "DDP")
		  ) &&
		  (
			!["Distributor", "OEM Distributor", "System Integrator"].includes(config.dataset.PartnerBRT) ||
			!["Agent Model", "HPFS & Agent Model"].includes(config.dataset.PO_BusinessModel)
		  ) &&
		  (document.querySelector("input[data-name=Reseller_PartyId]") || document.querySelector("input[data-name=Reseller_Contact_FirstName]"))
		) {
		  optionalInfoModal();
		}
		else doNext();
	  }

	  else if (document.querySelector("input[data-name=Config_SoldToDetails]")) {
		if (
		  document.querySelector("input[data-name=Config_SoldToDetails]").value == "Y" &&
		  // document.querySelector("input[data-name=Config_SoldToDetails_Contact]").value == "Y" &&
		  document.querySelector("input[data-name=Config_PayerDetails]").value == "Y" &&
		  document.querySelector("input[data-name=Config_BillToDetails]").value == "Y" &&
		  (!document.querySelector("input[data-name=Config_ShipToDetails]") || document.querySelector("input[data-name=Config_ShipToDetails]").value == "Y") &&		  
		  (!document.querySelector("input[data-name=Config_ResellerDetails]") || document.querySelector("input[data-name=Config_ResellerDetails]").value == "Y") &&
		  (!document.querySelector("input[data-name=Config_ResellerDetails_Contact]") || document.querySelector("input[data-name=Config_ResellerDetails_Contact]").value == "Y") &&
		  (!document.querySelector("input[data-name=Config_EndCxDetails]") || document.querySelector("input[data-name=Config_EndCxDetails]").value == "Y") &&
		  (!document.querySelector("input[data-name=Config_EndCxDetails_Contact]") || document.querySelector("input[data-name=Config_EndCxDetails_Contact]").value == "Y")
		) {
		  optionalInfoModal();
		} else doNext();
	  } else if (document.querySelector("input[data-name=Config_PPC_SoldTo]")) {
		if (
		  document.querySelector("input[data-name=Config_PPC_SoldTo]").value == "Y" &&
		  document.querySelector("input[data-name=Config_PPC_Payer]").value == "Y" &&
		  document.querySelector("input[data-name=Config_PPC_BillTo]").value == "Y" &&
		  document.querySelector("input[data-name=Config_PPC_ShipTo]").value == "Y" &&
		  (!document.querySelector("input[data-name=Config_PPC_Reseller]") || document.querySelector("input[data-name=Config_PPC_Reseller]").value == "Y") &&
		  (!document.querySelector("input[data-name=Config_PPC_EndCx]") || document.querySelector("input[data-name=Config_PPC_EndCx]").value == "Y")
		) {
		  optionalInfoModal();
		} else doNext();
	  } else if (config.page == 0 && global.data.user.internal) {
		mo.fn.overlay.show({
		  loading: true,
		  close: false
		});

		if (document.querySelector("select[data-name=OnBehalf_Type").value == 'Company') {

		  const PartySearch = new kendo.data.DataSource({
			type: "rfb-v2",
			transport: {
			  read: {
				url: "https://hpe-rfb.it.hpe.com/form/data-set-provider/v2/989/NOR_EMDM_PartyData/kendo/data/search",
				type: 'POST'
			  },
			},
			schema: {
			  model: {
				id: "EntryId",
				fields: {
				}
			  }
			},
			serverFiltering: true,
			filter: {
			  field: 'party_id',
			  operator: 'eq',
			  value: document.querySelector("input[data-name=OnBehalf_PartyId]").value
			},
			serverPaging: true,
			pageSize: 1000,
			serverSorting: true,
		  });
		  PartySearch.read().then(function() {
			const view = PartySearch.view();
			console.log('PartySearch view', view);

			if (!view || !view.length) {
			  console.log('Party data not found');
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
				title: hpe.fn.lang("ErrorGeneric", config.locale, config.localizations),
				content: '<p>' + hpe.fn.lang("ErrorPID", config.locale, config.localizations) + '</p>',
			  });
			} else {

			  const partyData = view.find(item => ['T1 Solution Provider', 'Distributor', 'OEM Distributor', 'System Integrator', 'Master Area Partner'].includes(item.BRT));
			  console.log('partyData', partyData);
			  if (partyData) {
				global.data.company.country = partyData.CountryEntity;
				global.data.company.global = partyData.CountryEntity;
				global.data.company.party = partyData.party_id;
				global.data.company.name = partyData.PartyName;
				global.data.geo.name = partyData.CountryName;
				global.data.geo.code = partyData.country_code;
				global.data.geo.geography = partyData.GEO;
				global.data.geo.region = partyData.Region;
				global.data.geo.subregion = partyData.SubRegion;

				global.data.brt.name = partyData.BRT;
				let brtCode = global.data.brts.filter(function(item) {
				  return (item.name == global.data.brt.name)
				});
				global.data.brt.code = brtCode[0].code;

				//  config.locale = global.data.user.locale;
				//  config.dom = document.querySelector('div[tab-id="oob"]');
				config.dataset.CountryEntity = global.data.company.country;
				config.dataset.PartyId = document.querySelector("input[data-name=OnBehalf_PartyId]").value;
				config.dataset.PartnerBRT = partyData.BRT;
				config.dataset.PartnerName = partyData.PartyName;
				config.dataset.Country = partyData.CountryName;
				config.dataset.Region = global.data.geo.region;
				config.dataset.Geo = global.data.geo.geography;


				// GET AGREEMENTS FROM ICM
				request.agreements(global.data, function(data) {
				  console.log('request.agreements data', data);
				  if (data) {
					reference.agreements = data;
				  } else {
					// check if exception/demo account
					hpe.api.dataset({
					  form: '1585',
					  dataset: 'Reference_DemoAccounts',
					  payload: {
						filter: {
						  logic: "and",
						  filters: [{
							field: 'PartyId',
							operator: 'eq',
							value: global.data.company.party
						  },
									{
									  field: 'BRT',
									  operator: 'eq',
									  value: global.data.brt.name
									}
								   ]
						},
						skip: '0',
						pageSize: '1',
						take: '1'
					  }
					}, function(d) {
					  if (typeof(d) === 'object' && d.Success && d.Data.length == 1) {
						reference.agreements = [];
					  }
					  return mo.fn.overlay.hide();
					})
				  }
				  global.data.brt.pas = [];
				  reference.agreements.forEach(function(agreement) {
					global.data.brt.pas.push(agreement.iCMPANumber);
				  });
				  let chnls = global.data.brts.filter(function(item) {
					return (item.code == global.data.brt.code && item.name == global.data.brt.name)
				  });
				  chnls = chnls[0].channel;
				  global.data.brt.channel = chnls;

				  config.dataset.aggrVal = "0";
				  if (global.data.brt.pas.length > 0)
					config.dataset.aggrVal = "1";
				  reference.countriesRequest();
				  otherFunctions.lang();

				  crud.q.stop(function() {
					hpe.data.xref(global.data.company.party, function(d) {
					  reference.xref = d;
					  config.locale = global.data.user.locale;
					  config.dom = document.querySelector('div[tab-id="oob"]');
					  nbsf.init(config, config.page + 1);
					  nbsf.init(config, config.page);
					  mo.fn.events.closeAll();
					  mo.fn.overlay.hide();
					});
				  });
				});

			  } else {
				console.log('No correct BRT');
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
				  title: hpe.fn.lang("ErrorGeneric", config.locale, config.localizations),
				  content: '<p>' + hpe.fn.lang("ErrorPID04", config.locale, config.localizations) + '</p>',
				});
			  }
			}
		  });

		} else if (document.querySelector("select[data-name=OnBehalf_Type").value == 'User') {
		  profile.get({
			email: document.querySelector('input[data-name="OnBehalf_CreatedBy"]').value,
			relationship: true,
			company: true,
			geography: true,
			business: true
		  }, function(d) {
			if (d.success) {
			  global.data.company.country = d.business.GroupId;
			  global.data.company.global = d.business.GroupId;
			  global.data.company.party = d.company.PartyId;
			  global.data.company.name = d.company.Name;
			  global.data.geo.name = d.geography.Name;
			  global.data.geo.code = d.geography.ISO2;
			  global.data.geo.geography = d.geography.GEO;
			  global.data.geo.region = d.geography.Region;
			  global.data.geo.subregion = d.geography.SubRegion;
			  global.data.user.hpp = d.user.HPPId;
			  //global.data.company.brt.brTypeName = d.relationship.BRType;
			  global.data.brt.name = d.relationship.BRType;
			  global.data.sim = d.sim.map(function(item) {
				return item['ISO2'];
			  });
			  let brtCode = global.data.brts.filter(function(item) {
				return (item.name == global.data.brt.name)
			  });
			  global.data.brt.code = brtCode[0].code;

			  config.dataset.FirstName = d.user.FirstName;
			  config.dataset.LastName = d.user.LastName;
			  config.dataset.Language = 'en_US';
			  config.dataset.CountryEntity = global.data.company.country;
			  config.dataset.PartyId = d.company.PartyId;
			  config.dataset.PartnerBRT = global.data.brt.name;
			  config.dataset.PartnerName = global.data.company.name;
			  config.dataset.Country = global.data.geo.name;
			  config.dataset.Region = global.data.geo.region;
			  config.dataset.Geo = global.data.geo.geography;


			  // GET AGREEMENTS FROM ICM
			  request.agreements(global.data, function(data) {
				console.log('111')
				if (data) {
				  reference.agreements = data;
				} else {
				  // check if exception/demo account
				  hpe.api.dataset({
					form: '1585',
					dataset: 'Reference_DemoAccounts',
					payload: {
					  filter: {
						logic: "and",
						filters: [{
						  field: 'PartyId',
						  operator: 'eq',
						  value: global.data.company.party
						},
								  {
									field: 'BRT',
									operator: 'eq',
									value: global.data.brt.name
								  }
								 ]
					  },
					  skip: '0',
					  pageSize: '1',
					  take: '1'
					}
				  }, function(d) {
					if (typeof(d) === 'object' && d.Success && d.Data.length == 1) {
					  reference.agreements = [];
					}
					return mo.fn.overlay.hide();
				  })
				}
				global.data.brt.pas = [];
				reference.agreements.forEach(function(agreement) {
				  global.data.brt.pas.push(agreement.iCMPANumber);
				});
				let chnls = global.data.brts.filter(function(item) {
				  return (item.code == global.data.brt.code && item.name == global.data.brt.name)
				});
				chnls = chnls[0].channel;
				global.data.brt.channel = chnls;
				//config.dataset.aggrVal = JSON.stringify(global.data.brt.pas);
				config.dataset.aggrVal = "0";
				if (global.data.brt.pas.length > 0)
				  config.dataset.aggrVal = "1";
				reference.countriesRequest();
				otherFunctions.lang();

				crud.q.stop(function() {
				  hpe.data.xref(global.data.company.party, function(d) {
					reference.xref = d;
					config.locale = global.data.user.locale;
					config.dom = document.querySelector('div[tab-id="oob"]');
					nbsf.init(config, config.page + 1);
					nbsf.init(config, config.page);
					mo.fn.events.closeAll();
					mo.fn.overlay.hide();
				  });
				});
			  });
			} else {
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
				title: hpe.fn.lang("ErrorGeneric", config.locale, config.localizations),
				content: '<p>' + hpe.fn.lang("ErrorPID03", config.locale, config.localizations) + '</p>',
			  });
			}
		  })
		}
	  } else if (config.page == 1) {
		nbsf.init(config, config.page + 1);
		nbsf.init(config, config.page);
	  } else {
		if (!delivery(config.dataset.PO_DeliveryDate)) {
		  $('.nbsf .continue').addClass('disabled');
		  mo.fn.modal.show({
			ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
			title: hpe.fn.lang("ModalDeliveryDate", config.locale, config.localizations),
			content: '<p>' + hpe.fn.lang("ModalDeliveryDateMSG", config.locale, config.localizations) + '</p>',
		  });
		} else {
		  doNext();
		}
	  }
	},
	onPrev: function() {
	  mo.fn.overlay.show({
		loading: true,
		close: false
	  });
	  console.log("CONFIG:", this);
	  console.log("CURRENT:", this.page);
	  console.log("PREV:", this.page - 1);
	  console.log("DATA:", this.dataset);
	  nbsf.init(config, config.page - 1);
	  nbsf.init(config, config.page);
	  mo.fn.overlay.hide();

	  window.scrollTo({
		top: 0,
		behavior: 'smooth'
	  });
	  window.parent.postMessage(JSON.stringify({
		"top": true
	  }), "*");
	},
	onSubmit: function() {
	  mo.fn.overlay.show({
		loading: true,
		close: false
	  });
	  request.timestamp(function(t) {
		// SET SUBMISSION INFO
		config.dataset.OnBehalf_SubmittedBy = '[SSOData.Email]';
		config.dataset.Requestor_Email = '[SSOData.Email]';

		config.dataset.FirstName = '[SSOData.FirstName]';
		config.dataset.LastName = '[SSOData.LastName]';
		config.dataset.RequestorRole = 'Partner';
		if (global.data.user.internal) config.dataset.RequestorRole = 'HPE Internal';
		let isDraft = config.dataset.isDraft;
		if (!isDraft) {
		  config.dataset.Status = '1';
		  config.dataset.Submitted = 'Y';
		  config.dataset.Workflow = '1';
		  config.dataset.SubmittedTimestamp = t;
		}

		// BUILD SFDC CASE DESCRIPTION
		var pairs = [];
		if (global.data.user.internal) {
		  for (i = 0; i < config.pages.length; i++) {
			var cPage = config.pages[i];
			var cStructure = cPage.structure;
			var cFilter = true;
			if (typeof(cPage.filter) === "object") cFilter = nbsf.fn.filter(config.dataset, cPage.filter);
			if (cFilter) {
			  var hdr = {
				ttl: "page-" + i,
				val: hpe.fn.lang(cPage.title, config.locale, config.localizations)
			  };
			  if (global.data.user.internal) {
				if (hdr.ttl != "page-0")
				  pairs.push(hdr);
			  } else pairs.push(hdr);
			  for (j = 0; j < cStructure.length; j++) {
				var cFilter = true;
				if (typeof(cStructure[j].filter) === "object") cFilter = nbsf.fn.filter(config.dataset, cStructure[j].filter);
				if (cFilter) {
				  for (k = 0; k < cStructure[j].group.length; k++) {
					var cGroup = cStructure[j].group[k];
					for (l = 0; l < cGroup.length; l++) {
					  var cInput = cGroup[l];
					  if (cInput.type != "hidden") {
						var obj = {
						  ttl: "N/A",
						  val: "N/A",
						  data: "N/A"
						}
						if (typeof(cInput.label) !== "undefined" && cInput.label.length > 0) obj.ttl = hpe.fn.lang(cInput.label, config.locale, config.localizations);
						else if (typeof(cInput.data) !== "undefined" && cInput.data.length > 0) obj.ttl = cInput.data;
						if (
						  typeof(cInput.data) !== "undefined" &&
						  typeof(config.dataset[cInput.data]) !== "undefined" &&
						  config.dataset[cInput.data] != null &&
						  config.dataset[cInput.data].length > 0 && ["NA@IGNOREME.COM", "Select one", "+1000000000"].indexOf(config.dataset[cInput.data]) == -1
						) {
						  if (config.dataset[cInput.data] == "Y") obj.val = hpe.fn.lang("Yes", config.locale, config.localizations);
						  else if (config.dataset[cInput.data] == "N") obj.val = hpe.fn.lang("No", config.locale, config.localizations);
						  else if (config.dataset[cInput.data] == "NA") obj.val = "N/A";
						  else if (cInput.data == "PO_Attachment") obj.val = '<a href="https://hpe-rfb.it.hpe.com/form/989/attachments/' + config.dataset.EntryId + '/PO_Attachment?name=' + config.dataset[cInput.data] + '">' + config.dataset[cInput.data] + '</a>';
						  else obj.val = config.dataset[cInput.data];
						}
						if (obj.val != "N/A") {
						  obj.data = cInput.data;
						  pairs.push(obj);
						}
					  }
					}
				  }
				}
			  }
			  var obj = pairs[pairs.length - 1];
			  //  console.log("obj", obj);
			  if (obj.ttl.indexOf("page-") > -1) {
				pairs.pop();
			  }
			  if (obj.data == "OnBehalf_CreatedBy") {
				// Delete the first pairs - 'On behalf of' and either 'Email' or 'Party ID'
				pairs.shift();
				const secondPair = pairs.shift();
				if (secondPair.data == "OnBehalf_PartyId") {
				  pairs.shift();
				}
			  }

			}
		  }
		  //  console.log("pairs", pairs);
		  var caseDescription = "";
		  for (i = 0; i < pairs.length; i++) {
			if (pairs[i].ttl != null && pairs[i].ttl.indexOf("page-") > -1) {
			  caseDescription = caseDescription + "<br><br>";
			  if (i == 0) {
				caseDescription = caseDescription + "<strong>" + hpe.fn.lang("FormCFI018", config.locale, config.localizations) + "</strong><br>";
			  } else {
				if (pairs[i].ttl == "page-2")
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form518", config.locale, config.localizations) + "</strong><br>";
				else if (pairs[i].ttl == "page-3")
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("FormCFI019", config.locale, config.localizations) + "</strong><br>";
				else
				  caseDescription = caseDescription + "<strong>" + pairs[i].val + "</strong><br>";
			  }
			} else {
			  if (["PA_Number"].indexOf(pairs[i].data) > -1) {
				caseDescription = caseDescription + "<br><br>";
				caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form023", config.locale, config.localizations) + "</strong><br>";
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["Config_Quote", "Config_aaS"].indexOf(pairs[i].data) > -1) {
				if (["North America"].indexOf(global.data.geo.geography) > -1) {
				  if (pairs[i].data == "Config_aaS") {
					caseDescription = caseDescription + "<br><br>";
					caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form075", config.locale, config.localizations) + "</strong><br>";
					caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
				  } else if (pairs[i].data == "Config_Quote") {
					caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
				  }
				} else {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form075", config.locale, config.localizations) + "</strong><br>";
				  caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
				}

			  } else if (["PO_DeliveryDate"].indexOf(pairs[i].data) > -1) {
				caseDescription = caseDescription + "<br><br>";
				caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form472", config.locale, config.localizations) + "</strong><br>";
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["AssLoc_PartyId", "AssLoc_CompanyName", "AssLoc_Address_Street", "AssLoc_Address_Street2", "AssLoc_Address_City", "AssLoc_Address_State", "AssLoc_Address_Postal", "AssLoc_Address_Country"].indexOf(pairs[i].data) > -1) {
				if (caseDescription.indexOf(hpe.fn.lang("Form519", config.locale, config.localizations)) == -1) {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form519", config.locale, config.localizations) + "</strong><br>";
				}
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["EntPrty_PartyId", "EntPrty_CompanyName", "EntPrty_Address_Street", "EntPrty_Address_Street2", "EntPrty_Address_City", "EntPrty_Address_State", "EntPrty_Address_Postal", "EntPrty_Address_Country", "EntPrty_Contact_FirstName", "EntPrty_Contact_LastName", "EntPrty_Contact_Phone", "EntPrty_Contact_Email", "EntPrty_Contact_Country"].indexOf(pairs[i].data) > -1) {
				if (caseDescription.indexOf(hpe.fn.lang("Form520", config.locale, config.localizations)) == -1) {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form520", config.locale, config.localizations) + "</strong><br>";
				}
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["PSP_PartyId", "PSP_CompanyName", "PSP_Address_Street", "PSP_Address_Street2", "PSP_Address_City", "PSP_Address_State", "PSP_Address_Postal", "PSP_Address_Country"].indexOf(pairs[i].data) > -1) {
				if (caseDescription.indexOf(hpe.fn.lang("Form529", config.locale, config.localizations)) == -1) {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form529", config.locale, config.localizations) + "</strong><br>";
				}
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else {
				if (["NA", "N/A", " ", "", "OPE-", "Select one"].indexOf(pairs[i].val) == -1)
				  caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  }
			}
		  }
		  config.dataset.CaseDescription = caseDescription;
		  //  console.log("CaseDescription: " + config.dataset.CaseDescription);
		} else {
		  for (i = 0; i < config.pages.length; i++) {
			var cPage = config.pages[i];
			var cStructure = cPage.structure;
			var cFilter = true;
			if (typeof(cPage.filter) === "object") cFilter = nbsf.fn.filter(config.dataset, cPage.filter);
			if (cFilter) {
			  var hdr = {
				ttl: "page-" + i,
				val: hpe.fn.lang(cPage.title, config.locale, config.localizations)
			  };

			  pairs.push(hdr);
			  for (j = 0; j < cStructure.length; j++) {
				var cFilter = true;
				if (typeof(cStructure[j].filter) === "object") cFilter = nbsf.fn.filter(config.dataset, cStructure[j].filter);
				if (cFilter) {
				  for (k = 0; k < cStructure[j].group.length; k++) {
					var cGroup = cStructure[j].group[k];
					for (l = 0; l < cGroup.length; l++) {
					  var cInput = cGroup[l];
					  if (cInput.type != "hidden") {
						var obj = {
						  ttl: "N/A",
						  val: "N/A",
						  data: "N/A"
						}
						if (typeof(cInput.label) !== "undefined" && cInput.label.length > 0) obj.ttl = hpe.fn.lang(cInput.label, config.locale, config.localizations);
						else if (typeof(cInput.data) !== "undefined" && cInput.data.length > 0) obj.ttl = cInput.data;
						if (
						  typeof(cInput.data) !== "undefined" &&
						  typeof(config.dataset[cInput.data]) !== "undefined" &&
						  config.dataset[cInput.data] != null &&
						  config.dataset[cInput.data].length > 0 && ["NA@IGNOREME.COM", "Select one", "+1000000000"].indexOf(config.dataset[cInput.data]) == -1
						) {
						  if (config.dataset[cInput.data] == "Y") obj.val = hpe.fn.lang("Yes", config.locale, config.localizations);
						  else if (config.dataset[cInput.data] == "N") obj.val = hpe.fn.lang("No", config.locale, config.localizations);
						  else if (config.dataset[cInput.data] == "NA") obj.val = "N/A";
						  else if (cInput.data == "PO_Attachment") obj.val = '<a href="https://hpe-rfb.it.hpe.com/form/989/attachments/' + config.dataset.EntryId + '/PO_Attachment?name=' + config.dataset[cInput.data] + '">' + config.dataset[cInput.data] + '</a>';
						  else obj.val = config.dataset[cInput.data];
						}
						if (obj.val != "N/A") {
						  obj.data = cInput.data;
						  pairs.push(obj);
						}
					  }
					}
				  }
				}
			  }
			  var obj = pairs[pairs.length - 1];
			  //console.log("obj", obj);
			  if (obj.ttl.indexOf("page-") > -1) {
				pairs.pop();
			  }

			}
		  }
		  //  console.log("pairs", pairs);
		  var caseDescription = "";
		  for (i = 0; i < pairs.length; i++) {
			if (pairs[i].ttl != null && pairs[i].ttl.indexOf("page-") > -1) {
			  caseDescription = caseDescription + "<br><br>";
			  if (i == 0) {
				caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form518", config.locale, config.localizations) + "</strong><br>";
			  } else
				caseDescription = caseDescription + "<strong>" + pairs[i].val + "</strong><br>";
			} else {
			  if (["PA_Number"].indexOf(pairs[i].data) > -1) {
				caseDescription = caseDescription + "<br><br>";
				caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form023", config.locale, config.localizations) + "</strong><br>";
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["Config_Quote", "Config_aaS"].indexOf(pairs[i].data) > -1) {
				if (["North America"].indexOf(global.data.geo.geography) > -1) {
				  if (pairs[i].data == "Config_aaS") {
					caseDescription = caseDescription + "<br><br>";
					caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form075", config.locale, config.localizations) + "</strong><br>";
					caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
				  } else if (pairs[i].data == "Config_Quote") {
					caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
				  }
				} else {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form075", config.locale, config.localizations) + "</strong><br>";
				  caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
				}

			  } else if (["PO_DeliveryDate"].indexOf(pairs[i].data) > -1) {
				caseDescription = caseDescription + "<br><br>";
				caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form472", config.locale, config.localizations) + "</strong><br>";
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["AssLoc_PartyId", "AssLoc_CompanyName", "AssLoc_Address_Street", "AssLoc_Address_Street2", "AssLoc_Address_City", "AssLoc_Address_State", "AssLoc_Address_Postal", "AssLoc_Address_Country"].indexOf(pairs[i].data) > -1) {
				if (caseDescription.indexOf(hpe.fn.lang("Form519", config.locale, config.localizations)) == -1) {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form519", config.locale, config.localizations) + "</strong><br>";
				}
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["EntPrty_PartyId", "EntPrty_CompanyName", "EntPrty_Address_Street", "EntPrty_Address_Street2", "EntPrty_Address_City", "EntPrty_Address_State", "EntPrty_Address_Postal", "EntPrty_Address_Country", "EntPrty_Contact_FirstName", "EntPrty_Contact_LastName", "EntPrty_Contact_Phone", "EntPrty_Contact_Email", "EntPrty_Contact_Country"].indexOf(pairs[i].data) > -1) {
				if (caseDescription.indexOf(hpe.fn.lang("Form520", config.locale, config.localizations)) == -1) {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form520", config.locale, config.localizations) + "</strong><br>";
				}
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else if (["PSP_PartyId", "PSP_CompanyName", "PSP_Address_Street", "PSP_Address_Street2", "PSP_Address_City", "PSP_Address_State", "PSP_Address_Postal", "PSP_Address_Country"].indexOf(pairs[i].data) > -1) {
				if (caseDescription.indexOf(hpe.fn.lang("Form529", config.locale, config.localizations)) == -1) {
				  caseDescription = caseDescription + "<br><br>";
				  caseDescription = caseDescription + "<strong>" + hpe.fn.lang("Form529", config.locale, config.localizations) + "</strong><br>";
				}
				caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  } else {
				if (["NA", "N/A", " ", "", "OPE-", "Select one"].indexOf(pairs[i].val) == -1)
				  caseDescription = caseDescription + pairs[i].ttl + ": " + pairs[i].val + "<br>";
			  }
			}
		  }
		  config.dataset.CaseDescription = caseDescription;
		  //  console.log("CaseDescription: " + config.dataset.CaseDescription);
		}
		
		if (config.dataset.Config_Quote == 'Y' && quoteHelper.quote) {
		  config.dataset.QuoteResponse = JSON.stringify(quoteHelper.quote);
		}

		// UPDATE RECORD
		crud.update("3163", config.dataset.EntryId, config.dataset, function(data) {
		  if (typeof(data.EntryId) === "number") {
			// UPDATE REFERENCE APPLICATION WITH RESPONSE
			config.dataset = data;
			nbsf.init(config, config.page);
			mo.fn.overlay.hide();

			if (!isDraft) {
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
				title: hpe.fn.lang('Form226', config.locale, config.localizations),
				content: '<p>' + hpe.fn.lang('Form227', config.locale, config.localizations) + '</p>',
				ctaCallback: function() {
				  $('span[tab-id="requests"]').click()
				  $('.refresh').click()
				  mo.fn.events.closeAll();
				}
			  });
			} else {
			  // DRAFT
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
				title: hpe.fn.lang('Form228', config.locale, config.localizations) + " #" + config.dataset.EntryId,
				content: '<p>' + hpe.fn.lang('Form229', config.locale, config.localizations).replace("{{OrderId}}", config.dataset.EntryId) + '</p>',
				ctaCallback: function() {
				  $('span[tab-id="requests"]').click()
				  $('.refresh').click()
				  mo.fn.events.closeAll();
				}
			  });
			}

		  } else {
			elog('Failed to update record in RFB');
			mo.fn.overlay.hide();
			mo.fn.modal.show({
			  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
			  title: hpe.fn.lang("ErrorGeneric2", config.locale, config.localizations),
			  content: '<p>' + hpe.fn.lang("ErrorSubmit", config.locale, config.localizations) + '</p>'
			});
		  }
		});
	  });
	}
  };

  if (global.data.user.internal) {
	config.pages.unshift(page0);
	config.pages.unshift(pageFirst);
  }
  // PAGE CALLBACKS
  const callbacks = {
	pageFirst: function() {
	  console.log('pageFirst');
	  if (config.dataset.OnBehalf_CreatedBy && config.dataset.OnBehalf_Type == 'User') {
		$('input[data-name="OnBehalf_CreatedBy"]').parent().parent().addClass('wrapper-disabled');
		$('input[data-name="OnBehalf_CreatedBy"]').attr("disabled", 'disabled');
		document.querySelector('select[data-name="OnBehalf_Type"]').disabled = true;
		$('select[data-name="OnBehalf_Type"]').parent().parent().addClass('wrapper-disabled');
		$('input[data-name="OnBehalf_PartyId"]').closest('fieldset').hide();
		document.querySelector('input[data-name="OnBehalf_PartyId"]').setAttribute("ignore-validation", true);
		nbsf.ev.global(config, false);
	  } else if (config.dataset.OnBehalf_CreatedBy && !config.dataset.OnBehalf_Type) {
		$('input[data-name="OnBehalf_CreatedBy"]').parent().parent().addClass('wrapper-disabled');
		$('input[data-name="OnBehalf_CreatedBy"]').attr("disabled", 'disabled');
		document.querySelector('select[data-name="OnBehalf_Type"]').disabled = true;
		document.querySelector('select[data-name="OnBehalf_Type"]').value = 'User';
		$('select[data-name="OnBehalf_Type"]').parent().parent().addClass('wrapper-disabled');
		$('input[data-name="OnBehalf_PartyId"]').closest('fieldset').hide();
		document.querySelector('input[data-name="OnBehalf_PartyId"]').setAttribute("ignore-validation", true);
		nbsf.ev.global(config, false);
	  } else if (config.dataset.PartyId && config.dataset.OnBehalf_Type == 'Company') {
		$('input[data-name="OnBehalf_CreatedBy"]').closest('fieldset').hide();
		$('input[data-name="OnBehalf_PartyId"]').parent().parent().addClass('wrapper-disabled');
		$('input[data-name="OnBehalf_PartyId"]').attr("disabled", 'disabled');
		$('select[data-name="OnBehalf_Type"]').parent().parent().addClass('wrapper-disabled');
		document.querySelector('input[data-name="OnBehalf_PartyId"]').value = config.dataset.PartyId;
		document.querySelector('select[data-name="OnBehalf_Type"]').disabled = true;
		document.querySelector('input[data-name="OnBehalf_CreatedBy"]').setAttribute("ignore-validation", true);
		nbsf.ev.global(config, false);
	  } else {
		$('input[data-name="OnBehalf_CreatedBy"]').closest('fieldset').hide();
		$('input[data-name="OnBehalf_PartyId"]').closest('fieldset').hide();
	  }
	  $('select[data-name="OnBehalf_Type"]').change(() => {
		var fieldUser = $('select[data-name="OnBehalf_Type"]').val() == "User";
		var fieldCompany = $('select[data-name="OnBehalf_Type"]').val() == "Company";
		if (fieldUser) {
		  console.log("user");
		  $('input[data-name="OnBehalf_PartyId"]').closest('fieldset').hide();
		  $('input[data-name="OnBehalf_CreatedBy"]').closest('fieldset').show();
		  document.querySelector('input[data-name="OnBehalf_PartyId"]').setAttribute("ignore-validation", fieldUser);
		  document.querySelector('input[data-name="OnBehalf_CreatedBy"]').setAttribute("ignore-validation", fieldCompany);
		} else if (fieldCompany) {
		  console.log("company");
		  $('input[data-name="OnBehalf_CreatedBy"]').closest('fieldset').hide();
		  $('input[data-name="OnBehalf_PartyId"]').closest('fieldset').show();
		  document.querySelector('input[data-name="OnBehalf_CreatedBy"]').setAttribute("ignore-validation", fieldCompany);
		  document.querySelector('input[data-name="OnBehalf_PartyId"]').setAttribute("ignore-validation", fieldUser);
		}
		nbsf.ev.global(config, false);
	  });
	},
	page0: function() {
	  console.log('page0');
	  var languages = []
	  const langDS = new kendo.data.DataSource({
		type: "rfb-v2",
		transport: {
		  read: {
			url: "https://hpe-rfb.it.hpe.com/form/data-set-provider/v2/1476/LanguagesList/kendo/data/search",
			type: 'POST'
		  },
		},
		schema: {
		  model: {
			id: "EntryId",
			fields: {}
		  }
		},
		serverFiltering: true,
		// filter: [],
		serverPaging: true,
		pageSize: 1000,
		serverSorting: true,
	  });
	  langDS.read().then(function() {
		const view = langDS.view();
		console.log('langDS', view);
		view.forEach(item => {
		  $('select[data-name="Language"').append($('<option></option>').val(item.LanguageCode).html(item.LanguageName));
		});
		//	document.querySelector('select[data-name="Language"').value = 'en_US';
	  });

	  if (config.dataset.OnBehalf_Type == 'Company') {
		$('input[data-name="OnBehalf_CreatedBy"]').parent().parent().removeClass('wrapper-disabled');
		$('input[data-name="OnBehalf_CreatedBy"]').attr("disabled", false);
		$('input[data-name="FirstName"]').parent().parent().removeClass('wrapper-disabled');
		$('input[data-name="FirstName"]').attr("disabled", false);
		$('input[data-name="LastName"]').parent().parent().removeClass('wrapper-disabled');
		$('input[data-name="LastName"]').attr("disabled", false);
		$('select[data-name="Language"]').parent().parent().removeClass('wrapper-disabled');
		$('select[data-name="Language"]').attr("disabled", false);
	  }
	  $('select[data-name="Language"]').parent().parent().hide();
	},
	page1: function() {
	  mo.fn.overlay.hide();
	  console.log('page1');
	  // HIDDEN INPUT: SSO
	  let hiddenInputs = [
		{
		  name: "Email",
		  group: "user",
		  value: "email"
		},
		/*{
                      name: "FirstName",
                      group: "user",
                      value: "fname"
                  },
                  {
                      name: "LastName",
                      group: "user",
                      value: "lname"
                  },*/
		{
		  name: "HPPUserId",
		  group: "user",
		  value: "hpp"
		},
		{
		  name: "PreferredLanguageCode",
		  group: "user",
		  value: "locale"
		},
		{
		  name: "Language",
		  group: "user",
		  value: "language"
		},
		{
		  name: "PartyId",
		  group: "company",
		  value: "party"
		},
		{
		  name: "CountryEntity",
		  group: "company",
		  value: "country"
		},
		{
		  name: "GlobalEntity",
		  group: "company",
		  value: "global"
		},
		{
		  name: "PartnerBRT",
		  group: "brt",
		  value: "name"
		},
		{
		  name: "Region",
		  group: "geo",
		  value: "region"
		},
		{
		  name: "SubRegion",
		  group: "geo",
		  value: "subregion"
		},
		{
		  name: "Geo",
		  group: "geo",
		  value: "geography"
		},
	  ];
	  if (!global.data.user.internal) {
		hiddenInputs.forEach(function(input) {
		  config.dataset[input.name] = global.data[input.group][input.value];
		  document.querySelector("input[type=hidden][data-name=" + input.name + "]").value = global.data[input.group][input.value];
		});
	  }
	  config.dataset.internalUser = global.data.user.internal;
	  config.dataset.Email = '[SSOData.Email]';
	  config.dataset.Requestor_Email = '[SSOData.Email]';
	  // config.dataset.CountryCode = global.data.geo.code;
	  quoteHelper.initCountry(config, false, false);
	  
	  // ADDRESS MAPPIMG FOR SOLD_TO, PAYER, BILL_TO FROM PO - ONLY FOR NEW REQUESTS
	  quoteHelper.initDefaultPOData(config);

	  // REGION AMS REMOVE STANDALONE SERVICE OPTION FROM PO_BACKGROUNDGROUP
	  if (document.querySelector("select[data-name=PO_BackgroundGroup]") != null) {
		if (document.querySelector("select[data-name=PO_BackgroundGroup]").options.length > 4) {
		  if (["EMEA", "APJ", "AMS"].indexOf(global.data.geo.region) > -1) {
			document.querySelector("select[data-name=PO_BackgroundGroup]").options[2] = null;
			document.querySelector("select[data-name=PO_BackgroundGroup]").options[2] = null;
		  } else {
			document.querySelector("select[data-name=PO_BackgroundGroup]").options[4] = null;
			document.querySelector("select[data-name=PO_BackgroundGroup]").options[3] = null;
		  }
		  if (config.dataset.PO_BackgroundGroup == "" || config.dataset.PO_BackgroundGroup == null)
			document.querySelector("select[data-name=PO_BackgroundGroup]").options[0].selected = true;
		  else
			document.querySelector("select[data-name=PO_BackgroundGroup]").value = config.dataset.PO_BackgroundGroup;
		}
	  }
	  config.dataset.aggrVal = "0";
	  if (global.data.brt.pas.length > 0)
		config.dataset.aggrVal = "1";
	  $('label[for="Config_Quote"]').click(function() {
		$('input[name="Config_Quote"]').trigger("change");
	  });
	  $('input[name="Config_Quote"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		
		config.dataset.Config_Quote = $(this).val();
		if(config.dataset.Config_Quote == 'N'){
		  config.dataset.Requestor_PO_Quote_ID = null;
		  config.dataset.Config_UCID = null;
		  config.dataset.Config_UCIDQ = null;
		  config.dataset.Config_ConfigId = null;
		  
		  quoteHelper.initCountry(config);
		  nbsf.init(config, config.page);
		  
		  // Clear quote data
		  quoteHelper.initDefaultPOData(config, true);
		  quoteHelper.clearHeaderQuoteData(config);
		}
		nbsf.init(config, config.page);
	  });
	  
	  // Populate data from QuoteId 
	  if (document.querySelector('input[data-name="Requestor_PO_Quote_ID"]')) {
		$("input[data-name=Requestor_PO_Quote_ID]").on("change", function(event, invalid) {
		  let completedData = document.querySelectorAll('*[data-name]');
		  for (let i = 0; i < completedData.length; i++) {
			config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		  }
		  config.dataset.Requestor_PO_Quote_ID = $(this).val();
		  quoteHelper.initCountry(config, invalid);
		  nbsf.init(config, config.page);
		  if (!invalid) {
			quoteHelper.initHeaderQuoteData(config);
			quoteHelper.initAddressQuoteData(config);
			nbsf.init(config, config.page);
		  }
		  
		  // After all disable/undisable some header quote fields if quote is exist
		  quoteHelper.disableHeaderQuote(config);
		});
	  }
	  
	  // Disable some header quote fields if quote is exist
	  quoteHelper.disableHeaderQuote(config);
	  
	  let addCustomCssNBSF = ['PO_BackgroundGroup', 'PO_Number', 'PO_Value', 'Config_Quote', 'PO_BusinessModel', 'PO_HPEEntity'];

	  for (let i = 0; i < addCustomCssNBSF.length; i++) {
		if (document.querySelector('*[data-name="' + addCustomCssNBSF[i] + '"]'))
		  document.querySelector('*[data-name="' + addCustomCssNBSF[i] + '"]').closest('.row').classList.add("filteredClass");
	  }

	  if (document.querySelector('*[data-name="PA_NumberPlaceholder"]'))
		document.querySelector('*[data-name="PA_NumberPlaceholder"]').closest('.row').classList.add("customFilteredClass");
	  if (document.querySelector('*[data-name="Rs_PO_Number"]'))
		document.querySelector('*[data-name="Rs_PO_Number"]').closest('.row').classList.add("customFilteredClass");
	  if (document.querySelector('*[data-name="Config_Quote"]'))
		document.querySelector('*[data-name="Config_Quote"]').closest('.row').classList.add("customFilteredClassToggle");
	  if (document.querySelector('*[data-name="PO_CompleteDelivery"]'))
		document.querySelector('*[data-name="PO_CompleteDelivery"]').closest('.row').classList.add("customFilteredClassToggle13");
	  if (document.querySelector('*[data-name="Cx_PO_Number"]'))
		document.querySelector('*[data-name="Cx_PO_Number"]').closest('.row').classList.add("customFilteredClass");
	  if (document.querySelector('*[data-name="Invoice_SendEmail"]'))
		document.querySelector('*[data-name="Invoice_SendEmail"]').closest('.row').classList.add("customFilteredClassToggle13");	
		
	  if (document.querySelector('select[data-name="PO_Category"]')) {
		$('select[data-name="PO_Category"] option').click(function() {
		  $('select[data-name="PO_Category"]').trigger("change");
		});
		$('select[data-name="PO_Category"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		  
		config.dataset.PO_Category = $(this).val();
		if (config.dataset.PO_Category == "Stock") {
		  config.dataset.Config_ResellerDetails = "Y";
		  config.dataset.Config_ResellerDetails_Contact = "Y";
		  config.dataset.Config_EndCxDetails = "Y";
		  config.dataset.Config_EndCxDetails_Contact = "Y";
		} else {
		  config.dataset.Config_ResellerDetails = "N";
		  config.dataset.Config_ResellerDetails_Contact = "N";
		  config.dataset.Config_EndCxDetails = "N";
		  config.dataset.Config_EndCxDetails_Contact = "N";
		}
		nbsf.init(config, config.page);
	  });
	  }

	  function delivery(value) {
		if (typeof(value) === "undefined" || value == null || value.indexOf("/") == -1) return true;
		else {
		  var ddate = value.split("/");
		  var unix = new Date(ddate[2], parseInt(ddate[1]) - 1, parseInt(ddate[0]) + 1, 0, 0, 0, 0).getTime();
		  var delta = unix - new Date().getTime();
		  if (delta < 7862400000 && delta > 0) return true;
		  else return false;
		}
	  }
	  if (document.querySelector("[data-name=PO_DeliveryDate]")) {
		if (!delivery(document.querySelector("[data-name=PO_DeliveryDate]").value)) {
		  $('.nbsf .continue').addClass('disabled');
		  mo.fn.modal.show({
			ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
			title: hpe.fn.lang("ModalDeliveryDate", config.locale, config.localizations),
			content: '<p>' + hpe.fn.lang("ModalDeliveryDateMSG", config.locale, config.localizations) + '</p>',
		  });
		}
		
		$("[data-name=PO_DeliveryDate]").change(function() {
		if (!delivery(document.querySelector("[data-name=PO_DeliveryDate]").value)) {
		  $('.nbsf .continue').addClass('disabled');
		  mo.fn.modal.show({
			ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
			title: hpe.fn.lang("ModalDeliveryDate", config.locale, config.localizations),
			content: '<p>' + hpe.fn.lang("ModalDeliveryDateMSG", config.locale, config.localizations) + '</p>',
		  });
		} else {
		  // $('.nbsf .continue').removeClass('disabled');
		  nbsf.ev.global(config);
		}
	  });
	  }


	  let result = []
	  $('select[data-name="PO_BackgroundGroup"]').change(function() {
		let vl = $(this).val();
		result = assigntoteamValues.filter(x => (x.region.indexOf(config.dataset.Region) > -1 && x.PO_BackgroundGroup == vl));
		if (config.dataset.Region == "EMEA") {
		  config.dataset.AssignToTeam = result[0].teamName;
		} else if (config.dataset.Region == "AMS") {
		  if (vl == "Edge") config.dataset.AssignToTeam = result[0].teamName;
		  else {
			if (config.dataset.Country != "Brazil") config.dataset.AssignToTeam = result[1].teamName;
			else config.dataset.AssignToTeam = result[0].teamName;
		  }
		} else if (config.dataset.Region == "APJ") {
		  if (vl == "Edge") config.dataset.AssignToTeam = result[0].teamName;
		  else {
			if (config.dataset.CountryCode == "IN") config.dataset.AssignToTeam = result[0].teamName;
			else if (config.dataset.CountryCode == "JP") config.dataset.AssignToTeam = result[5].teamName;
			else if (config.dataset.CountryCode == "KR") config.dataset.AssignToTeam = result[3].teamName;
			else if (config.dataset.CountryCode == "AU" || config.dataset.CountryCode == "NZ") config.dataset.AssignToTeam = result[2].teamName;
			else if (config.dataset.CountryCode == "HK" || config.dataset.CountryCode == "TW") config.dataset.AssignToTeam = result[1].teamName;
			else config.dataset.AssignToTeam = result[4].teamName;
		  }
		} else config.dataset.AssignToTeam = "OTC WW ComputeStorage EAAS";
	  });
	  $("input[data-name=Config_UCIDQ]").focusout(function() {
		let vl = $(this).val();
		if (vl != '')
		  if (vl.slice(-1) != ';')
			vl = vl + ';'
		$(this).val(vl)
	  });
	  $("input[data-name=Config_UCID]").focusout(function() {
		let vl = $(this).val();
		if (vl != '')
		  if (vl.slice(-1) != ';')
			vl = vl + ';'
		$(this).val(vl)
	  });

	  if (document.querySelector('select[data-name="PO_Currency"]') && document.querySelector('select[data-name="PO_Currency"]').value == 'Select one')
		//if($('select[data-name="PO_Currency"] option').length == 1)
		$('select[data-name="PO_Currency"]').val($('select[data-name="PO_Currency"] option')[1].innerText).trigger('change');

	  if (document.querySelector('select[data-name="PA_Number"]') && global.data.brt.pas.length == 1 && document.querySelector('select[data-name="PA_Number"]').value == 'Select one')
		$('select[data-name="PA_Number"]').val($('select[data-name="PA_Number"] option')[1].innerText).trigger('change');

	  //PO_CompleteDelivery LOGIC FOR KR
	  if (document.querySelector('input[data-name="PO_CompleteDelivery"]') && !PO_CompleteDeliveryLogicCheck && (config.dataset.PO_CompleteDelivery == null || config.dataset.PO_CompleteDelivery == '' || config.dataset.PO_CompleteDelivery == 'N')){
		if(config.dataset.CountryCode == 'KR') {
		  config.dataset.PO_CompleteDelivery = 'Y';
		  PO_CompleteDeliveryLogicCheck = true;
		  nbsf.init(config, config.page);
		}
	  }

	  // Remove the "Stock" option from "Purchase order category" whenever PO_BusinessModel is not equal to "Trade"
	  if (document.querySelector('select[data-name="PO_BusinessModel"]')) {
		document.querySelector('select[data-name="PO_BusinessModel"]').addEventListener('change', function() {
		  let completedData = document.querySelectorAll('*[data-name]');
		  for (let i = 0; i < completedData.length; i++) {
			config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		  }
		  
		  config.dataset.PO_BusinessModel = $(this).val();
		  nbsf.init(config, config.page);
		});
	  }

	  //QOD logic for not turkey and MAP 
	  if(!QODCheck) {
		QODCheck = true;
		var config_QuoteToggle = document.querySelector('input[data-name="Config_Quote"]');
		var countryInfo = reference.countriesData.find(x => x.ISO2 == config.dataset.CountryCode);
		if(config.dataset.CountryCode == 'TR' || countryInfo && countryInfo.MAP == "Y")
		{
		  config.dataset.Config_Quote = "N";
		  nbsf.init(config, config.page);
		}
	  } 

	},
	page2: function() {
	  console.log('page2');
	  if (document.querySelector('label[for="Config_Tier1"]')) {
		$('label[for="Config_Tier1"]').click(function() {
		  $('input[name="Config_Tier1"]').trigger("change");
		});
		$('input[name="Config_Tier1"]').change(function() {
		  config.dataset.Config_Tier1 = $(this).val();
		  nbsf.init(config, config.page);
		});
		$('label[for="Config_Shipment_India"]').click(function() {
		  $('input[name="Config_Shipment_India"]').trigger("change");
		});
		$('input[name="Config_Shipment_India"]').change(function() {
		  config.dataset.Config_Shipment_India = $(this).val();
		  nbsf.init(config, config.page);
		});

		if (document.querySelector('*[data-name="Config_Business_Justification"]'))
		  document.querySelector('*[data-name="Config_Business_Justification"]').closest('.row').classList.add("customFilteredClassToggle9");

		if (document.querySelector('*[data-name="Config_Tier2"]'))
		  document.querySelector('*[data-name="Config_Tier2"]').closest('.row').classList.add("customFilteredClassToggle10");

		if (document.querySelector('*[data-name="Config_OEM"]'))
		  document.querySelector('*[data-name="Config_OEM"]').closest('.row').classList.add("customFilteredClassToggle11");

		if (document.querySelector('*[data-name="Config_Tier1"][value="Y"]'))
		  document.querySelector('*[data-name="Config_Tier1"]').closest('.row').classList.add("customFilteredClassToggle111");


	  }
	},
	page3: function() {
	  console.log('page3');
	  $('input[data-name="SoldTo_PartyId"]').keyup(function() {
		let currentVal = $(this).val();
		if (currentVal.length == 10) {
		  mo.fn.overlay.show({
			progressText: hpe.fn.lang("FormCFI010", config.locale, config.localizations),
			progressPercent: 10,
			close: false
		  })
		  hpe.data.xref(currentVal, function(d) {
			console.log(d)
			mo.fn.overlay.show({
			  progressText: hpe.fn.lang("FormCFI011", config.locale, config.localizations),
			  progressPercent: 40,
			  close: false
			})

			if (d.status == 'SUCCESS') {
			  config.dataset.xrefFail = 'No';
			  mo.fn.overlay.show({
				progressText: hpe.fn.lang("FormCFI012", config.locale, config.localizations),
				progressPercent: 80,
				close: false
			  })
			  // HIDDEN INPUT: SOLDTO
			  config.dataset.SoldTo_Address_Country = d.party[0].countryName;

			  let alternateName = '';
			  if (d.party[0].organizationAlternateName && d.party[0].organizationAlternateName.length > 0) {
				d.party[0].organizationAlternateName.forEach(function(item) {
				  if (
					item.internalOverWriteFlag === 'Y' &&
					item.status === 'ACTIVE' &&
					item.characterScript === 'LATN' &&
					item.type === 'TRADESTYLE'
				  ) {
					alternateName = item.organizationAlternateName;
				  }
				});
			  }
			  config.dataset.SoldTo_CompanyName = alternateName ? alternateName : d.party[0].organizationName;

			  let addressMatched = null;
			  if (d.party[0].address && d.party[0].address.length > 0) {
				addressMatched = d.party[0].address.find(item => {
				  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
				});

				if (!addressMatched) {
				  addressMatched = d.party[0].address.find(item => {
					return item.status == "ACTIVE" && item.addressType == "PHY";
				  });
				}

				if (addressMatched) {
				  if (["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1)
					config.dataset.SoldTo_Address_State = addressMatched.stateProvince;

				  let address1 = addressMatched.addressLine1;
				  let address2 = addressMatched.addressLine2;
				  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
					const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
					address1 = addressMatched.addressLine1.substr(0, separator);
					address2 = addressMatched.addressLine1.substr(separator + 1);
				  }

				  config.dataset.SoldTo_Address_City = addressMatched.cityName;
				  config.dataset.SoldTo_Address_Postal = addressMatched.postalCode;
				  config.dataset.SoldTo_Address_Street = address1;
				  config.dataset.SoldTo_Address_Street2 = address2;
				}
			  }

			  if (["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1) {
				var externalidentifier = d.party[0].externalIdentifier;
				for (i = 0; i < externalidentifier.length; i++) {
				  if (externalidentifier[i].status == "ACTIVE" && ["Tax Number 1"].indexOf(externalidentifier[i].externalIdentifierName) > -1) {
					config.dataset.SoldTo_NationalID = externalidentifier[i].identifierValue;
					break;
				  }
				}
			  }
			  nbsf.init(config, config.page);
			  setTimeout(function() {
				mo.fn.overlay.hide()
			  }, 1000);
			} else if (d.status == 'FAIL' && d.code == "EMS005") {
			  config.dataset.xrefFail = 'No';
			  setTimeout(function() {
				mo.fn.overlay.show({
				  progressText: hpe.fn.lang("FormCFI013", config.locale, config.localizations),
				  progressPercent: 100,
				  close: false
				});
				config.dataset.SoldTo_Address_Country = null;
				config.dataset.SoldTo_CompanyName = null;
				config.dataset.SoldTo_Address_State = null;
				config.dataset.SoldTo_Address_City = null;
				config.dataset.SoldTo_Address_Postal = null;
				config.dataset.SoldTo_Address_Street = null;
				config.dataset.SoldTo_Address_Street2 = null;
				config.dataset.SoldTo_NationalID = null;

				if (document.querySelector('*[data-name="SoldTo_Address_Country"]'))
				  $('*[data-name="SoldTo_Address_Country"]').val('');
				if (document.querySelector('*[data-name="SoldTo_CompanyName"]'))
				  $('*[data-name="SoldTo_CompanyName"]').val('');
				if (document.querySelector('*[data-name="SoldTo_Address_State"]'))
				  $('*[data-name="SoldTo_Address_State"]').val('');
				if (document.querySelector('*[data-name="SoldTo_Address_City"]'))
				  $('*[data-name="SoldTo_Address_City"]').val('');
				if (document.querySelector('*[data-name="SoldTo_Address_Postal"]'))
				  $('*[data-name="SoldTo_Address_Postal"]').val('');
				if (document.querySelector('*[data-name="SoldTo_Address_Street"]'))
				  $('*[data-name="SoldTo_Address_Street"]').val('');
				if (document.querySelector('*[data-name="SoldTo_Address_Street2"]'))
				  $('*[data-name="SoldTo_Address_Street2"]').val('');
				if (document.querySelector('*[data-name="SoldTo_NationalID"]'))
				  $('*[data-name="SoldTo_NationalID"]').val('');

				nbsf.init(config, config.page);
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				  content: d.message + ".",
				  ctaCallback: function() {
					mo.fn.events.closeAll();
				  },
				  contentCallback: function() {}
				});
			  }, 1000);
			} else {
			  config.dataset.xrefFail = 'Yes';
			  config.dataset.SoldTo_Address_Country = null;
			  config.dataset.SoldTo_CompanyName = null;
			  config.dataset.SoldTo_Address_State = null;
			  config.dataset.SoldTo_Address_City = null;
			  config.dataset.SoldTo_Address_Postal = null;
			  config.dataset.SoldTo_Address_Street = null;
			  config.dataset.SoldTo_Address_Street2 = null;
			  config.dataset.SoldTo_NationalID = null;

			  if (document.querySelector('*[data-name="SoldTo_Address_Country"]'))
				$('*[data-name="SoldTo_Address_Country"]').val('');
			  if (document.querySelector('*[data-name="SoldTo_CompanyName"]'))
				$('*[data-name="SoldTo_CompanyName"]').val('');
			  if (document.querySelector('*[data-name="SoldTo_Address_State"]'))
				$('*[data-name="SoldTo_Address_State"]').val('');
			  if (document.querySelector('*[data-name="SoldTo_Address_City"]'))
				$('*[data-name="SoldTo_Address_City"]').val('');
			  if (document.querySelector('*[data-name="SoldTo_Address_Postal"]'))
				$('*[data-name="SoldTo_Address_Postal"]').val('');
			  if (document.querySelector('*[data-name="SoldTo_Address_Street"]'))
				$('*[data-name="SoldTo_Address_Street"]').val('');
			  if (document.querySelector('*[data-name="SoldTo_Address_Street2"]'))
				$('*[data-name="SoldTo_Address_Street2"]').val('');
			  if (document.querySelector('*[data-name="SoldTo_NationalID"]'))
				$('*[data-name="SoldTo_NationalID"]').val('');
			  nbsf.init(config, config.page);
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				content: hpe.fn.lang("FormCFI014", config.locale, config.localizations),
				ctaCallback: function() {
				  mo.fn.events.closeAll();
				},
				contentCallback: function() {}
			  });
			}
		  });
		}
	  });

	  $('*[data-name*="SoldTo_"]').change(function() {
		if ($(this)[0].getAttribute("data-name") != 'SoldTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('SoldTo_Contact') == -1)
		  $('*[data-name="SoldTo_PartyId"]').val('');
	  });
	  $('*[data-name*="SoldTo_"]').keyup(function() {
		if ($(this)[0].getAttribute("data-name") != 'SoldTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('SoldTo_Contact') == -1)
		  $('*[data-name="SoldTo_PartyId"]').val('');
	  });
	  
	  // Disable some fields if quote is exist
	  quoteHelper.disableAddressQuoteData(config);
	},
	page4: function() {
	  console.log('page4');
	  $('input[data-name="Payer_PartyId"]').keyup(function() {
		let currentVal = $(this).val();
		if (currentVal.length == 10) {
		  mo.fn.overlay.show({
			progressText: hpe.fn.lang("FormCFI010", config.locale, config.localizations),
			progressPercent: 10,
			close: false
		  })
		  hpe.data.xref(currentVal, function(d) {
			mo.fn.overlay.show({
			  progressText: hpe.fn.lang("FormCFI011", config.locale, config.localizations),
			  progressPercent: 40,
			  close: false
			})

			if (d.status == 'SUCCESS') {
			  config.dataset.xrefFail = 'No';
			  mo.fn.overlay.show({
				progressText: hpe.fn.lang("FormCFI012", config.locale, config.localizations),
				progressPercent: 80,
				close: false
			  })
			  // HIDDEN INPUT: PAYER
			  config.dataset.Payer_Address_Country = d.party[0].countryName;
			  config.dataset.Payer_PartyId = d.party[0].currentPartyID;

			  let alternateName = '';
			  if (d.party[0].organizationAlternateName && d.party[0].organizationAlternateName.length > 0) {
				d.party[0].organizationAlternateName.forEach(function(item) {
				  if (
					item.internalOverWriteFlag === 'Y' &&
					item.status === 'ACTIVE' &&
					item.characterScript === 'LATN' &&
					item.type === 'TRADESTYLE'
				  ) {
					alternateName = item.organizationAlternateName;
				  }
				});
			  }
			  config.dataset.Payer_CompanyName = alternateName ? alternateName : d.party[0].organizationName;

			  let addressMatched = null;
			  if (d.party[0].address && d.party[0].address.length > 0) {
				addressMatched = d.party[0].address.find(item => {
				  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
				});

				if (!addressMatched) {
				  addressMatched = d.party[0].address.find(item => {
					return item.status == "ACTIVE" && item.addressType == "PHY";
				  });
				}

				if (addressMatched) {
				  if (["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1)
					config.dataset.Payer_Address_State = addressMatched.stateProvince;

				  let address1 = addressMatched.addressLine1;
				  let address2 = addressMatched.addressLine2;
				  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
					const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
					address1 = addressMatched.addressLine1.substr(0, separator);
					address2 = addressMatched.addressLine1.substr(separator + 1);
				  }

				  config.dataset.Payer_Address_City = addressMatched.cityName;
				  config.dataset.Payer_Address_Postal = addressMatched.postalCode;
				  config.dataset.Payer_Address_Street = address1;
				  config.dataset.Payer_Address_Street2 = address2;
				}
			  }		

			  nbsf.init(config, config.page);
			  setTimeout(function() {
				mo.fn.overlay.hide()
			  }, 1000);
			} else if (d.status == 'FAIL' && d.code == "EMS005") {
			  config.dataset.xrefFail = 'No';
			  setTimeout(function() {
				mo.fn.overlay.show({
				  progressText: hpe.fn.lang("FormCFI013", config.locale, config.localizations),
				  progressPercent: 100,
				  close: false
				});
				config.dataset.Payer_Address_Country = null;
				config.dataset.Payer_CompanyName = null;
				config.dataset.Payer_Address_State = null;
				config.dataset.Payer_Address_City = null;
				config.dataset.Payer_Address_Postal = null;
				config.dataset.Payer_Address_Street = null;
				config.dataset.Payer_Address_Street2 = null;
				config.dataset.Payer_NationalID = null;

				if (document.querySelector('*[data-name="Payer_Address_Country"]'))
				  $('*[data-name="Payer_Address_Country"]').val('');
				if (document.querySelector('*[data-name="Payer_CompanyName"]'))
				  $('*[data-name="Payer_CompanyName"]').val('');
				if (document.querySelector('*[data-name="Payer_Address_State"]'))
				  $('*[data-name="Payer_Address_State"]').val('');
				if (document.querySelector('*[data-name="Payer_Address_City"]'))
				  $('*[data-name="Payer_Address_City"]').val('');
				if (document.querySelector('*[data-name="Payer_Address_Postal"]'))
				  $('*[data-name="Payer_Address_Postal"]').val('');
				if (document.querySelector('*[data-name="Payer_Address_Street"]'))
				  $('*[data-name="Payer_Address_Street"]').val('');
				if (document.querySelector('*[data-name="Payer_Address_Street2"]'))
				  $('*[data-name="Payer_Address_Street2"]').val('');
				if (document.querySelector('*[data-name="Payer_NationalID"]'))
				  $('*[data-name="Payer_NationalID"]').val('');

				nbsf.init(config, config.page);
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				  content: d.message + ".",
				  ctaCallback: function() {
					mo.fn.events.closeAll();
				  },
				  contentCallback: function() {}
				});
			  }, 1000);
			} else {
			  config.dataset.xrefFail = 'Yes';
			  config.dataset.Payer_Address_Country = null;
			  config.dataset.Payer_CompanyName = null;
			  config.dataset.Payer_Address_State = null;
			  config.dataset.Payer_Address_City = null;
			  config.dataset.Payer_Address_Postal = null;
			  config.dataset.Payer_Address_Street = null;
			  config.dataset.Payer_Address_Street2 = null;
			  config.dataset.Payer_NationalID = null;

			  if (document.querySelector('*[data-name="Payer_Address_Country"]'))
				$('*[data-name="Payer_Address_Country"]').val('');
			  if (document.querySelector('*[data-name="Payer_CompanyName"]'))
				$('*[data-name="Payer_CompanyName"]').val('');
			  if (document.querySelector('*[data-name="Payer_Address_State"]'))
				$('*[data-name="Payer_Address_State"]').val('');
			  if (document.querySelector('*[data-name="Payer_Address_City"]'))
				$('*[data-name="Payer_Address_City"]').val('');
			  if (document.querySelector('*[data-name="Payer_Address_Postal"]'))
				$('*[data-name="Payer_Address_Postal"]').val('');
			  if (document.querySelector('*[data-name="Payer_Address_Street"]'))
				$('*[data-name="Payer_Address_Street"]').val('');
			  if (document.querySelector('*[data-name="Payer_Address_Street2"]'))
				$('*[data-name="Payer_Address_Street2"]').val('');
			  if (document.querySelector('*[data-name="Payer_NationalID"]'))
				$('*[data-name="Payer_NationalID"]').val('');
			  nbsf.init(config, config.page);
			  config.dataset.xrefFail = 'No';
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				content: hpe.fn.lang("FormCFI014", config.locale, config.localizations),
				ctaCallback: function() {
				  mo.fn.events.closeAll();
				},
				contentCallback: function() {}
			  });
			}
		  });
		}
	  });

	  $('*[data-name*="Payer_"]').change(function() {
		if ($(this)[0].getAttribute("data-name") != 'Payer_PartyId' && $(this)[0].getAttribute("data-name").indexOf('Payer_Contact') == -1)
		  $('*[data-name="Payer_PartyId"]').val('');
	  });
	  $('*[data-name*="Payer_"]').keyup(function() {
		if ($(this)[0].getAttribute("data-name") != 'Payer_PartyId' && $(this)[0].getAttribute("data-name").indexOf('Payer_Contact') == -1)
		  $('*[data-name="Payer_PartyId"]').val('');
	  });
	  
	  // Disable some fields if quote is exist
	  quoteHelper.disableAddressQuoteData(config);
	},
	page5: function() {
	  console.log('page5');
	  $('input[data-name="BillTo_PartyId"]').keyup(function() {
		let currentVal = $(this).val();
		if (currentVal.length == 10 && currentVal[0] == "1") {
		  mo.fn.overlay.show({
			progressText: hpe.fn.lang("FormCFI010", config.locale, config.localizations),
			progressPercent: 10,
			close: false
		  })
		  hpe.data.xref(currentVal, function(d) {
			mo.fn.overlay.show({
			  progressText: hpe.fn.lang("FormCFI011", config.locale, config.localizations),
			  progressPercent: 40,
			  close: false
			})

			if (d.status == 'SUCCESS') {
			  config.dataset.xrefFail = 'No';
			  mo.fn.overlay.show({
				progressText: hpe.fn.lang("FormCFI012", config.locale, config.localizations),
				progressPercent: 80,
				close: false
			  })
			  // HIDDEN INPUT: BILLING
			  config.dataset.BillTo_Address_Country = d.party[0].countryName;
			  config.dataset.BillTo_PartyId = d.party[0].currentPartyID;

			  let alternateName = '';
			  if (d.party[0].organizationAlternateName && d.party[0].organizationAlternateName.length > 0) {
				d.party[0].organizationAlternateName.forEach(function(item) {
				  if (
					item.internalOverWriteFlag === 'Y' &&
					item.status === 'ACTIVE' &&
					item.characterScript === 'LATN' &&
					item.type === 'TRADESTYLE'
				  ) {
					alternateName = item.organizationAlternateName;
				  }
				});
			  }
			  config.dataset.BillTo_CompanyName = alternateName ? alternateName : d.party[0].organizationName;

			  let addressMatched = null;
			  if (d.party[0].address && d.party[0].address.length > 0) {
				addressMatched = d.party[0].address.find(item => {
				  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
				});

				if (!addressMatched) {
				  addressMatched = d.party[0].address.find(item => {
					return item.status == "ACTIVE" && item.addressType == "PHY";
				  });
				}

				if (addressMatched) {
				  if (["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1)
					config.dataset.BillTo_Address_State = addressMatched.stateProvince;

				  let address1 = addressMatched.addressLine1;
				  let address2 = addressMatched.addressLine2;
				  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
					const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
					address1 = addressMatched.addressLine1.substr(0, separator);
					address2 = addressMatched.addressLine1.substr(separator + 1);
				  }

				  config.dataset.BillTo_Address_City = addressMatched.cityName;
				  config.dataset.BillTo_Address_Postal = addressMatched.postalCode;
				  config.dataset.BillTo_Address_Street = address1;
				  config.dataset.BillTo_Address_Street2 = address2;
				}
			  }		

			  nbsf.init(config, config.page);
			  setTimeout(function() {
				mo.fn.overlay.hide()
			  }, 1000);
			} else if (d.status == 'FAIL' && d.code == "EMS005") {
			  config.dataset.xrefFail = 'No';
			  setTimeout(function() {
				mo.fn.overlay.show({
				  progressText: hpe.fn.lang("FormCFI013", config.locale, config.localizations),
				  progressPercent: 100,
				  close: false
				});
				config.dataset.BillTo_Address_Country = null;
				config.dataset.BillTo_CompanyName = null;
				config.dataset.BillTo_Address_State = null;
				config.dataset.BillTo_Address_City = null;
				config.dataset.BillTo_Address_Postal = null;
				config.dataset.BillTo_Address_Street = null;
				config.dataset.BillTo_Address_Street2 = null;
				config.dataset.BillTo_NationalID = null;

				if (document.querySelector('*[data-name="BillTo_Address_Country"]'))
				  $('*[data-name="BillTo_Address_Country"]').val('');
				if (document.querySelector('*[data-name="BillTo_CompanyName"]'))
				  $('*[data-name="BillTo_CompanyName"]').val('');
				if (document.querySelector('*[data-name="BillTo_Address_State"]'))
				  $('*[data-name="BillTo_Address_State"]').val('');
				if (document.querySelector('*[data-name="BillTo_Address_City"]'))
				  $('*[data-name="BillTo_Address_City"]').val('');
				if (document.querySelector('*[data-name="BillTo_Address_Postal"]'))
				  $('*[data-name="BillTo_Address_Postal"]').val('');
				if (document.querySelector('*[data-name="BillTo_Address_Street"]'))
				  $('*[data-name="BillTo_Address_Street"]').val('');
				if (document.querySelector('*[data-name="BillTo_Address_Street2"]'))
				  $('*[data-name="BillTo_Address_Street2"]').val('');
				if (document.querySelector('*[data-name="BillTo_NationalID"]'))
				  $('*[data-name="BillTo_NationalID"]').val('');

				nbsf.init(config, config.page);
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				  content: d.message + ".",
				  ctaCallback: function() {
					mo.fn.events.closeAll();
				  },
				  contentCallback: function() {}
				});
			  }, 1000);
			} else {
			  config.dataset.xrefFail = 'Yes';
			  config.dataset.BillTo_Address_Country = null;
			  config.dataset.BillTo_CompanyName = null;
			  config.dataset.BillTo_Address_State = null;
			  config.dataset.BillTo_Address_City = null;
			  config.dataset.BillTo_Address_Postal = null;
			  config.dataset.BillTo_Address_Street = null;
			  config.dataset.BillTo_Address_Street2 = null;
			  config.dataset.BillTo_NationalID = null;

			  if (document.querySelector('*[data-name="BillTo_Address_Country"]'))
				$('*[data-name="BillTo_Address_Country"]').val('');
			  if (document.querySelector('*[data-name="BillTo_CompanyName"]'))
				$('*[data-name="BillTo_CompanyName"]').val('');
			  if (document.querySelector('*[data-name="BillTo_Address_State"]'))
				$('*[data-name="BillTo_Address_State"]').val('');
			  if (document.querySelector('*[data-name="BillTo_Address_City"]'))
				$('*[data-name="BillTo_Address_City"]').val('');
			  if (document.querySelector('*[data-name="BillTo_Address_Postal"]'))
				$('*[data-name="BillTo_Address_Postal"]').val('');
			  if (document.querySelector('*[data-name="BillTo_Address_Street"]'))
				$('*[data-name="BillTo_Address_Street"]').val('');
			  if (document.querySelector('*[data-name="BillTo_Address_Street2"]'))
				$('*[data-name="BillTo_Address_Street2"]').val('');
			  if (document.querySelector('*[data-name="BillTo_NationalID"]'))
				$('*[data-name="BillTo_NationalID"]').val('');
			  nbsf.init(config, config.page);
			  config.dataset.xrefFail = 'No';
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				content: hpe.fn.lang("FormCFI014", config.locale, config.localizations),
				ctaCallback: function() {
				  mo.fn.events.closeAll();
				},
				contentCallback: function() {}
			  });
			}
		  });
		}
	  });

	  $('*[data-name*="BillTo_"]').change(function() {
		if ($(this)[0].getAttribute("data-name") != 'BillTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('BillTo_Contact') == -1)
		  $('*[data-name="BillTo_PartyId"]').val('');
	  });
	  $('*[data-name*="BillTo_"]').keyup(function() {
		if ($(this)[0].getAttribute("data-name") != 'BillTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('BillTo_Contact') == -1)
		  $('*[data-name="BillTo_PartyId"]').val('');
	  });
	},
	page6: function() {
	  console.log('page6');
	  if (document.querySelector('input[data-name="ShipTo_NationalID"]'))
		$('*[data-name="ShipTo_NationalID"]').parent().parent().parent().parent().addClass('fixNationalID');
	  $('select[data-name="ShipTo_Address_Country"] option').click(function() {
		$('select[data-name="ShipTo_Address_Country"]').trigger("change");
	  });
	  $('select[data-name="ShipTo_Address_Country"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.ShipTo_Address_Country = $(this).val();
		nbsf.init(config, config.page);
	  });

	  $('input[data-name="ShipTo_PartyId"]').keyup(function() {
		let currentVal = $(this).val();
		if (currentVal.length == 10 && currentVal[0] == "1") {
		  config.dataset.ShipTo_PartyId = currentVal;
		  nbsf.init(config, config.page);
		  mo.fn.overlay.show({
			progressText: hpe.fn.lang("FormCFI010", config.locale, config.localizations),
			progressPercent: 10,
			close: false
		  })
		  hpe.data.xref(currentVal, function(d) {
			mo.fn.overlay.show({
			  progressText: hpe.fn.lang("FormCFI011", config.locale, config.localizations),
			  progressPercent: 40,
			  close: false
			})

			if (d.status == 'SUCCESS') {
			  config.dataset.xrefFail = 'No';
			  mo.fn.overlay.show({
				progressText: hpe.fn.lang("FormCFI012", config.locale, config.localizations),
				progressPercent: 80,
				close: false
			  })
			  // HIDDEN INPUT: ShipTo
			  config.dataset.ShipTo_Address_Country = d.party[0].countryName;
			  config.dataset.ShipTo_PartyId = d.party[0].currentPartyID;

			  let alternateName = '';
			  if (d.party[0].organizationAlternateName && d.party[0].organizationAlternateName.length > 0) {
				d.party[0].organizationAlternateName.forEach(function(item) {
				  if (
					item.internalOverWriteFlag === 'Y' &&
					item.status === 'ACTIVE' &&
					item.characterScript === 'LATN' &&
					item.type === 'TRADESTYLE'
				  ) {
					alternateName = item.organizationAlternateName;
				  }
				});
			  }
			  config.dataset.ShipTo_CompanyName = alternateName ? alternateName : d.party[0].organizationName;

			  let addressMatched = null;
			  if (d.party[0].address && d.party[0].address.length > 0) {
				addressMatched = d.party[0].address.find(item => {
				  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
				});

				if (!addressMatched) {
				  addressMatched = d.party[0].address.find(item => {
					return item.status == "ACTIVE" && item.addressType == "PHY";
				  });
				}

				if (addressMatched) {
				  if (["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1)
					config.dataset.ShipTo_Address_State = addressMatched.stateProvince;

				  let address1 = addressMatched.addressLine1;
				  let address2 = addressMatched.addressLine2;
				  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
					const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
					address1 = addressMatched.addressLine1.substr(0, separator);
					address2 = addressMatched.addressLine1.substr(separator + 1);
				  }

				  config.dataset.ShipTo_Address_City = addressMatched.cityName;
				  config.dataset.ShipTo_Address_Postal = addressMatched.postalCode;
				  config.dataset.ShipTo_Address_Street = address1;
				  config.dataset.ShipTo_Address_Street2 = address2;
				}
			  }

			  if (["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1) {
				var externalidentifier = d.party[0].externalIdentifier;
				for (i = 0; i < externalidentifier.length; i++) {
				  if (externalidentifier[i].status == "ACTIVE" && ["Tax Number 1"].indexOf(externalidentifier[i].externalIdentifierName) > -1) {
					config.dataset.ShipTo_NationalID = externalidentifier[i].identifierValue;
					break;
				  }
				}
			  }
			  nbsf.init(config, config.page);
			  setTimeout(function() {
				mo.fn.overlay.hide()
			  }, 1000);
			} else if (d.status == 'FAIL' && d.code == "EMS005") {
			  config.dataset.xrefFail = 'No';
			  setTimeout(function() {
				mo.fn.overlay.show({
				  progressText: hpe.fn.lang("FormCFI013", config.locale, config.localizations),
				  progressPercent: 100,
				  close: false
				});
				config.dataset.ShipTo_Address_Country = null;
				config.dataset.ShipTo_CompanyName = null;
				config.dataset.ShipTo_Address_State = null;
				config.dataset.ShipTo_Address_City = null;
				config.dataset.ShipTo_Address_Postal = null;
				config.dataset.ShipTo_Address_Street = null;
				config.dataset.ShipTo_Address_Street2 = null;
				config.dataset.ShipTo_NationalID = null;

				if (document.querySelector('*[data-name="ShipTo_Address_Country"]'))
				  $('*[data-name="ShipTo_Address_Country"]').val('');
				if (document.querySelector('*[data-name="ShipTo_CompanyName"]'))
				  $('*[data-name="ShipTo_CompanyName"]').val('');
				if (document.querySelector('*[data-name="ShipTo_Address_State"]'))
				  $('*[data-name="ShipTo_Address_State"]').val('');
				if (document.querySelector('*[data-name="ShipTo_Address_City"]'))
				  $('*[data-name="ShipTo_Address_City"]').val('');
				if (document.querySelector('*[data-name="ShipTo_Address_Postal"]'))
				  $('*[data-name="ShipTo_Address_Postal"]').val('');
				if (document.querySelector('*[data-name="ShipTo_Address_Street"]'))
				  $('*[data-name="ShipTo_Address_Street"]').val('');
				if (document.querySelector('*[data-name="ShipTo_Address_Street2"]'))
				  $('*[data-name="ShipTo_Address_Street2"]').val('');
				if (document.querySelector('*[data-name="ShipTo_NationalID"]'))
				  $('*[data-name="ShipTo_NationalID"]').val('');

				nbsf.init(config, config.page);
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				  content: d.message + ".",
				  ctaCallback: function() {
					mo.fn.events.closeAll();
				  },
				  contentCallback: function() {}
				});
			  }, 1000);
			} else {
			  config.dataset.xrefFail = 'Yes';
			  config.dataset.ShipTo_Address_Country = null;
			  config.dataset.ShipTo_CompanyName = null;
			  config.dataset.ShipTo_Address_State = null;
			  config.dataset.ShipTo_Address_City = null;
			  config.dataset.ShipTo_Address_Postal = null;
			  config.dataset.ShipTo_Address_Street = null;
			  config.dataset.ShipTo_Address_Street2 = null;
			  config.dataset.ShipTo_NationalID = null;

			  if (document.querySelector('*[data-name="ShipTo_Address_Country"]'))
				$('*[data-name="ShipTo_Address_Country"]').val('');
			  if (document.querySelector('*[data-name="ShipTo_CompanyName"]'))
				$('*[data-name="ShipTo_CompanyName"]').val('');
			  if (document.querySelector('*[data-name="ShipTo_Address_State"]'))
				$('*[data-name="ShipTo_Address_State"]').val('');
			  if (document.querySelector('*[data-name="ShipTo_Address_City"]'))
				$('*[data-name="ShipTo_Address_City"]').val('');
			  if (document.querySelector('*[data-name="ShipTo_Address_Postal"]'))
				$('*[data-name="ShipTo_Address_Postal"]').val('');
			  if (document.querySelector('*[data-name="ShipTo_Address_Street"]'))
				$('*[data-name="ShipTo_Address_Street"]').val('');
			  if (document.querySelector('*[data-name="ShipTo_Address_Street2"]'))
				$('*[data-name="ShipTo_Address_Street2"]').val('');
			  if (document.querySelector('*[data-name="ShipTo_NationalID"]'))
				$('*[data-name="ShipTo_NationalID"]').val('');
			  nbsf.init(config, config.page);
			  config.dataset.xrefFail = 'No';
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				content: hpe.fn.lang("FormCFI014", config.locale, config.localizations),
				ctaCallback: function() {
				  mo.fn.events.closeAll();
				},
				contentCallback: function() {}
			  });
			}
		  });
		} else if (currentVal.length == 10 && currentVal[0] == "2") {
		  config.dataset.ShipTo_PartyId = currentVal;
		  nbsf.init(config, config.page);
		}
	  });

	  $('*[data-name*="ShipTo_"]').change(function() {
		if ($(this)[0].getAttribute("data-name") != 'ShipTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('ShipTo_Contact') == -1)
		  $('*[data-name="ShipTo_PartyId"]').val('');
	  });
	  $('*[data-name*="ShipTo_"]').keyup(function() {
		if ($(this)[0].getAttribute("data-name") != 'ShipTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('ShipTo_Contact') == -1)
		  $('*[data-name="ShipTo_PartyId"]').val('');
	  });
	},
	page7: function() {
	  console.log('page7');
	  if (document.querySelector('input[data-name="EndCx_NationalID"]'))
		$('*[data-name="EndCx_NationalID"]').parent().parent().parent().parent().addClass('fixNationalID');
	  $('select[data-name="EndCx_Address_Country"] option').click(function() {
		console.log('click');
		$('select[data-name="EndCx_Address_Country"]').trigger("change");
	  });
	  $('select[data-name="EndCx_Address_Country"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.EndCx_Address_Country = $(this).val();
		nbsf.init(config, config.page);
	  });

	  $('input[data-name="EndCx_PartyId"]').keyup(function() {
		let currentVal = $(this).val();
		if (currentVal.length == 10) {
		  mo.fn.overlay.show({
			progressText: hpe.fn.lang("FormCFI010", config.locale, config.localizations),
			progressPercent: 10,
			close: false
		  })
		  hpe.data.xref(currentVal, function(d) {
			mo.fn.overlay.show({
			  progressText: hpe.fn.lang("FormCFI011", config.locale, config.localizations),
			  progressPercent: 40,
			  close: false
			})

			if (d.status == 'SUCCESS') {
			  config.dataset.xrefFail = 'No';
			  mo.fn.overlay.show({
				progressText: hpe.fn.lang("FormCFI012", config.locale, config.localizations),
				progressPercent: 80,
				close: false
			  })
			  // HIDDEN INPUT: EndCx
			  config.dataset.EndCx_Address_Country = d.party[0].countryName;
			  config.dataset.EndCx_PartyId = d.party[0].currentPartyID;

			  let alternateName = '';
			  if (d.party[0].organizationAlternateName && d.party[0].organizationAlternateName.length > 0) {
				d.party[0].organizationAlternateName.forEach(function(item) {
				  if (
					item.internalOverWriteFlag === 'Y' &&
					item.status === 'ACTIVE' &&
					item.characterScript === 'LATN' &&
					item.type === 'TRADESTYLE'
				  ) {
					alternateName = item.organizationAlternateName;
				  }
				});
			  }
			  config.dataset.EndCx_CompanyName = alternateName ? alternateName : d.party[0].organizationName;

			  let addressMatched = null;
			  if (d.party[0].address && d.party[0].address.length > 0) {
				addressMatched = d.party[0].address.find(item => {
				  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
				});

				if (!addressMatched) {
				  addressMatched = d.party[0].address.find(item => {
					return item.status == "ACTIVE" && item.addressType == "PHY";
				  });
				}

				if (addressMatched) {
				  if (["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1)
					config.dataset.EndCx_Address_State = addressMatched.stateProvince;

				  let address1 = addressMatched.addressLine1;
				  let address2 = addressMatched.addressLine2;
				  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
					const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
					address1 = addressMatched.addressLine1.substr(0, separator);
					address2 = addressMatched.addressLine1.substr(separator + 1);
				  }

				  config.dataset.EndCx_Address_City = addressMatched.cityName;
				  config.dataset.EndCx_Address_Postal = addressMatched.postalCode;
				  config.dataset.EndCx_Address_Street = address1;
				  config.dataset.EndCx_Address_Street2 = address2;
				}
			  }

			  if (["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1) {
				var externalidentifier = d.party[0].externalIdentifier;
				for (i = 0; i < externalidentifier.length; i++) {
				  if (externalidentifier[i].status == "ACTIVE" && ["Tax Number 1"].indexOf(externalidentifier[i].externalIdentifierName) > -1) {
					config.dataset.EndCx_NationalID = externalidentifier[i].identifierValue;
					break;
				  }
				}
			  }
			  nbsf.init(config, config.page);
			  setTimeout(function() {
				mo.fn.overlay.hide()
			  }, 1000);
			} else if (d.status == 'FAIL' && d.code == "EMS005") {
			  config.dataset.xrefFail = 'No';
			  setTimeout(function() {
				mo.fn.overlay.show({
				  progressText: hpe.fn.lang("FormCFI013", config.locale, config.localizations),
				  progressPercent: 100,
				  close: false
				});
				config.dataset.EndCx_Address_Country = null;
				config.dataset.EndCx_CompanyName = null;
				config.dataset.EndCx_Address_State = null;
				config.dataset.EndCx_Address_City = null;
				config.dataset.EndCx_Address_Postal = null;
				config.dataset.EndCx_Address_Street = null;
				config.dataset.EndCx_Address_Street2 = null;
				config.dataset.EndCx_NationalID = null;

				if (document.querySelector('*[data-name="EndCx_Address_Country"]'))
				  $('*[data-name="EndCx_Address_Country"]').val('');
				if (document.querySelector('*[data-name="EndCx_CompanyName"]'))
				  $('*[data-name="EndCx_CompanyName"]').val('');
				if (document.querySelector('*[data-name="EndCx_Address_State"]'))
				  $('*[data-name="EndCx_Address_State"]').val('');
				if (document.querySelector('*[data-name="EndCx_Address_City"]'))
				  $('*[data-name="EndCx_Address_City"]').val('');
				if (document.querySelector('*[data-name="EndCx_Address_Postal"]'))
				  $('*[data-name="EndCx_Address_Postal"]').val('');
				if (document.querySelector('*[data-name="EndCx_Address_Street"]'))
				  $('*[data-name="EndCx_Address_Street"]').val('');
				if (document.querySelector('*[data-name="EndCx_Address_Street2"]'))
				  $('*[data-name="EndCx_Address_Street2"]').val('');
				if (document.querySelector('*[data-name="EndCx_NationalID"]'))
				  $('*[data-name="EndCx_NationalID"]').val('');

				nbsf.init(config, config.page);
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				  content: d.message + ".",
				  ctaCallback: function() {
					mo.fn.events.closeAll();
				  },
				  contentCallback: function() {}
				});
			  }, 1000);
			} else {
			  config.dataset.xrefFail = 'Yes';
			  config.dataset.EndCx_Address_Country = null;
			  config.dataset.EndCx_CompanyName = null;
			  config.dataset.EndCx_Address_State = null;
			  config.dataset.EndCx_Address_City = null;
			  config.dataset.EndCx_Address_Postal = null;
			  config.dataset.EndCx_Address_Street = null;
			  config.dataset.EndCx_Address_Street2 = null;
			  config.dataset.EndCx_NationalID = null;

			  if (document.querySelector('*[data-name="EndCx_Address_Country"]'))
				$('*[data-name="EndCx_Address_Country"]').val('');
			  if (document.querySelector('*[data-name="EndCx_CompanyName"]'))
				$('*[data-name="EndCx_CompanyName"]').val('');
			  if (document.querySelector('*[data-name="EndCx_Address_State"]'))
				$('*[data-name="EndCx_Address_State"]').val('');
			  if (document.querySelector('*[data-name="EndCx_Address_City"]'))
				$('*[data-name="EndCx_Address_City"]').val('');
			  if (document.querySelector('*[data-name="EndCx_Address_Postal"]'))
				$('*[data-name="EndCx_Address_Postal"]').val('');
			  if (document.querySelector('*[data-name="EndCx_Address_Street"]'))
				$('*[data-name="EndCx_Address_Street"]').val('');
			  if (document.querySelector('*[data-name="EndCx_Address_Street2"]'))
				$('*[data-name="EndCx_Address_Street2"]').val('');
			  if (document.querySelector('*[data-name="EndCx_NationalID"]'))
				$('*[data-name="EndCx_NationalID"]').val('');
			  nbsf.init(config, config.page);
			  config.dataset.xrefFail = 'No';
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				content: hpe.fn.lang("FormCFI014", config.locale, config.localizations),
				ctaCallback: function() {
				  mo.fn.events.closeAll();
				},
				contentCallback: function() {}
			  });
			}
		  });
		}
	  });

	  $('*[data-name*="EndCx_"]').change(function() {
		if ($(this)[0].getAttribute("data-name") != 'EndCx_PartyId' && $(this)[0].getAttribute("data-name").indexOf('EndCx_Contact') == -1)
		  $('*[data-name="EndCx_PartyId"]').val('');
	  });
	  $('*[data-name*="EndCx_"]').keyup(function() {
		if ($(this)[0].getAttribute("data-name") != 'EndCx_PartyId' && $(this)[0].getAttribute("data-name").indexOf('EndCx_Contact') == -1)
		  $('*[data-name="EndCx_PartyId"]').val('');
	  });
	  
	  // Disable some fields if quote is exist
	  quoteHelper.disableAddressQuoteData(config);
	},
	page8: function() {
	  console.log('page8');
	  if (document.querySelector('input[data-name="Reseller_NationalID"]'))
		$('*[data-name="Reseller_NationalID"]').parent().parent().parent().parent().addClass('fixNationalID');
	  $('select[data-name="Reseller_Address_Country"] option').click(function() {
		console.log('click');
		$('select[data-name="Reseller_Address_Country"]').trigger("change");
	  });
	  $('select[data-name="Reseller_Address_Country"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Reseller_Address_Country = $(this).val();
		nbsf.init(config, config.page);
	  });

	  $('input[data-name="Reseller_PartyId"]').keyup(function() {
		let currentVal = $(this).val();
		if (currentVal.length == 10) {
		  mo.fn.overlay.show({
			progressText: hpe.fn.lang("FormCFI010", config.locale, config.localizations),
			progressPercent: 10,
			close: false
		  })
		  hpe.data.xref(currentVal, function(d) {
			mo.fn.overlay.show({
			  progressText: hpe.fn.lang("FormCFI011", config.locale, config.localizations),
			  progressPercent: 40,
			  close: false
			})

			if (d.status == 'SUCCESS') {
			  config.dataset.xrefFail = 'No';
			  mo.fn.overlay.show({
				progressText: hpe.fn.lang("FormCFI012", config.locale, config.localizations),
				progressPercent: 80,
				close: false
			  })
			  // HIDDEN INPUT: Reseller
			  config.dataset.Reseller_Address_Country = d.party[0].countryName;
			  config.dataset.Reseller_PartyId = d.party[0].currentPartyID;

			  let alternateName = '';
			  if (d.party[0].organizationAlternateName && d.party[0].organizationAlternateName.length > 0) {
				d.party[0].organizationAlternateName.forEach(function(item) {
				  if (
					item.internalOverWriteFlag === 'Y' &&
					item.status === 'ACTIVE' &&
					item.characterScript === 'LATN' &&
					item.type === 'TRADESTYLE'
				  ) {
					alternateName = item.organizationAlternateName;
				  }
				});
			  }
			  config.dataset.Reseller_CompanyName = alternateName ? alternateName : d.party[0].organizationName;

			  let addressMatched = null;
			  if (d.party[0].address && d.party[0].address.length > 0) {
				addressMatched = d.party[0].address.find(item => {
				  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
				});

				if (!addressMatched) {
				  addressMatched = d.party[0].address.find(item => {
					return item.status == "ACTIVE" && item.addressType == "PHY";
				  });
				}

				if (addressMatched) {
				  if (["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1)
					config.dataset.Reseller_Address_State = addressMatched.stateProvince;

				  let address1 = addressMatched.addressLine1;
				  let address2 = addressMatched.addressLine2;
				  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
					const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
					address1 = addressMatched.addressLine1.substr(0, separator);
					address2 = addressMatched.addressLine1.substr(separator + 1);
				  }

				  config.dataset.Reseller_Address_City = addressMatched.cityName;
				  config.dataset.Reseller_Address_Postal = addressMatched.postalCode;
				  config.dataset.Reseller_Address_Street = address1;
				  config.dataset.Reseller_Address_Street2 = address2;
				}
			  }

			  if (["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1) {
				var externalidentifier = d.party[0].externalIdentifier;
				for (i = 0; i < externalidentifier.length; i++) {
				  if (externalidentifier[i].status == "ACTIVE" && ["Tax Number 1"].indexOf(externalidentifier[i].externalIdentifierName) > -1) {
					config.dataset.Reseller_NationalID = externalidentifier[i].identifierValue;
					break;
				  }
				}
			  }
			  nbsf.init(config, config.page);
			  setTimeout(function() {
				mo.fn.overlay.hide()
			  }, 1000);
			} else if (d.status == 'FAIL' && d.code == "EMS005") {
			  config.dataset.xrefFail = 'No';
			  setTimeout(function() {
				mo.fn.overlay.show({
				  progressText: hpe.fn.lang("FormCFI013", config.locale, config.localizations),
				  progressPercent: 100,
				  close: false
				});
				config.dataset.Reseller_Address_Country = null;
				config.dataset.Reseller_CompanyName = null;
				config.dataset.Reseller_Address_State = null;
				config.dataset.Reseller_Address_City = null;
				config.dataset.Reseller_Address_Postal = null;
				config.dataset.Reseller_Address_Street = null;
				config.dataset.Reseller_Address_Street2 = null;
				config.dataset.Reseller_NationalID = null;

				if (document.querySelector('*[data-name="Reseller_Address_Country"]'))
				  $('*[data-name="Reseller_Address_Country"]').val('');
				if (document.querySelector('*[data-name="Reseller_CompanyName"]'))
				  $('*[data-name="Reseller_CompanyName"]').val('');
				if (document.querySelector('*[data-name="Reseller_Address_State"]'))
				  $('*[data-name="Reseller_Address_State"]').val('');
				if (document.querySelector('*[data-name="Reseller_Address_City"]'))
				  $('*[data-name="Reseller_Address_City"]').val('');
				if (document.querySelector('*[data-name="Reseller_Address_Postal"]'))
				  $('*[data-name="Reseller_Address_Postal"]').val('');
				if (document.querySelector('*[data-name="Reseller_Address_Street"]'))
				  $('*[data-name="Reseller_Address_Street"]').val('');
				if (document.querySelector('*[data-name="Reseller_Address_Street2"]'))
				  $('*[data-name="Reseller_Address_Street2"]').val('');
				if (document.querySelector('*[data-name="Reseller_NationalID"]'))
				  $('*[data-name="Reseller_NationalID"]').val('');

				nbsf.init(config, config.page);
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				  content: d.message + ".",
				  ctaCallback: function() {
					mo.fn.events.closeAll();
				  },
				  contentCallback: function() {}
				});
			  }, 1000);
			} else {
			  config.dataset.xrefFail = 'Yes';
			  config.dataset.Reseller_Address_Country = null;
			  config.dataset.Reseller_CompanyName = null;
			  config.dataset.Reseller_Address_State = null;
			  config.dataset.Reseller_Address_City = null;
			  config.dataset.Reseller_Address_Postal = null;
			  config.dataset.Reseller_Address_Street = null;
			  config.dataset.Reseller_Address_Street2 = null;
			  config.dataset.Reseller_NationalID = null;

			  if (document.querySelector('*[data-name="Reseller_Address_Country"]'))
				$('*[data-name="Reseller_Address_Country"]').val('');
			  if (document.querySelector('*[data-name="Reseller_CompanyName"]'))
				$('*[data-name="Reseller_CompanyName"]').val('');
			  if (document.querySelector('*[data-name="Reseller_Address_State"]'))
				$('*[data-name="Reseller_Address_State"]').val('');
			  if (document.querySelector('*[data-name="Reseller_Address_City"]'))
				$('*[data-name="Reseller_Address_City"]').val('');
			  if (document.querySelector('*[data-name="Reseller_Address_Postal"]'))
				$('*[data-name="Reseller_Address_Postal"]').val('');
			  if (document.querySelector('*[data-name="Reseller_Address_Street"]'))
				$('*[data-name="Reseller_Address_Street"]').val('');
			  if (document.querySelector('*[data-name="Reseller_Address_Street2"]'))
				$('*[data-name="Reseller_Address_Street2"]').val('');
			  if (document.querySelector('*[data-name="Reseller_NationalID"]'))
				$('*[data-name="Reseller_NationalID"]').val('');
			  nbsf.init(config, config.page);
			  config.dataset.xrefFail = 'No';
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				content: hpe.fn.lang("FormCFI014", config.locale, config.localizations),
				ctaCallback: function() {
				  mo.fn.events.closeAll();
				},
				contentCallback: function() {}
			  });
			}
		  });
		}
	  });

	  $('*[data-name*="Reseller_"]').change(function() {
		if ($(this)[0].getAttribute("data-name") != 'Reseller_PartyId' && $(this)[0].getAttribute("data-name").indexOf('Reseller_Contact') == -1)
		  $('*[data-name="Reseller_PartyId"]').val('');
	  });
	  $('*[data-name*="Reseller_"]').keyup(function() {
		if ($(this)[0].getAttribute("data-name") != 'Reseller_PartyId' && $(this)[0].getAttribute("data-name").indexOf('Reseller_Contact') == -1)
		  $('*[data-name="Reseller_PartyId"]').val('');
	  });
	},
	page9: function() {
	  console.log('page9');
	  $('input[data-name="CustomShipTo_PartyId"]').keyup(function() {
		let currentVal = $(this).val();
		if (currentVal.length == 10) {
		  mo.fn.overlay.show({
			progressText: hpe.fn.lang("FormCFI010", config.locale, config.localizations),
			progressPercent: 10,
			close: false
		  })
		  hpe.data.xref(currentVal, function(d) {
			mo.fn.overlay.show({
			  progressText: hpe.fn.lang("FormCFI011", config.locale, config.localizations),
			  progressPercent: 40,
			  close: false
			})

			if (d.status == 'SUCCESS') {
			  config.dataset.xrefFail = 'No';
			  mo.fn.overlay.show({
				progressText: hpe.fn.lang("FormCFI012", config.locale, config.localizations),
				progressPercent: 80,
				close: false
			  })
			  // HIDDEN INPUT: CustomShipTo
			  config.dataset.CustomShipTo_Address_Country = d.party[0].countryName;
			  config.dataset.CustomShipTo_PartyId = d.party[0].currentPartyID;

			  let alternateName = '';
			  if (d.party[0].organizationAlternateName && d.party[0].organizationAlternateName.length > 0) {
				d.party[0].organizationAlternateName.forEach(function(item) {
				  if (
					item.internalOverWriteFlag === 'Y' &&
					item.status === 'ACTIVE' &&
					item.characterScript === 'LATN' &&
					item.type === 'TRADESTYLE'
				  ) {
					alternateName = item.organizationAlternateName;
				  }
				});
			  }
			  config.dataset.CustomShipTo_CompanyName = alternateName ? alternateName : d.party[0].organizationName;

			  let addressMatched = null;
			  if (d.party[0].address && d.party[0].address.length > 0) {
				addressMatched = d.party[0].address.find(item => {
				  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
				});

				if (!addressMatched) {
				  addressMatched = d.party[0].address.find(item => {
					return item.status == "ACTIVE" && item.addressType == "PHY";
				  });
				}

				if (addressMatched) {
				  if (["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1)
					config.dataset.CustomShipTo_Address_State = addressMatched.stateProvince;

				  let address1 = addressMatched.addressLine1;
				  let address2 = addressMatched.addressLine2;
				  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
					const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
					address1 = addressMatched.addressLine1.substr(0, separator);
					address2 = addressMatched.addressLine1.substr(separator + 1);
				  }

				  config.dataset.CustomShipTo_Address_City = addressMatched.cityName;
				  config.dataset.CustomShipTo_Address_Postal = addressMatched.postalCode;
				  config.dataset.CustomShipTo_Address_Street = address1;
				  config.dataset.CustomShipTo_Address_Street2 = address2;
				}
			  }

			  if (["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"].indexOf(d.party[0].countryName) > -1) {
				var externalidentifier = d.party[0].externalIdentifier;
				for (i = 0; i < externalidentifier.length; i++) {
				  if (externalidentifier[i].status == "ACTIVE" && ["Tax Number 1"].indexOf(externalidentifier[i].externalIdentifierName) > -1) {
					config.dataset.CustomShipTo_NationalID = externalidentifier[i].identifierValue;
					break;
				  }
				}
			  }
			  nbsf.init(config, config.page);
			  setTimeout(function() {
				mo.fn.overlay.hide()
			  }, 1000);
			} else if (d.status == 'FAIL' && d.code == "EMS005") {
			  config.dataset.xrefFail = 'No';
			  setTimeout(function() {
				mo.fn.overlay.show({
				  progressText: hpe.fn.lang("FormCFI013", config.locale, config.localizations),
				  progressPercent: 100,
				  close: false
				});
				config.dataset.CustomShipTo_Address_Country = null;
				config.dataset.CustomShipTo_CompanyName = null;
				config.dataset.CustomShipTo_Address_State = null;
				config.dataset.CustomShipTo_Address_City = null;
				config.dataset.CustomShipTo_Address_Postal = null;
				config.dataset.CustomShipTo_Address_Street = null;
				config.dataset.CustomShipTo_Address_Street2 = null;
				config.dataset.CustomShipTo_NationalID = null;

				if (document.querySelector('*[data-name="CustomShipTo_Address_Country"]'))
				  $('*[data-name="CustomShipTo_Address_Country"]').val('');
				if (document.querySelector('*[data-name="CustomShipTo_CompanyName"]'))
				  $('*[data-name="CustomShipTo_CompanyName"]').val('');
				if (document.querySelector('*[data-name="CustomShipTo_Address_State"]'))
				  $('*[data-name="CustomShipTo_Address_State"]').val('');
				if (document.querySelector('*[data-name="CustomShipTo_Address_City"]'))
				  $('*[data-name="CustomShipTo_Address_City"]').val('');
				if (document.querySelector('*[data-name="CustomShipTo_Address_Postal"]'))
				  $('*[data-name="CustomShipTo_Address_Postal"]').val('');
				if (document.querySelector('*[data-name="CustomShipTo_Address_Street"]'))
				  $('*[data-name="CustomShipTo_Address_Street"]').val('');
				if (document.querySelector('*[data-name="CustomShipTo_Address_Street2"]'))
				  $('*[data-name="CustomShipTo_Address_Street2"]').val('');
				if (document.querySelector('*[data-name="CustomShipTo_NationalID"]'))
				  $('*[data-name="CustomShipTo_NationalID"]').val('');

				nbsf.init(config, config.page);
				mo.fn.modal.show({
				  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				  content: d.message + ".",
				  ctaCallback: function() {
					mo.fn.events.closeAll();
				  },
				  contentCallback: function() {}
				});
			  }, 1000);
			} else {
			  config.dataset.xrefFail = 'Yes';
			  config.dataset.CustomShipTo_Address_Country = null;
			  config.dataset.CustomShipTo_CompanyName = null;
			  config.dataset.CustomShipTo_Address_State = null;
			  config.dataset.CustomShipTo_Address_City = null;
			  config.dataset.CustomShipTo_Address_Postal = null;
			  config.dataset.CustomShipTo_Address_Street = null;
			  config.dataset.CustomShipTo_Address_Street2 = null;
			  config.dataset.CustomShipTo_NationalID = null;

			  if (document.querySelector('*[data-name="CustomShipTo_Address_Country"]'))
				$('*[data-name="CustomShipTo_Address_Country"]').val('');
			  if (document.querySelector('*[data-name="CustomShipTo_CompanyName"]'))
				$('*[data-name="CustomShipTo_CompanyName"]').val('');
			  if (document.querySelector('*[data-name="CustomShipTo_Address_State"]'))
				$('*[data-name="CustomShipTo_Address_State"]').val('');
			  if (document.querySelector('*[data-name="CustomShipTo_Address_City"]'))
				$('*[data-name="CustomShipTo_Address_City"]').val('');
			  if (document.querySelector('*[data-name="CustomShipTo_Address_Postal"]'))
				$('*[data-name="CustomShipTo_Address_Postal"]').val('');
			  if (document.querySelector('*[data-name="CustomShipTo_Address_Street"]'))
				$('*[data-name="CustomShipTo_Address_Street"]').val('');
			  if (document.querySelector('*[data-name="CustomShipTo_Address_Street2"]'))
				$('*[data-name="CustomShipTo_Address_Street2"]').val('');
			  if (document.querySelector('*[data-name="CustomShipTo_NationalID"]'))
				$('*[data-name="CustomShipTo_NationalID"]').val('');
			  nbsf.init(config, config.page);
			  config.dataset.xrefFail = 'No';
			  mo.fn.modal.show({
				ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
				title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
				content: hpe.fn.lang("FormCFI014", config.locale, config.localizations),
				ctaCallback: function() {
				  mo.fn.events.closeAll();
				},
				contentCallback: function() {}
			  });
			}
		  });
		}
	  });

	  $('*[data-name*="CustomShipTo_"]').change(function() {
		if ($(this)[0].getAttribute("data-name") != 'CustomShipTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('CustomShipTo_Contact') == -1)
		  $('*[data-name="CustomShipTo_PartyId"]').val('');
	  });
	  $('*[data-name*="CustomShipTo_"]').keyup(function() {
		if ($(this)[0].getAttribute("data-name") != 'CustomShipTo_PartyId' && $(this)[0].getAttribute("data-name").indexOf('CustomShipTo_Contact') == -1)
		  $('*[data-name="CustomShipTo_PartyId"]').val('');
	  });
	},
	page10: function() {
	  console.log('page10');
	},
	page11: function() {
	  console.log('page11');
	  if (document.querySelector('input[data-name="Optional_Attachment"]')) {
		$('input[data-name="Optional_Attachment"]').live('change', function() {
		  if (document.querySelector('.k-upload .k-upload-files .k-file-validation-message')) {
			mo.fn.modal.show({
			  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
			  title: hpe.fn.lang('ErrorGeneric2', config.locale, config.localizations),
			  content: hpe.fn.lang("FormACR001", config.locale, config.localizations),
			  ctaCallback: function() {
				mo.fn.events.closeAll();
			  },
			  contentCallback: function() {
				config.dataset.Optional_Attachment = null;
				$('.k-upload .k-upload-files .k-upload-status .k-icon[title="Remove"]').click();
			  }
			});
		  }
		});
	  }

	  if (document.querySelector('label[for="Config_PublicSectionPartner"]')) {
		$('label[for="Config_PublicSectionPartner"]').click(function() {
		  $('input[name="Config_PublicSectionPartner"]').trigger("change");
		});
		$('input[name="Config_PublicSectionPartner"]').change(function() {
		  config.dataset.Config_PublicSectionPartner = $(this).val();
		  nbsf.init(config, config.page);
		});
	  }
	  $('label[for="Config_SystemManager"]').click(function() {
		$('input[name="Config_SystemManager"]').trigger("change");
	  });
	  $('input[name="Config_SystemManager"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Config_SystemManager = $(this).val();
		nbsf.init(config, config.page);
	  });

	  $('label[for="Config_EntitledDetails"]').click(function() {
		$('input[name="Config_EntitledDetails"]').trigger("change");
	  });
	  $('input[name="Config_EntitledDetails"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Config_EntitledDetails = $(this).val();
		nbsf.init(config, config.page);
	  });

	  $('label[for="Config_LocationDetails"]').click(function() {
		$('input[name="Config_LocationDetails"]').trigger("change");
	  });
	  $('input[name="Config_LocationDetails"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Config_LocationDetails = $(this).val();
		nbsf.init(config, config.page);
	  });


	  let addCustomCssNBSF = ['Config_PI', 'Config_SystemManager', 'EndCx_SysMng_FirstName'];

	  for (let i = 0; i < addCustomCssNBSF.length; i++) {
		if (document.querySelector('*[data-name="' + addCustomCssNBSF[i] + '"]'))
		  document.querySelector('*[data-name="' + addCustomCssNBSF[i] + '"]').closest('.row').classList.add("filteredClass");
	  }
	  if (document.querySelector('*[data-name="EndCx_SysMng_FirstName"]'))
		document.querySelector('*[data-name="EndCx_SysMng_FirstName"]').closest('.row').classList.add("customFilteredClassToggle3");

	  if (document.querySelector('*[data-name="Config_PublicSectionPartner"]'))
		document.querySelector('*[data-name="Config_PublicSectionPartner"]').closest('.row .wrapper.toggle').classList.add("customFilteredClassToggle4");

	  if (document.querySelector('*[data-name="Config_ResId"]'))
		document.querySelector('*[data-name="Config_ResId"]').closest('.row').classList.add("customFilteredClassToggle5");

	  if (document.querySelector('*[data-name="Config_LocationDetails"]'))
		document.querySelector('*[data-name="Config_LocationDetails"]').closest('.row').classList.add("customFilteredClassToggle8");

	  if (document.querySelector('*[data-name="Config_EntitledDetails"]'))
		document.querySelector('*[data-name="Config_EntitledDetails"]').closest('.row').classList.add("customFilteredClassToggle6");

	  if (document.querySelector('*[data-name="Config_PSP"]'))
		document.querySelector('*[data-name="Config_PSP"]').closest('.row').classList.add("customFilteredClassToggle7");

	  if (document.querySelector('*[data-name="Config_ALI"]'))
		document.querySelector('*[data-name="Config_ALI"]').closest('.row').classList.add("customFilteredClassToggle7");  

	  if (document.querySelector('*[data-name="Config_CombinedOrder"]'))
		document.querySelector('*[data-name="Config_CombinedOrder"]').closest('.row').classList.add("customFilteredClassToggle8"); 


	  $('label[for="Config_PSP"]').click(function() {
		$('input[name="Config_PSP"]').trigger("change");
	  });
	  $('input[name="Config_PSP"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Config_PSP = $(this).val();
		nbsf.init(config, config.page);
	  });

	  $('label[for="Config_ALI"]').click(function() {
		$('input[name="Config_ALI"]').trigger("change");
	  });
	  $('input[name="Config_ALI"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Config_ALI = $(this).val();
		nbsf.init(config, config.page);
	  });

	  $('label[for="Config_CombinedOrder"]').click(function() {
		$('input[name="Config_CombinedOrder"]').trigger("change");
	  });
	  $('input[name="Config_CombinedOrder"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Config_CombinedOrder = $(this).val();
		nbsf.init(config, config.page);
	  });	  

	  $('label[for="Config_PI"]').click(function() {
		$('input[name="Config_PI"]').trigger("change");
	  });
	  $('input[name="Config_PI"]').change(function() {
		let completedData = document.querySelectorAll('*[data-name]');
		for (let i = 0; i < completedData.length; i++) {
		  config.dataset[completedData[i].getAttribute('data-name')] = completedData[i].value;
		}
		config.dataset.Config_PI = $(this).val();
		nbsf.init(config, config.page);
	  });
	},
	page12: function() {
	  console.log('page12');
	}
  };

  // CONFIG FORM TRANSLATIONS
  const otherFunctions = {
	lang: function() {
	  crud.read('3202', '', function(d) {
		if (typeof(d) !== 'object')
		  console.log('throw generic error');
		else {
		  let dataset = d.Rows;
		  for (let i = 0; i < dataset.length; i++)
			config.localizations[dataset[i].StringKey] = dataset[i];

		  config.locale = global.data.user.locale;
		  //if (global.data.user.email == 'demo_emea_distributor@pproap.com') config.locale = 'en_US';
		  for (let i = 0; i < config.pages.length; i++) {
			if (config.pages[i].title) config.pages[i].title = hpe.fn.lang(config.pages[i].title, config.locale, config.localizations);
			if (config.pages[i].subtitle) config.pages[i].subtitle = hpe.fn.lang(config.pages[i].subtitle, config.locale, config.localizations);
			if (config.pages[i].description) config.pages[i].description = hpe.fn.lang(config.pages[i].description, config.locale, config.localizations);

			for (let j = 0; j < config.pages[i].structure.length; j++) {
			  if (config.pages[i].structure[j].header) config.pages[i].structure[j].header = hpe.fn.lang(config.pages[i].structure[j].header, config.locale, config.localizations);
			  if (config.pages[i].structure[j].description) config.pages[i].structure[j].description = hpe.fn.lang(config.pages[i].structure[j].description, config.locale, config.localizations);

			  for (let k = 0; k < config.pages[i].structure[j].group.length; k++) {

				for (let l = 0; l < config.pages[i].structure[j].group[k].length; l++) {
				  if (config.pages[i].structure[j].group[k][l].label) config.pages[i].structure[j].group[k][l].label = hpe.fn.lang(config.pages[i].structure[j].group[k][l].label, config.locale, config.localizations);
				  if (config.pages[i].structure[j].group[k][l].placeholder) config.pages[i].structure[j].group[k][l].placeholder = hpe.fn.lang(config.pages[i].structure[j].group[k][l].placeholder, config.locale, config.localizations);

				  if (config.pages[i].structure[j].group[k][l].options) {

					for (let m = 0; m < config.pages[i].structure[j].group[k][l].options.length; m++) {
					  config.pages[i].structure[j].group[k][l].options[m] = hpe.fn.lang(config.pages[i].structure[j].group[k][l].options[m], config.locale, config.localizations);
					}
				  }
				}
			  }
			}
		  }
		}
	  });
	}
  };
  
  // QUOTE HELPER
  const quoteHelper = {
	quote: null,
	quotePA: [],
	country: null,
	readQuote: function (qid, callback) {
	  const xhr = new XMLHttpRequest();
	  xhr.onreadystatechange = function () {
		if (xhr.readyState == 4 && xhr.status == 200) {
		  const response = JSON.parse(xhr.responseText);
		  console.log('[readQuote] response:', response);
		  if (response && response.status === 'SUCCESS') {
			return callback ? callback(response.hpQuote) : response.hpQuote;
		  }
		  return callback ? callback(null) : null;
		}
	  }
	  xhr.open(
		'GET',
		`https://hpe-rfb.it.hpe.com/resources/rs/custom/php/qids/readquote.php?qid=${qid}`
	  );
	  xhr.send(null);
	},	
	validateQuote: function (quote) {
	  if (!quote || !quote.quoteHeader) {
		  return { valid: false, text: hpe.fn.lang("Form231", config.locale, config.localizations) };
	  }
	  
	  const { QuoteEndDate, QuoteStatus, Type, GoToMarketRoute } = quote.quoteHeader;  
	  
	  const isExpired = QuoteEndDate ? new Date() > new Date(QuoteEndDate) : true;
	  if (isExpired) {
		const formatDate = new Date(QuoteEndDate).toJSON().slice(0, 10);
		// return { valid: false, text: `${hpe.fn.lang("Form232", config.locale, config.localizations)} ${formatDate}` };
	  }
	  
	  if (QuoteStatus !== 'Orderable') {
		return { valid: false, text: hpe.fn.lang("Form233", config.locale, config.localizations) };
	  }
	  
	  const serpFlag = quote.QuoteFlagsList.QuoteFlags.find((flag) => flag.FlagType === 'serpFlag');
	  const serpValue = serpFlag && serpFlag.FlagValue === "true";
	  if (!serpValue) {
		return { valid: false, text: hpe.fn.lang("Form234", config.locale, config.localizations) };
	  }
	  
	  if (Type !== 'Legal Quote') {
		return { valid: false, text: hpe.fn.lang("Form235", config.locale, config.localizations) };
	  }
	  
	  if (GoToMarketRoute !== 'Indirect') {
		return { valid: false, text: hpe.fn.lang("Form236", config.locale, config.localizations) };
	  }
	  
	  // agreements - PANumbers
	  const iCMPANumbers = global.data.brt.pas || [];
	  const items = quote.hpQuoteLineItemList.HpQuoteLineItems || [];
	  quoteHelper.quotePA = [];
	  if (iCMPANumbers.length && items.length) {
		quoteHelper.quotePA = items.filter(x => iCMPANumbers.indexOf(x.PANumber) !== -1);
	  }
	  console.log(quoteHelper.quotePA);
	  
	  if (!quoteHelper.quotePA.length) {
		// comment for testing
		// return { valid: false, text: hpe.fn.lang("Form237", config.locale, config.localizations) };
	  }
	  
	  // save quote to reference
	  quoteHelper.quote = quote;
	  // quote is valid
	  return { valid: true, text: '' };
	},
	initHeaderQuoteData: function (config) {
	  if (quoteHelper.quote && quoteHelper.quote.quoteHeader) {
		const iCMPANumbers = global.data.brt.pas || [];
		const {
		  CurrencyIsoCode,
		  PriceListType,
		  OpportunityId,
		  Total,
		  PaymentTermDescription,
		  SalesOrg } = quoteHelper.quote.quoteHeader;		
		config.dataset.PO_Currency = CurrencyIsoCode; // not editable
		config.dataset.PO_DeliveryIncoterms = PriceListType; // not editable
		config.dataset.Requestor_PO_Opp_ID = OpportunityId; // not editable
		config.dataset.PO_Value = Total; // not editable
		config.dataset.Payment_Terms = PaymentTermDescription; // editable
		config.dataset.PO_HPEEntity = SalesOrg === "HPE BV (NL60)" ? "HPE BV (NL60)" : "HPE Local"; // not editable
		config.dataset.PA_Number = quoteHelper.quotePA[0] || iCMPANumbers[0]; // editable					  
	  }
	},
	clearHeaderQuoteData: function (config) {
	  config.dataset.PO_Currency = null;
	  config.dataset.PO_DeliveryIncoterms = null;
	  config.dataset.Requestor_PO_Opp_ID = null;
	  config.dataset.PO_Value = null;
	  config.dataset.Payment_Terms = null;
	  config.dataset.PO_HPEEntity = null;
	  const iCMPANumbers = global.data.brt.pas || [];
	  config.dataset.PA_Number = iCMPANumbers[0];
	},
	initCountry: function(config, invalidQuoteID, force = true) {
	  config.dataset.hideSIM = 'Y';
	  config.dataset.hideQECC = 'Y';
	  let countryData = reference.countriesData.find(x => x.ISO2 == global.data.geo.code);
	  
	  // if quote is exist 
	  if (config.dataset.Config_Quote == 'Y' && config.dataset.Requestor_PO_Quote_ID && !invalidQuoteID) {
		const quote = quoteHelper.quote || (config.dataset.QuoteResponse ? JSON.parse(config.dataset.QuoteResponse) : null);
		if (quote && quote.quoteHeader && quote.quoteHeader.OriginatingSystemQuoteAndVersionID === config.dataset.Requestor_PO_Quote_ID) {
        const address = quote.quoteHeader.EndCustomer.Address;
		  if (address && address.Country) {
			countryData = reference.countriesData.find(x => x.ISO2 == address.Country);
			if (countryData) {
			  config.dataset.hideQECC = 'N';
			  config.dataset.QECC_Country = countryData && countryData.Name;
			}
		  }
		}
		// SIM
	  } else if (global.data.sim && global.data.sim.length) {
		config.dataset.hideSIM = 'N';
		if (!config.dataset.SIM_Country) {
		  countryData = reference.countriesData.find(x => x.ISO2 == global.data.sim[0]);
		  config.dataset.SIM_Country = countryData && countryData.Name;
		} else {
		  countryData = reference.countriesData.find(x => x.Name == config.dataset.SIM_Country);
		}
	  }
	
	  if (!countryData) {
		 countryData = reference.countriesData.find(x => x.ISO2 == global.data.geo.code);
	  }

	  if (countryData) {  
		  config.dataset.CountryCode = countryData.ISO2;
		  config.dataset.Country = countryData.Name;
		  config.dataset.Region = countryData.Region;
		  config.dataset.Geo = countryData.GEO;
		  config.dataset.SubRegion = countryData.SubRegion;
		
		if (document.querySelector('*[data-name="CountryCode"]'))
		  $('*[data-name="CountryCode"]').val(config.dataset.CountryCode);
		if (document.querySelector('*[data-name="Country"]'))
		  $('*[data-name="Country"]').val(config.dataset.Country);
		if (document.querySelector('*[data-name="Region"]'))
		  $('*[data-name="Region"]').val(config.dataset.Region);
		if (document.querySelector('*[data-name="Geo"]'))
		  $('*[data-name="Geo"]').val(config.dataset.Geo);
		if (document.querySelector('*[data-name="SubRegion"]'))
		  $('*[data-name="SubRegion"]').val(config.dataset.SubRegion);
		
		  
		  // change currencies
		  reference.currencies = countryData.Country_Currencies ? countryData.Country_Currencies.split(',') : ['USD'];
		  config.dataset.PO_Currency = reference.currencies[0] || 'USD';
		  
		  // change SoldTo country
		  config.dataset.SoldTo_Address_Country = countryData.Name;
		  config.dataset.SoldTo_Contact_Country = countryData.Name;
		  
		  quoteHelper.country = countryData;
		
		if (force) {
		  quoteHelper.clearAddressConfigs(config);
		}
	  }
	},
	disableHeaderQuote: function (config) {
	  const quote = quoteHelper.quote || (config.dataset.QuoteResponse ? JSON.parse(config.dataset.QuoteResponse) : null);
	  const disabledFields = ['PO_Currency', 'PO_DeliveryIncoterms', 'Requestor_PO_Opp_ID', 'PO_HPEEntity'];
	  disabledFields.forEach((field) => {
		if (document.querySelector(`*[data-name="${field}"]`)) {
		  if (config.dataset.Config_Quote == 'N' || !config.dataset.Requestor_PO_Quote_ID) {
			$(`*[data-name="${field}"]`).parent().parent().removeClass('wrapper-disabled');
			$(`*[data-name="${field}"]`).removeAttr("disabled");
		  } else if (field === 'PO_DeliveryIncoterms' && quote && quote.quoteHeader && quote.quoteHeader.PriceListType === 'FCA') {
			$(`*[data-name="${field}"]`).parent().parent().removeClass('wrapper-disabled');
			$(`*[data-name="${field}"]`).removeAttr("disabled");
		  } else {
			$(`*[data-name="${field}"]`).parent().parent().addClass('wrapper-disabled');
			$(`*[data-name="${field}"]`).attr("disabled", 'disabled');
		  }
		}
	  })
	},
	disableAddressQuoteData: function (config) {
	  const disabledFields = ["SoldTo_PartyId",
							  "SoldTo_CompanyName",
							  "SoldTo_Address_Street",
							  "SoldTo_Address_City",
							  "SoldTo_Address_State",
							  "SoldTo_Address_Postal",
							  "SoldTo_Address_Country",
							  "Payer_PartyId",
							  "Payer_CompanyName",
							  "Payer_Address_Street",
							  "Payer_Address_City",
							  "Payer_Address_State",
							  "Payer_Address_Postal",
							  "Payer_Address_Country",
							  "EndCx_Address_Country",
							 ];
	  disabledFields.forEach((field) => {
		if (document.querySelector(`*[data-name="${field}"]`)) {
		  if (config.dataset.Config_Quote == 'N'|| !config.dataset.Requestor_PO_Quote_ID) {
			$(`*[data-name="${field}"]`).parent().parent().removeClass('wrapper-disabled');
			$(`*[data-name="${field}"]`).removeAttr("disabled");
		  } else {
			$(`*[data-name="${field}"]`).parent().parent().addClass('wrapper-disabled');
			$(`*[data-name="${field}"]`).attr("disabled", 'disabled');
		  }
		}
	  })
	},	
	initDefaultPOData: function (config, force, section = 'all') {
	  // typeof section: all, SoldTo, Payer, BillTo, ShipTo, Reseller, EndCustomer
	  
	  // CLEAR OLD DATA
	  const clearDataset = function () {
		const fields = ['CompanyName', 'PartyId', 'Address_Street', 'Address_City',  'Address_State', 'Address_Postal', 'Address_Country',
						'Contact_FirstName', 'Contact_LastName', 'Contact_Phone', 'Contact_Email', 'Contact_Country'];
		fields.forEach((field) => {
		  config.dataset[`SoldTo_${field}`] = null;
		  config.dataset[`Payer_${field}`] = null;
		  config.dataset[`BillTo_${field}`] = null;
		  config.dataset[`ShipTo_${field}`] = null;
		  config.dataset[`Reseller_${field}`] = null;
		  config.dataset[`EndCx_${field}`] = null;
		});
	  }
	  
	  if (force) {
		clearDataset();
	  }
	  
	  // ALTERNATE NAME
	  let alternateName = '';
	  if (reference.xref.party[0].organizationAlternateName && reference.xref.party[0].organizationAlternateName.length > 0) {
		reference.xref.party[0].organizationAlternateName.forEach(function(item) {
		  if (
			item.internalOverWriteFlag === 'Y' &&
			item.status === 'ACTIVE' &&
			item.characterScript === 'LATN' &&
			item.type === 'TRADESTYLE'
		  ) {
			alternateName = item.organizationAlternateName;
		  }
		});
	  }
	  alternateName = alternateName || reference.xref.party[0].organizationName;

	  // ADDRESS
	  let addressMatched = null;
	  let address1 = '';
	  let address2 = '';
	  if (reference.xref.party[0].address && reference.xref.party[0].address.length > 0) {
		addressMatched = reference.xref.party[0].address.find(item => {
		  return item.internalOverWriteFlag == "Y" && item.status == "ACTIVE" && item.addressType == "PHY";
		});

		if (!addressMatched) {
		  addressMatched = reference.xref.party[0].address.find(item => {
			return item.status == "ACTIVE" && item.addressType == "PHY";
		  });
		}

		if (addressMatched) {
		  address1 = addressMatched.addressLine1;
		  address2 = addressMatched.addressLine2;
		  if (!addressMatched.addressLine2 && addressMatched.addressLine1.length > 55) {
			const separator = addressMatched.addressLine1.substr(0, 55).lastIndexOf(' ');
			address1 = addressMatched.addressLine1.substr(0, separator);
			address2 = addressMatched.addressLine1.substr(separator + 1);
		  }
		}
	  }

	  // COUNTRIES
	  const countries_address = ["Australia", "New Zealand", "India", "Malaysia", "Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"];
	  const countries_nationalId = ["Argentina", "Brazil", "Chile", "Colombia", "Mexico", "Peru", "Puerto Rico"];

	  // NATIONAL ID
	  let nationalId = null;
	  if (countries_nationalId.indexOf(reference.xref.party[0].countryName) > -1) {
		var externalidentifier = reference.xref.party[0].externalIdentifier;
		for (i = 0; i < externalidentifier.length; i++) {
		  if (externalidentifier[i].status == "ACTIVE" && ["Tax Number 1"].indexOf(externalidentifier[i].externalIdentifierName) > -1) {
			nationalId = externalidentifier[i].identifierValue;
			break;
		  }
		}
	  }


	  // HIDDEN INPUT: SOLDTO
	  if (config.dataset.SoldTo_CompanyName == null || config.dataset.SoldTo_CompanyName.length == 0) {
		config.dataset.SoldTo_PartyId = config.dataset.PartyId;
		if (config.dataset.Email.indexOf('@hpe.com') > -1)
		  config.dataset.SoldTo_Contact_Email = config.dataset.OnBehalf_CreatedBy;
		else
		  config.dataset.SoldTo_Contact_Email = config.dataset.Email;
		config.dataset.SoldTo_Contact_FirstName = config.dataset.FirstName;
		config.dataset.SoldTo_Contact_LastName = config.dataset.LastName;
		config.dataset.SoldTo_Contact_Country = reference.xref.party[0].countryName;
		config.dataset.SoldTo_Address_Country = reference.xref.party[0].countryName;

		config.dataset.BRT = global.data.brt.name;
		config.dataset.PartnerName = global.data.company.name;
		config.dataset.Country = global.data.geo.name;

		config.dataset.SoldTo_CompanyName = alternateName;

		if (addressMatched) {
		  if (countries_address.indexOf(reference.xref.party[0].countryName) > -1)
			config.dataset.SoldTo_Address_State = addressMatched.stateProvince;

		  config.dataset.SoldTo_Address_City = addressMatched.cityName;
		  config.dataset.SoldTo_Address_Postal = addressMatched.postalCode;
		  config.dataset.SoldTo_Address_Street = address1;
		  config.dataset.SoldTo_Address_Street2 = address2;
		}			

		if (nationalId) {
		  config.dataset.SoldTo_NationalID = nationalId;
		}	
	  }
	  // HIDDEN INPUT: PAYER
	  if (config.dataset.Payer_CompanyName == null || config.dataset.Payer_CompanyName.length == 0) {
		config.dataset.Payer_PartyId = config.dataset.PartyId;
		//config.dataset.Payer_Contact_Email = config.dataset.Email;
		//config.dataset.Payer_Contact_FirstName = config.dataset.FirstName;
		//config.dataset.Payer_Contact_LastName = config.dataset.LastName;
		//config.dataset.Payer_Contact_Country = reference.xref.party[0].countryName;
		config.dataset.Payer_Address_Country = reference.xref.party[0].countryName;

		config.dataset.Payer_CompanyName = alternateName;

		if (addressMatched) {
		  if (countries_address.indexOf(reference.xref.party[0].countryName) > -1)
			config.dataset.Payer_Address_State = addressMatched.stateProvince;

		  config.dataset.Payer_Address_City = addressMatched.cityName;
		  config.dataset.Payer_Address_Postal = addressMatched.postalCode;
		  config.dataset.Payer_Address_Street = address1;
		  config.dataset.Payer_Address_Street2 = address2;
		}
	  }
	  // HIDDEN INPUT: BILLING
	  if (config.dataset.BillTo_CompanyName == null || config.dataset.BillTo_CompanyName.length == 0) {
		config.dataset.BillTo_PartyId = config.dataset.PartyId;
		//config.dataset.BillTo_Contact_Email = config.dataset.Email;
		//config.dataset.BillTo_Contact_FirstName = config.dataset.FirstName;
		//config.dataset.BillTo_Contact_LastName = config.dataset.LastName;
		//config.dataset.BillTo_Contact_Country = reference.xref.party[0].countryName;
		config.dataset.BillTo_Address_Country = reference.xref.party[0].countryName;

		config.dataset.BillTo_CompanyName = alternateName;

		if (addressMatched) {
		  if (countries_address.indexOf(reference.xref.party[0].countryName) > -1)
			config.dataset.BillTo_Address_State = addressMatched.stateProvince;

		  config.dataset.BillTo_Address_City = addressMatched.cityName;
		  config.dataset.BillTo_Address_Postal = addressMatched.postalCode;
		  config.dataset.BillTo_Address_Street = address1;
		  config.dataset.BillTo_Address_Street2 = address2;
		}
	  }	  
	}, 
	initAddressQuoteData: function (config) {
	const quote = quoteHelper.quote || (config.dataset.QuoteResponse ? JSON.parse(config.dataset.QuoteResponse) : null);
	quoteHelper.quote = quote;
    if (quoteHelper.quote && quoteHelper.quote.quoteHeader) {
      const blocks = ['SoldTo', 'BillTo', 'Payer', 'ShipTo'];
	  
      const companyAssociations = {
        Name: 'CompanyName',
        PartyID: 'PartyId',
      };

      const addressAssociations = {
        Address1: 'Address_Street',
        City: 'Address_City',
        State: 'Address_State',
        PostalCode: 'Address_Postal',
        Country: 'Address_Country',
        TradeStyleName: 'Address_TBD',
      };

      const contactAssociations = {
        FirstName: 'Contact_FirstName',
        LastName: 'Contact_LastName',
        PhoneNumber: 'Contact_Phone',
        Email: 'Contact_Email',
        Country: 'Contact_Country',
      };
	  
	  const initDataset = function (section, quoteSection) {
		for (let key in companyAssociations) {
          config.dataset[`${section}_${companyAssociations[key]}`] = quoteHelper.quote.quoteHeader[quoteSection].Company[key];
        }
        for (let key in addressAssociations) {
		  if (key === 'Country') {
            const country = reference.countriesData.find((item) => item.ISO2 === quoteHelper.quote.quoteHeader[quoteSection].Address[key]);
			config.dataset[`${section}_${addressAssociations[key]}`] = country ? country.Name : null;
          } else {
            config.dataset[`${section}_${addressAssociations[key]}`] = quoteHelper.quote.quoteHeader[quoteSection].Address[key];
          }
        }
        for (let key in contactAssociations) {
		  if (key === 'Country') {
            const country = reference.countriesData.find((item) => item.ISO2 === quoteHelper.quote.quoteHeader[quoteSection].Contact[key]);
			config.dataset[`${section}_${contactAssociations[key]}`] = country ? country.Name : null;
          } else {
            config.dataset[`${section}_${contactAssociations[key]}`] = quoteHelper.quote.quoteHeader[quoteSection].Contact[key];
          }
        }
		
		// TradeStyleName to Company name wherever available if not use the name field 
		config.dataset[`${section}_CompanyName`] = quoteHelper.quote.quoteHeader[quoteSection].Address.TradeStyleName || quoteHelper.quote.quoteHeader[quoteSection].Company.Name;
	  };
      blocks.forEach((block) => {
		initDataset(block, block);
      });
	  initDataset('Reseller', 'ResellerInfo');
	  initDataset('EndCx', 'EndCustomer');
    }
  },
	clearAddressConfigs: function (config) {
	  // APJ / APAC  NWE;UKI;DACH;ESOU
	  config.dataset.Config_SoldToDetails = 'N';
	  config.dataset.Config_SoldToDetails_Contact = 'N';
	  config.dataset.Config_PayerDetails = 'N';
	  config.dataset.Config_BillToDetails = 'N';
	  config.dataset.Config_ShipToDetails = 'N';
	  config.dataset.Config_ShipToDetails_Contact = 'N';
	  config.dataset.Config_ResellerDetails = 'N';
	  config.dataset.Config_ResellerDetails_Contact = 'N';
	  config.dataset.Config_EndCxDetails = 'N';
	  config.dataset.Config_EndCxDetails_Contact = 'N';
	  
	  // AMS GEO - MESA / CERTA or MEA / CETA
	  const isCase2 = config.dataset.Config_Quote === 'Y' &&
			(["CERTA", "CETA", "Latin America", "North America"].includes(config.dataset.Geo) || 
			 config.dataset.SubRegion === "MESA");
	  const defaultConfigCase2 = isCase2 ? 'Y' : 'N';
	  config.dataset.Config_PPC_SoldTo = defaultConfigCase2;
	  config.dataset.Config_PPC_Payer = defaultConfigCase2;
	  config.dataset.Config_PPC_BillTo = defaultConfigCase2;
	  config.dataset.Config_PPC_ShipTo = defaultConfigCase2;
	  config.dataset.Config_PPC_Reseller = defaultConfigCase2;
	  config.dataset.Config_PPC_EndCx = defaultConfigCase2;
	  
	  // FIX?
	  config.dataset.PO_BusinessModel = null;
	  config.dataset.PO_Category = null;
	  
	  if (document.querySelector('*[data-name="Config_SoldToDetails"]'))
		$('*[data-name="Config_SoldToDetails"]').val(config.dataset.Config_SoldToDetails);
	  if (document.querySelector('*[data-name="Config_SoldToDetails_Contact"]'))
		$('*[data-name="Config_SoldToDetails_Contact"]').val(config.dataset.Config_SoldToDetails_Contact);
	  if (document.querySelector('*[data-name="Config_PayerDetails"]'))
		$('*[data-name="Config_PayerDetails"]').val(config.dataset.Config_PayerDetails);
	  if (document.querySelector('*[data-name="Config_BillToDetails"]'))
		$('*[data-name="Config_BillToDetails"]').val(config.dataset.Config_BillToDetails);
	  if (document.querySelector('*[data-name="Config_ShipToDetails"]'))
		$('*[data-name="Config_ShipToDetails"]').val(config.dataset.Config_ShipToDetails);
	  if (document.querySelector('*[data-name="Config_ShipToDetails_Contact"]'))
		$('*[data-name="Config_ShipToDetails_Contact"]').val(config.dataset.Config_ShipToDetails_Contact);
	  if (document.querySelector('*[data-name="Config_ResellerDetails"]'))
		$('*[data-name="Config_ResellerDetails"]').val(config.dataset.Config_ResellerDetails);
	  if (document.querySelector('*[data-name="Config_ResellerDetails_Contact"]'))
		$('*[data-name="Config_ResellerDetails_Contact"]').val(config.dataset.Config_ResellerDetails_Contact);
	  if (document.querySelector('*[data-name="Config_EndCxDetails"]'))
		$('*[data-name="Config_EndCxDetails"]').val(config.dataset.Config_EndCxDetails);
	  if (document.querySelector('*[data-name="Config_EndCxDetails_Contact"]'))
		$('*[data-name="Config_EndCxDetails_Contact"]').val(config.dataset.Config_EndCxDetails_Contact);
	  
	  if (document.querySelector('*[data-name="Config_PPC_SoldTo"]'))
		$('*[data-name="Config_PPC_SoldTo"]').val(config.dataset.Config_PPC_SoldTo);
	  if (document.querySelector('*[data-name="Config_PPC_Payer"]'))
		$('*[data-name="Config_PPC_Payer"]').val(config.dataset.Config_PPC_Payer);
	  if (document.querySelector('*[data-name="Config_PPC_BillTo"]'))
		$('*[data-name="Config_PPC_BillTo"]').val(config.dataset.Config_PPC_BillTo);
	  if (document.querySelector('*[data-name="Config_PPC_ShipTo"]'))
		$('*[data-name="Config_PPC_ShipTo"]').val(config.dataset.Config_PPC_ShipTo);
	  if (document.querySelector('*[data-name="Config_PPC_Reseller"]'))
		$('*[data-name="Config_PPC_Reseller"]').val(config.dataset.Config_PPC_Reseller);
	  if (document.querySelector('*[data-name="Config_PPC_EndCx"]'))
		$('*[data-name="Config_PPC_EndCx"]').val(config.dataset.Config_PPC_EndCx);
	},
	buildQuotePreviewPage: function (config) {
	  // CONFIGURATION FOR DATA REVIEW UI
	  var reviewSetup = {
		soldto: {
		  id: 'PPC_SoldTo',
		  title: hpe.fn.lang("Form054", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "SoldTo_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "SoldTo_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "SoldTo_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "SoldTo_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "SoldTo_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "SoldTo_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "SoldTo_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "SoldTo_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "SoldTo_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "SoldTo_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "SoldTo_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "SoldTo_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "SoldTo_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "SoldTo_Contact_Country"]
		  ]
		},
		payer: {
		  id: 'PPC_Payer',
		  title: hpe.fn.lang("Form206", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "Payer_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "Payer_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "Payer_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "Payer_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "Payer_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "Payer_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "Payer_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "Payer_Address_Country"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "Payer_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "Payer_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "Payer_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "Payer_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "Payer_Contact_Country"]
		  ]
		},
		billto: {
		  id: 'PPC_BillTo',
		  title: hpe.fn.lang("Form204", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "BillTo_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "BillTo_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "BillTo_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "BillTo_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "BillTo_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "BillTo_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "BillTo_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "BillTo_Address_Country"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "BillTo_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "BillTo_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "BillTo_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "BillTo_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "BillTo_Contact_Country"]
		  ]
		},
		shipping: {
		  id: 'PPC_ShipTo',
		  title: hpe.fn.lang("Form205", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "ShipTo_PartyId"],
			[hpe.fn.lang("Form440", config.locale, config.localizations), "ShipTo_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "ShipTo_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "ShipTo_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "ShipTo_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "ShipTo_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "ShipTo_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "ShipTo_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "ShipTo_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "ShipTo_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "ShipTo_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "ShipTo_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "ShipTo_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "ShipTo_Contact_Country"]
		  ]
		},
		reseller: {
		  id: 'PPC_Reseller',
		  title: hpe.fn.lang("Form126", config.locale, config.localizations),
		  filter: {
            logic: "and",
            filters: [
			  {
				field: "PartnerBRT",
				operator: "in",
				value: ["Distributor", "OEM Distributor", "System Integrator"]
			  },
			  {
				field: "PO_BusinessModel",
				operator: "nin",
				value: ["Agent Model", "HPFS & Agent Model"]
			  },
			  {
				field: "PO_Category",
				operator: "neq",
				value: "Stock"
			  }
            ]
          },
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "Reseller_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "Reseller_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "Reseller_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "Reseller_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "Reseller_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "Reseller_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "Reseller_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "Reseller_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "Reseller_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "Reseller_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "Reseller_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "Reseller_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "Reseller_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "Reseller_Contact_Country"]
		  ]
		},
		endcx: {
		  id: 'PPC_EndCx',
		  title: hpe.fn.lang("Form138", config.locale, config.localizations),
		  fieldset: [
			[hpe.fn.lang("Form086", config.locale, config.localizations), "EndCx_PartyId"],
			[hpe.fn.lang("Form058", config.locale, config.localizations), "EndCx_CompanyName"],
			[hpe.fn.lang("Address", config.locale, config.localizations), "EndCx_Address_Street"],
			[hpe.fn.lang("AddressLineOptional", config.locale, config.localizations), "EndCx_Address_Street2"],
			[hpe.fn.lang("City", config.locale, config.localizations), "EndCx_Address_City"],
			[hpe.fn.lang("StateProvince", config.locale, config.localizations), "EndCx_Address_State"],
			[hpe.fn.lang("Postal code", config.locale, config.localizations), "EndCx_Address_Postal"],
			[hpe.fn.lang("Country", config.locale, config.localizations), "EndCx_Address_Country"],
			[hpe.fn.lang("Form495", config.locale, config.localizations), "EndCx_NationalID"],
			[hpe.fn.lang("FirstName", config.locale, config.localizations), "EndCx_Contact_FirstName"],
			[hpe.fn.lang("Surname", config.locale, config.localizations), "EndCx_Contact_LastName"],
			[hpe.fn.lang("Telephone", config.locale, config.localizations), "EndCx_Contact_Phone"],
			[hpe.fn.lang("Form441", config.locale, config.localizations), "EndCx_Contact_Email"],
			[hpe.fn.lang("CountryOfResidence", config.locale, config.localizations), "EndCx_Contact_Country"]
		  ]
		},    
	  }

    let objK = Object.keys(reviewSetup);
	  for (i = 0; i < objK.length; i++) {
		let key = objK[i];
		const id = reviewSetup[key].id;
		if (!document.querySelector(`input[data-name=${id}]`)) {
		  continue;
		}
		document.querySelector(`input[data-name=${id}]`).parentElement.parentElement.parentElement.parentElement.classList.add('PPC', `${id}_output`);
		var app = document.querySelector(`.${id}_output`);
		// move config toggle to the right 
		$(app).prev().addClass('PPC PPC_toggle');
		
		if (key == "endcx") {
		  var POOptionalValidArray = ["Latin America", "Central Europe", "UKIMESA", "CERTA", "MESA", "North America"];
		  if (POOptionalValidArray.indexOf(global.data.geo.geography) > -1) {
			var main = reviewSetup[key];
			var FilterObj = {
			  "field": "PO_Category",
			  "operator": "neq",
			  "value": "Stock"
			};
			var mergeobj = Object.assign(main, {
			  "filter": FilterObj
			});
			reviewSetup[key] = mergeobj;
		  }
		} else if (key == "reseller") {
		  var POOptionalValidArray = ["Latin America", "Central Europe", "UKIMESA", "CERTA", "MESA", "North America"];
		  if (POOptionalValidArray.indexOf(global.data.geo.geography) > -1) {
			if (global.BRT != "Distributor") {
			  var main = reviewSetup[key];
			  var FilterObj = {
				"field": "PartnerBRT",
				"operator": "eq",
				"value": "Distributor"
			  };

			  var mergeobj = Object.assign(main, {
				"filter": FilterObj
			  });
			  reviewSetup[key] = mergeobj;
			} else {
			  var main = reviewSetup[key];
			  var FilterObj = [{
				"field": "PO_BusinessModel",
				"operator": "notcontains",
				"value": "Agent Model"
			  },
							   {
								 "field": "PO_Category",
								 "operator": "neq",
								 "value": "Stock"
							   }
							  ];
			  var filters = {
				logic: "and",
				filters: FilterObj
			  }
			  var mergeobj = Object.assign(main, {
				"filter": filters
			  });
			  reviewSetup[key] = mergeobj;
			}
		  }
		}

		var filter = true;

		if (typeof(reviewSetup[key].filter) === "object") {
		  // Filter fields
		  filter = nbsf.fn.filter(config.dataset, reviewSetup[key].filter);	  
		  // Filter toggles
		  if (!filter) {
			$(app).prev().addClass('hidden');
		  }
		}
		if (reviewSetup[key].fieldset.length > 0 && filter) {
		  console.log('reviewSetup[key]', reviewSetup[key]);
		  if (app.querySelector(".row[review-id=" + key + "]") == null)
			app.innerHTML += '<div class="row" review-id="' + key + '"><h4>' + reviewSetup[key].title + '</h4></div>';
		  var row = app.querySelector(".row[review-id=" + key + "]");
		  var headerchk = false;
		  for (j = 0; j < reviewSetup[key].fieldset.length; j++) {
			var item = reviewSetup[key].fieldset[j];
			var label = item[0];
			var value = config.dataset[item[1]];

			if (typeof(value) === "undefined" || value == null || value == "" || value == "OPE-") value = "N/A";
			
			if (["N/A", "NA", "Select one", "+1000000000", "NA@IGNOREME.COM", " "].indexOf(value) == -1) {
			  var type = "";
			  var optiondata = "";
			  var valuesdata = "";
			  for (a = 0; a < config.pages.length; a++) {
				for (b = 0; b < config.pages[a].structure.length; b++) {
				  for (l = 0; l < config.pages[a].structure[b].group.length; l++) {
					for (k = 0; k < config.pages[a].structure[b].group[l].length; k++) {
					  if (config.pages[a].structure[b].group[l][k].data == item[1]) {
						type = config.pages[a].structure[b].group[l][k].type;
						if (type == "select") {
						  if (config.pages[a].structure[b].group[l][k].options != null)
							optiondata = config.pages[a].structure[b].group[l][k].options;

						  valuesdata = config.pages[a].structure[b].group[l][k].values;
						}
						break;
					  }
					}
				  }
				}
			  }
			  if (type == "select") {
				if (optiondata == "")
				  row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + value + '</p></div>';
				else {
				  if (["PO_BackgroundGroup"].indexOf(item[1]) > -1) {
					var indexval = 0;
					if (optiondata.length >= 4 || valuesdata.length >= 4) {
					  if (["EMEA", "APJ", "AMS"].indexOf(global.data.geo.region) > -1) {
						valuesdata.splice(1, 1);
						valuesdata.splice(1, 1);
						optiondata.splice(1, 1);
						optiondata.splice(1, 1);
					  } else {
						valuesdata.splice(3, 1);
						valuesdata.splice(2, 1);
						optiondata.splice(3, 1);
						optiondata.splice(2, 1);
					  }
					}
					for (g = 0; g < valuesdata.length; g++) {
					  if (valuesdata[g] == value)
						indexval = g;
					}
					row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + hpe.fn.lang(optiondata[indexval], config.locale, config.localizations) + '</p></div>';
				  } else {
					var indexval = 0;
					for (g = 0; g < valuesdata.length; g++) {
					  if (valuesdata[g] == value)
						indexval = g;
					}
					row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + hpe.fn.lang(optiondata[indexval], config.locale, config.localizations) + '</p></div>';
				  }
				}
			  } else
				row.innerHTML += '<div class="item"><strong>' + label + '</strong><p>' + value + '</p></div>';

			  headerchk = true;
			}
			
			
			if (j == reviewSetup[key].fieldset.length - 1) {
			  if (headerchk)
				row.innerHTML += '<div class="cfix"></div>';
			  else
				row.innerHTML = "";
			}
		  }
		}
	  }
	  
	  $('.nbsf .buttons .back').after($('<div class="btn draft">Save as draft</div>'));
	  config.dataset.isDraft = false;
	  $(".nbsf .buttons .draft").click(function() {
		config.dataset.isDraft = true;
		config.onSubmit();
	  });
	  if (config.dataset.Status == '1') $('.buttons').hide();
  },
  };
</script>

<!-- Main application code
<script src="https://hpe-rfb.it.hpe.com/resources/rs/custom/nor/utils.js"> -->
<script>
  const oob = {
	init: function() {
	  mo.fn.overlay.show({
		loading: true,
		close: false
	  });
	  otherFunctions.lang();

	  function getAllLocalizations() {
		if (Object.keys(config.localizations).length > 0) {

		  oob.ui();
		  // GET AGREEMENTS FROM ICM
		  config.dataset.currentUser = '[SSOData.Email]';
		  if (!global.data.user.internal) {
			mo.fn.overlay.show({
			  loading: true,
			  close: false
			});
			request.agreements(global.data, function(data) {
			  console.log('222');
			  if (data) {
				reference.agreements = data;
				mo.fn.overlay.hide();
			  } else {
				// check if exception/demo account
				hpe.api.dataset({
				  form: '1585',
				  dataset: 'Reference_DemoAccounts',
				  payload: {
					filter: {
					  logic: "and",
					  filters: [{
						field: 'PartyId',
						operator: 'eq',
						value: global.data.company.party
					  },
								{
								  field: 'BRT',
								  operator: 'eq',
								  value: global.data.company.brt.brTypeName
								}
							   ]
					},
					skip: '0',
					pageSize: '1',
					take: '1'
				  }
				}, function(d) {
				  if (typeof(d) === 'object' && d.Success && d.Data.length == 1) {
					reference.agreements = [];
				  }
				  return mo.fn.overlay.hide();
				})
			  }
			  global.data.brt.pas = [];
			  reference.agreements.forEach(function(agreement) {
				global.data.brt.pas.push(agreement.iCMPANumber);
			  });
			  let chnls = global.data.brts.filter(function(item) {
				return (item.code == global.data.brt.code && item.name == global.data.brt.name)
			  });
			  if (chnls.length > 0)
				chnls = chnls[0].channel;
			  global.data.brt.channel = chnls;
			  reference.countriesRequest();


			  crud.q.stop(function() {
				if (global.data.company.party) {
				  mo.fn.overlay.show({loading:true, close:false});
				  hpe.data.xref(global.data.company.party, function(d) {
					mo.fn.overlay.hide();
					if (d.status == 'SUCCESS') {
					  //d.party[0].countryCode = 'IN'; //CFI
					  //d.party[0].countryName = 'India'; //CFI
					  reference.xref = d;
					  config.locale = global.data.user.locale;
					  config.dom = document.querySelector('div[tab-id="oob"]');
					  nbsf.init(config, 0);
					  nbsf.init(config, 0);
					  //mo.fn.overlay.hide()
					} else {
					  //console.log('err');
					  mo.fn.modal.show({
						ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
						title: hpe.fn.lang("ErrorGeneric", config.locale, config.localizations),
						content: '',
						ctaCallback: function() {
						  mo.fn.overlay.hide();
						  mo.fn.events.closeAll();
						}
					  });
					}
				  })
				} 
				else {
				  document.querySelector('span[tab-id="oob"]').innerText = hpe.fn.lang('Form069', config.locale, config.localizations)
				  if (document.querySelector('span[tab-id="requests"]'))
					document.querySelector('span[tab-id="requests"]').innerText = hpe.fn.lang('Form072', config.locale, config.localizations)
				  config.dom = document.querySelector('div[tab-id="oob"]');
				  nbsf.init(config, 0);
				  nbsf.init(config, 0);
				  //mo.fn.overlay.hide()
				}
			  });
			});
		  } 
		  else {
			crud.q.stop(function() {
			  config.locale = global.data.user.locale;
			  config.dom = document.querySelector('div[tab-id="oob"]');
			  nbsf.init(config, 0);
			  nbsf.init(config, 0);
			  //mo.fn.overlay.hide()
			});
		  }

		  clearInterval(localiz);
		}
	  }
	  const localiz = setInterval(getAllLocalizations, 1000);
	},
	//function that initiates UI
	ui: function() {
	  //generating the app tabs
	  crud.q.stop(function() {
		hpe.ui.tabs({
		  dom: document.querySelector("section.wrapper"),
		  tabs: [{
			label: hpe.fn.lang('Form069', config.locale, config.localizations),
			id: "oob"
		  },
				 {
				   label: hpe.fn.lang('Form072', config.locale, config.localizations),
				   id: "requests"
				 },
				 {
				   label: "",
				   id: "otherIcons"
				 }
				]
		},
					function(all) {
		  // define dom selectors for tabs
		  $('span[tab-id="otherIcons"]').append('<svg class="add" style="padding: 2px 10px;" version="1.1" viewBox="0 0 24 24" role="img" aria-label="add" width="20px" height="20px"><path fill="none" stroke="#111" stroke-width="2" d="M12,22 L12,2 M2,12 L22,12"></path></svg>' +
												'<svg class="refresh" style="padding: 0px 10px;" version="1.1" viewBox="0 0 24 24" role="img" aria-label="form-refresh" width="24px" height="24px"><path fill="none" stroke="#333" stroke-width="2" d="M17.3333333,9.33333333 C16.3982691,7.36020781 14.3579813,6 12,6 C8.6862915,6 6,8.6862915 6,12 C6,15.3137085 8.6862915,18 12,18 C15.3137085,18 18,15.3137085 18,12 M18.5,6 L18.5,10 L14.5,10"></path></svg>');

		  $('span[tab-id="otherIcons"] *').click(function() {
			return false;
		  });

		  function setTilesTabs() {
			document.querySelector('.tabs span[tab-id="oob"]').innerText = hpe.fn.lang('Form069', config.locale, config.localizations);
			document.querySelector('.tabs span[tab-id="requests"]').innerText = hpe.fn.lang('Form072', config.locale, config.localizations);

			if (Object.keys(config.localizations).length > 0) {
			  clearInterval(tabTiles);
			}
		  }
		  const tabTiles = setInterval(setTilesTabs, 1000);

		  /*if (config.dataset.currentUser.indexOf('@hpe.com') > -1) {
                              $('span[tab-id="requests"]').hide();
                              $('span[tab-id="oob"]').hide();
                          }*/
		  $('span[tab-id="otherIcons"] > svg.add').click(function() {
			config.dataset = {};
			nbsf.init(config, 0);
			nbsf.init(config, 0);
			$('.tabs span[tab-id="oob"]').click();
		  });
		  $('span[tab-id="otherIcons"] > svg.refresh').click(function() {
			config.dataset = {};
			nbsf.init(config, 0);
			nbsf.init(config, 0);
			$('[tab-id=requests] .grid').data('kendoGrid').dataSource.read();
		  });

		  $('span[tab-id="requests"]').click(function() {
			oob.grid.load();
		  });
		  crud.q.stop(function() {
			let placeholderTranslation = hpe.fn.lang('SearchOrder', config.locale, config.localizations);
			$('div[tab-id="requests"]').append('<div id="overview"></div>' +
											   '<div class="search"><input type="text" placeholder="' + placeholderTranslation + '"><span><img src="https://cdn1.prp-dxp.it.hpe.com/o/prp-theme/images/icons/search.svg"></span></div>' +
											   '<div class="grid"></div>');
			document.querySelector(".search input").addEventListener('input', oob.grid._events._search);
			oob.grid.load();
		  })
		});
	  });
	},
	//function that initiate kendo grid
	grid: {
	  load: function() {
		mo.fn.overlay.show({
		  loading: true,
		  close: false
		});
		$('div[tab-id="requests"] .grid').kendoGrid({
		  dataSource: oob.grid._datasource(),
		  selectable: "row",
		  pageable: {
			pageSize: 10
		  },
		  filterable: {
			extra: false,
			operators: {
			  string: {
				startswith: "Starts with",
				contains: "Contains",
				eq: "Is equal to",
				neq: "Is not equal to"
			  }
			}
		  },
		  scrollable: false,
		  columns: oob.grid._columns(),
		  noRecords: {
			template: "<center style='padding: 20px;font-size: 25px;'>No <b>Order Request</b> submissions.</center>"
		  }
		});
		// add grid events
		oob.grid._events.init('div[tab-id="requests"] .grid');
		oob.grid._overview();
	  },
	  _datasource: function() {
		return new kendo.data.DataSource({
		  type: "rfb-v2",
		  transport: {
			read: {
			  url: "/form/data-set-provider/v2/989/NOR_Overview/kendo/data/search",
			  type: "POST"
			}
		  },
		  serverPaging: true,
		  pageSize: 10,
		  serverFiltering: true,
		  filter: oob.grid._filter(),
		  serverSorting: true,
		  sort: {
			field: "Modified",
			dir: "desc"
		  }
		});
	  },
	  _columns: function() {
		// add default columns
		var all = [{
		  field: "EntryId",
		  title: hpe.fn.lang('ID', config.locale, config.localizations),
		  width: "60px",
		  filterable: false
		},

				   {
					 field: "PO_Number",
					 filterable: false,
					 title: hpe.fn.lang('PO', config.locale, config.localizations),
					 width: "100px"
				   },
				   {
					 field: "PartyId",
					 filterable: false,
					 hidden: true,
					 title: hpe.fn.lang('PartyId', config.locale, config.localizations),
					 width: "100px"
				   },
				   {
					 field: "PO_Order_ID",
					 title: hpe.fn.lang('HPEOrder', config.locale, config.localizations),
					 filterable: false,
					 template: function(d) {
					   var elem = "N/A";
					   if (d.PO_Order_ID == "" || d.PO_Order_ID == "N/A")
						 elem = "N/A";
					   else if (/^[7][0-9]*$/.test(d.PO_Order_ID) && d.PO_Order_ID.length == 10)
						 elem = '<a href="https://prp-dxp.it.hpe.com/group/prp/orders?p_p_id=OrderStatusWeb&status=All%20Orders&OrderStatus=All%20Orders&SearchText=' + d.PO_Order_ID + '" target="_blank">' + d.PO_Order_ID + '</a>';
					   else
						 elem = d.PO_Order_ID;

					   return elem;
					 },
					 width: "100px"
				   },
				   {
					 field: "Requestor_Email",
					 title: hpe.fn.lang('Submitter', config.locale, config.localizations),
					 hidden: true,
					 filterable: false,
					 width: "80px",
					 template: function(d) {
					   try {
						 if (d.Requestor_Email.indexOf("@") > -1)
						   elem = '<div title="' + d.Requestor_Email + '"> <a href="mailto:' + d.Requestor_Email + '">email</a></div>';
						 else
						   elem = '<div title="' + d.Requestor_Email + '"> <a href="mailto:' + d.Requestor_Email + '">email</a></div>';
						 return elem;
					   } catch (err) {
						 console.error(err);
						 return "err";
					   }
					 }
				   },

				   {
					 field: "SuccessResult",
					 title: hpe.fn.lang('Form44x1', config.locale, config.localizations),
					 width: "100px",
					 filterable: false,
					 template: function(d) {
					   if (d.SuccessResult) {
						 try {
						   if (JSON.parse(d.SuccessResult).CaseNumber != undefined)
							 return JSON.parse(d.SuccessResult).CaseNumber
						   else return "N/A";
						 } catch (err) {
						   console.error(err);
						   return "N/A";
						 }
					   } else return "N/A";
					 }
				   },

				   {
					 field: "SubmittedTimestamp",
					 title: hpe.fn.lang('Form44x2', config.locale, config.localizations),
					 width: "100px",
					 filterable: false,
					 template: function(d) {
					   if (d.SubmittedTimestamp) {
						 let tmstmp = d.SubmittedTimestamp.split('T')[0] + " " + d.SubmittedTimestamp.split('T')[1]
						 return tmstmp;
					   } else return hpe.fn.lang('Form44x3', config.locale, config.localizations);
					 }
				   },
				   {
					 field: "Status",
					 title: " ",
					 width: "120px",
					 attributes: {
					   "class": "status",
					 },
					 filterable: false,
					 template: function(d) {
					   if (d.Status == "1" || d.Status == "2") elem = '<div class="status" title="' + hpe.fn.lang('SubmittedPOProcessed01', config.locale, config.localizations) + '"> ' + hpe.fn.lang('Form212', config.locale, config.localizations) + '</div>';
					   else if (d.Status == "3") elem = '<div class="status" title="' + hpe.fn.lang('OrderCreated', config.locale, config.localizations) + '">' + hpe.fn.lang('Completed', config.locale, config.localizations) + '</div>';
					   else if (d.Status == "4") elem = '<div class="status" title="' + hpe.fn.lang('ReviewPO', config.locale, config.localizations) + '"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18px" height="16px" viewBox="0 0 22 20" version="1.1"><g id="Orders-v2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Order-Home-7-Days" transform="translate(-783.000000, -528.000000)"><g id="Order-table" transform="translate(168.000000, 120.000000)"><g id="Table" transform="translate(24.000000, 202.000000)"><g id="Table-Rows" transform="translate(1.000000, 48.000000)"><g id="Row4" transform="translate(13.000000, 144.000000)"><g id="Table/Cell-Copy-17" transform="translate(564.000000, 0.000000)"><g id="Icon/Functional/Inactive" transform="translate(12.000000, 12.000000)"><g id="Status-Icon---Warning"><rect id="viewBox" x="0" y="0" width="24" height="24"/><polygon id="Shape" stroke="#FFE75E" stroke-width="2" fill="#FFE75E" stroke-linejoin="round" points="12 3 22 21 2 21"/><path d="M12,9 L12,15 M12,16 L12,18" id="!" stroke="#333333" stroke-width="2" stroke-linejoin="round"/></g></g></g></g></g></g></g></g></g></svg> ' + hpe.fn.lang('Form212', config.locale, config.localizations) + '</div>';
					   else if (d.Status == "5") elem = '<div class="status" title="' + hpe.fn.lang('Form513', config.locale, config.localizations) + '"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18px" height="16px" viewBox="0 0 22 20" version="1.1"><g id="Orders-v2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Order-Home-7-Days" transform="translate(-783.000000, -528.000000)"><g id="Order-table" transform="translate(168.000000, 120.000000)"><g id="Table" transform="translate(24.000000, 202.000000)"><g id="Table-Rows" transform="translate(1.000000, 48.000000)"><g id="Row4" transform="translate(13.000000, 144.000000)"><g id="Table/Cell-Copy-17" transform="translate(564.000000, 0.000000)"><g id="Icon/Functional/Inactive" transform="translate(12.000000, 12.000000)"><g id="Status-Icon---Warning"><rect id="viewBox" x="0" y="0" width="24" height="24"/><polygon id="Shape" stroke="#FFE75E" stroke-width="2" fill="#FFE75E" stroke-linejoin="round" points="12 3 22 21 2 21"/><path d="M12,9 L12,15 M12,16 L12,18" id="!" stroke="#333333" stroke-width="2" stroke-linejoin="round"/></g></g></g></g></g></g></g></g></g></svg> ' + hpe.fn.lang('Form513', config.locale, config.localizations) + '</div>';
					   else if (d.Status == null || d.Status == "0") elem = '<div class="status" title="' + hpe.fn.lang('NoPOSubmitted', config.locale, config.localizations) + '">' + hpe.fn.lang('Form211', config.locale, config.localizations) + '</div>';
					   else elem = hpe.fn.lang('Unknown', config.locale, config.localizations);
					   return elem;
					 }
				   }
				  ];
		// add call to action

		all.push({
		  field: "AvailableActions",
		  title: " ",
		  width: 90,
		  filterable: false,
		  headerAttributes: {
			style: "text-align: right;"
		  },
		  template: function(d) {
			return oob.grid._process.action(d);
		  }
		});

		return all;
	  },
	  _events: {
		init: function(sel) {
		  this._icons(sel);
		},
		_icons: function(sel) {
		  var g = ".grid";
		  $(g).delegate(".view", "click", function(e) {
			var grid = $(g).data("kendoGrid");
			var row = grid.dataItem($(this).closest("tr"));
			mo.fn.overlay.show({
			  loading: true,
			  close: false
			});
			crud.read("3180", "eid=" + row.EntryId, function(d) {
			  mo.fn.overlay.hide();
			  oob.grid._events._view(d.Rows[0]);
			})
		  });
		  $(g).delegate(".edit", "click", function(e) {
			var grid = $(g).data("kendoGrid");
			var row = grid.dataItem($(this).closest("tr"));
			mo.fn.overlay.show({
			  loading: true,
			  close: false
			});
			crud.read("3180", "eid=" + row.EntryId, function(d) {
			  mo.fn.overlay.hide();
			  oob.grid._events._edit(d.Rows[0]);
			})
		  });
		  $(g).delegate(".deactivate", "click", function(e) {
			var grid = $(g).data("kendoGrid");
			var row = grid.dataItem($(this).closest("tr"));
			oob.grid._events._disable(row.EntryId);
		  });
		  $(g).delegate(".clone", "click", function(e) {
			var grid = $(g).data("kendoGrid");
			var row = grid.dataItem($(this).closest("tr"));
			mo.fn.overlay.show({
			  loading: true,
			  close: false
			});
			crud.read("3180", "eid=" + row.EntryId, function(d) {
			  mo.fn.overlay.hide();
			  oob.grid._events._clone(d.Rows[0]);
			})
		  });
		  $(g).delegate(".mailto", "click", function(e) {
			var grid = $(g).data("kendoGrid");
			var row = grid.dataItem($(this).closest("tr"));
			oob.grid._events._mailto(row.Requestor_Email);
		  });
		},
		_edit: function(data) {
		  config.dataset = data;
		  nbsf.init(config, 0);
		  nbsf.init(config, 0);
		  $('.tabs span[tab-id="oob"]').click();
		},
		_view: function(data) {
		  console.log('_view', data);
		  config.dataset = data;
		  nbsf.init(config, config.pages.length - 1);
		  nbsf.init(config, config.pages.length - 1);
		  $('.tabs span[tab-id="oob"]').click();
		},
		_disable: function(eid) {
		  //console.log('_disable', eid);
		  mo.fn.modal.show({
			title: hpe.fn.lang("Form511", config.locale, config.localizations),
			content: "<p>" + hpe.fn.lang("Form512", config.locale, config.localizations).replace('{0}', eid) + "</p>",
			ctaLabel: hpe.fn.lang("OK", config.locale, config.localizations),
			ctaCallback: function() {
			  var refapplication;
			  crud.read("3180", "eid=" + eid, function(data) {
				if (data.Rows.length > 0) {
				  if (data.Rows[0].Status == "0") {
					refapplication = data.Rows[0];
					refapplication.Retired = "Y";
					refapplication.Status = "5";
					mo.fn.overlay.show({
					  loading: true,
					  close: false
					});
					crud.update("3158", eid, refapplication, function(d) {
					  if (typeof(d.EntryId) === "number") {
						crud.c.i("Order record " + d.EntryId + " was successfully updated");
						crud.c.l(refapplication);
						elog('Record canceled in RFB');
					  }
					  oob.grid._overview();
					  $('[tab-id=requests] .grid').data('kendoGrid').dataSource.read();
					  mo.fn.overlay.hide();
					  mo.fn.events.closeAll();
					});
				  } else {
					$('[tab-id=requests] .grid').data('kendoGrid').dataSource.read();

					mo.fn.modal.show({
					  ctaLabel: hpe.fn.lang('OK', config.locale, config.localizations),
					  title: hpe.fn.lang("ErrorGeneric", config.locale, config.localizations),
					  content: '',
					  ctaCallback: function() {
						mo.fn.overlay.hide();
						mo.fn.events.closeAll();
					  }
					});
				  }
				}
			  });
			}

		  });
		},
		_clone: function(data) {
		  //console.log('_clone', data);
		  if (data.EndCx_SysMng_LastName == "NA") data.EndCx_SysMng_LastName = null;
		  if (data.EndCx_SysMng_Email == "NA@IGNOREME.COM") data.EndCx_SysMng_Email = null;

		  let clean = ["EntryId", "Created", "CreatedBy", "Modified", "ModifiedBy", "PO_Number", "PO_Attachment", "Submitted", "SubmittedTimestamp", "PO_Order_ID", "Operations", "CaseReason"];
		  for (i = 0; i < clean.length; i++)
			data[clean[i]] = null;

		  data.Status = 0;
		  data.Clone = true;
		  config.dataset = data;
		  nbsf.init(config, 0);
		  nbsf.init(config, 0);
		  $('.tabs span[tab-id="oob"]').click();
		},
		_mailto: function(Requestor_Email) {
		  console.log('_mailto', Requestor_Email);
		  window.location = "mailto:" + Requestor_Email + "";
		},
		_search: function() {
		  console.log('_search');
		  var search = document.querySelector(".search input");
		  var grid = $(".grid").data("kendoGrid");
		  var dataSource = grid.dataSource;
		  var defaultFilter = oob.grid._filter();
		  if (search.value.length == 0)
			dataSource.filter(defaultFilter);
		  else {
			defaultFilter.filters.push({
			  logic: "or",
			  filters: [{
				field: "EntryId",
				operator: "contains",
				value: search.value
			  },
						{
						  field: "Requestor_Email",
						  operator: "contains",
						  value: search.value
						},
						{
						  field: "PO_Number",
						  operator: "contains",
						  value: search.value
						},
						{
						  field: "PO_Order_ID",
						  operator: "contains",
						  value: search.value
						},
						{
						  field: "SuccessResult",
						  operator: "contains",
						  value: search.value
						},
						{
						  field: "SubmittedTimestamp",
						  operator: "contains",
						  value: search.value
						}
					   ]
			});
			dataSource.filter(defaultFilter);
		  }
		}
	  },
	  /*_filter: function() {
                  return {
                      logic: "and",
                      filters: [{
                              field: "CountryEntity",
                              operator: "eq",
                              value: global.data.company.country
                          }, 
                          {
                              field: "PartnerBRT",
                              operator: "eq",
                              value: global.data.brt.name
                          },
                          {
                              logic: "or",
                              filters: [{
                                      field: "Retired",
                                      operator: "neq",
                                      value: "Y"
                                  },
                                  {
                                      field: "Retired",
                                      operator: "isnull",
                                      value: ""
                                  }
                              ]
                          }
                      ]
                  }
              },*/
	  _filter: function() {
		if ('[SSOData.Email]'.indexOf('@hpe.com') > -1)
		  return {
			logic: "and",
			filters: [{
			  field: "Email",
			  operator: "eq",
			  value: '[SSOData.Email]'
			},
					  {
						logic: "or",
						filters: [{
						  field: "Retired",
						  operator: "neq",
						  value: "Y"
						},
								  {
									field: "Retired",
									operator: "isnull",
									value: ""
								  }
								 ]
					  }
					 ]
		  }
		else
		  return {
			logic: "and",
			filters: [{
			  field: "PartyId",
			  operator: "eq",
			  value: global.data.company.party
			},
					  {
						field: "PartnerBRT",
						operator: "eq",
						value: global.data.brt.name
					  },
					  {
						logic: "or",
						filters: [{
						  field: "Retired",
						  operator: "neq",
						  value: "Y"
						},
								  {
									field: "Retired",
									operator: "isnull",
									value: ""
								  }
								 ]
					  }
					 ]
		  }
	  },
	  _refresh: function() {
		// refresh grid
		$('[tab-id=requests] .grid').data('kendoGrid').dataSource.read();
	  },
	  _process: {
		action: function(data) {
		  //mailto icon
		  var emailtitle = "";
		  if (data.EndCx_CompanyName != null) {
			if (data.EndCx_CompanyName != "")
			  emailtitle = hpe.fn.lang('Form141', config.locale, config.localizations) + ": " + data.EndCx_CompanyName + ", " + hpe.fn.lang('Email', config.locale, config.localizations) + ": " + data.Requestor_Email;
			else
			  emailtitle = hpe.fn.lang('Email', config.locale, config.localizations) + ": " + data.Requestor_Email;
		  } else
			emailtitle = hpe.fn.lang('Email', config.locale, config.localizations) + ": " + data.Requestor_Email;
		  var mailto = '<span title="' + emailtitle + '" style="margin-left: 15px; cursor: pointer" class="mailto" title="' + data.Requestor_Email + '"><svg version="1.1" viewBox="0 0 24 24" role="img" aria-label="user" width="20px" height="20px"><path fill="none" stroke="#666" stroke-width="2" d="M8,24 L8,19 M16,24 L16,19 M3,24 L3,19 C3,14.0294373 7.02943725,11 12,11 C16.9705627,11 21,14.0294373 21,19 L21,24 M12,11 C14.7614237,11 17,8.76142375 17,6 C17,3.23857625 14.7614237,1 12,1 C9.23857625,1 7,3.23857625 7,6 C7,8.76142375 9.23857625,11 12,11 Z"></path></svg></span>';
		  // icon to use at status 0
		  var edit = '<span title="Edit Request" class="edit" style="margin-left: 15px; cursor: pointer"><svg version="1.1" viewBox="0 0 24 24" role="img" aria-label="edit" width="20px" height="20px"><path fill="none" stroke="#666" stroke-width="2" d="M14,4 L20,10 L14,4 Z M22.2942268,5.29422684 C22.6840146,5.68401459 22.6812861,6.3187139 22.2864907,6.71350932 L9,20 L2,22 L4,15 L17.2864907,1.71350932 C17.680551,1.319449 18.3127724,1.31277239 18.7057732,1.70577316 L22.2942268,5.29422684 Z M3,19 L5,21 M7,17 L15,9"></path></svg></span>';
		  // icon to use to view record at the end of the process
		  var view = "<span title='View Request' class='view' style='margin-left: 15px;cursor: pointer;'><svg style='pointer-events: none' version='1.1' viewBox='0 0 24 24' width='20px' height='20px' role='img' aria-label='edit'><path fill='none' stroke='#666' stroke-width='2' d='M12,21 C7,21 1,16 1,12 C1,8 7,3 12,3 C17,3 23,8 23,12 C23,16 17,21 12,21 Z M12,7 C9.23875,7 7,9.23875 7,12 C7,14.76125 9.23875,17 12,17 C14.76125,17 17,14.76125 17,12 C17,9.23875 14.76125,7 12,7 L12,7 Z'></path></svg></span>";
		  // icon to use to download at ?
		  var deactivate = '<span title="Delete Entry" class="deactivate" style="margin-left: 15px; cursor: pointer;"><svg version="1.1" viewBox="0 0 24 24" role="img" aria-label="trash" width="20px" height="20px"><path fill="none" stroke="#666" stroke-width="2" d="M4,5 L20,5 L20,23 L4,23 L4,5 Z M1,5 L23,5 M9,1 L15,1 L15,5 L9,5 L9,1 Z M9,1 L15,1 L15,5 L9,5 L9,1 Z M15,9 L15,19 M9,9 L9,19"></path></svg></span>';
		  var clone = '<span title="Clone Request" class="clone" style="cursor: pointer;"><svg version="1.1" viewBox="0 0 24 24" width="20px" height="20px" role="img" aria-label="clone"><path fill="none" stroke="#666" stroke-width="2" d="M9,15 L17,15 L9,15 Z M9,11 L19,11 L9,11 Z M9,7 L13,7 L9,7 Z M16,1 L16,7 L22,7 M6,5 L2,5 L2,23 L18,23 L18,19 M22,19 L6,19 L6,1 L17,1 L22,6 L22,19 L22,19 Z"></path></svg></span>';
		  // tasks
		  var final = "";

		  var editView = '';

		  if (data.Status == 0 || data.Status == null) {
			editView = edit;
		  } else {
			editView = view;
			deactivate = '';
		  }

		  final = final + clone + editView + mailto + deactivate;

		  return "<div style='text-align: left'>" + final + "</div>";
		}
	  },
	  _overview: function() {
		// OVERVIEW
		var overview = document.querySelector("#overview");
		overview.innerHTML = '<div class="incomplete"><strong></strong><span>' + hpe.fn.lang('Form211', config.locale, config.localizations) + '</span><p>' + hpe.fn.lang('NoOrder', config.locale, config.localizations) + '</p></div>' +
		  '<div class="submitted" style="display:none"><strong></strong><span>' + hpe.fn.lang('Form213', config.locale, config.localizations) + '</span></div>' +
		  '<div class="pending"><strong></strong><span>' + hpe.fn.lang('Form212', config.locale, config.localizations) + '</span><p>' + hpe.fn.lang('SubmittedPOProcessed', config.locale, config.localizations) + '</p></div>' +
		  '<div class="completed"><strong></strong><span>' + hpe.fn.lang('Completed', config.locale, config.localizations) + '</span><p>' + hpe.fn.lang('OrderCreated', config.locale, config.localizations) + '</p></div>' +
		  '<div class="failed" style="display:none"><strong></strong><span>' + hpe.fn.lang('Form214', config.locale, config.localizations) + '</span></div>' +
		  '<span style="display:block;clear:both;"></span>';

		oob.grid._initStats(function(d) {
		  global.requests = d;
		  overview.querySelector(".incomplete strong").innerText = global.requests.incomplete;
		  overview.querySelector(".submitted strong").innerText = global.requests.submitted;
		  overview.querySelector(".pending strong").innerText = global.requests.pending + global.requests.submitted + global.requests.failed;
		  overview.querySelector(".completed strong").innerText = global.requests.completed;
		  overview.querySelector(".failed strong").innerText = global.requests.failed;
		  mo.fn.overlay.hide();
		});
	  },
	  _appStats: {
		incomplete: "",
		submitted: "",
		pending: "",
		completed: "",
		failed: "",
		deleted: ""
	  },
	  _getStats: function(callback) {
		if ("[SSOData.Email]".indexOf('@hpe.com') > -1) {
		  hpe.api.dataset({
			form: '989',
			dataset: 'NOR_STATS_V3_INTERNAL',
			payload: {
			  filter: {
				field: "Email",
				operator: "eq",
				value: "[SSOData.Email]"
			  },
			  take: '1'
			}
		  }, function(d) {
			try {
			  callback(d);
			} catch (e) {
			  console.error(e);
			  callback(false);
			}
		  })
		} else {
		  hpe.api.dataset({
			form: '989',
			dataset: 'NOR_STATS_V3',
			payload: {
			  filter: {
				logic: "or",
				filters: [{
				  logic: "and",
				  filters: [{
					field: "PartyId",
					operator: "eq",
					value: global.data.company.party
				  },
							{
							  field: "PartnerBRT",
							  operator: "eq",
							  value: global.data.brt.name
							}
						   ]
				},
						  {
							logic: "and",
							filters: [{
							  field: "CountryEntity",
							  operator: "eq",
							  value: global.data.company.country
							},
									  {
										field: "PartnerBRT",
										operator: "eq",
										value: global.data.brt.name
									  }
									 ]
						  }
						 ]
			  },
			  take: '1'
			}
		  }, function(d) {
			try {
			  callback(d);
			} catch (e) {
			  console.error(e);
			  callback(false);
			}
		  })
		}
	  },
	  _initStats: function(cb) {
		oob.grid._getStats(function(d) {
		  if (d.Data.length > 0) {
			oob.grid._appStats.completed = d.Data[0].Completed;
			oob.grid._appStats.incomplete = d.Data[0].Draft;
			oob.grid._appStats.submitted = d.Data[0].Submitted;
			oob.grid._appStats.pending = d.Data[0].Pending;
			oob.grid._appStats.failed = d.Data[0].Failed;
			oob.grid._appStats.deleted = d.Data[0].Deleted;
			oob.grid._appStats.total = d.Data[0].Completed + d.Data[0].Draft + d.Data[0].Submitted + d.Data[0].Pending + d.Data[0].Failed + d.Data[0].Deleted
		  } else {
			oob.grid._appStats.completed = 0;
			oob.grid._appStats.incomplete = 0;
			oob.grid._appStats.submitted = 0;
			oob.grid._appStats.pending = 0;
			oob.grid._appStats.failed = 0;
			oob.grid._appStats.deleted = 0;
			oob.grid._appStats.total = 0;
		  }
		  return cb(oob.grid._appStats);
		})
	  }
	}
  }
</script>

<!-- NOR application initialization -->
<script>
  //we call the functions from app object to initiate the landing page.
  //adding the crud dependency in the DOM
  hpe.supplies.crud();
  //adding the mo.js dependency in the DOM
  hpe.supplies.mojs();
  //hpe.supplies.profile();
  //function that is called after all dependencies were loaded
  hpe.supplies.q.end(function() {
	// temporary fix for rendering issue
	// remove after AR country code is not accounted for as Arabic
	//document.querySelector('body').classList = '';

	mo.init();
	mo.fn.overlay.show({
	  loading: true,
	  close: false
	});
	// load application
	crud.q.stop(function() {
	  if (!global.data.user.internal) {
		const myInterval = setInterval(myTimer, 1000);

		function myTimer() {
		  if (global.ready) {
			oob.init();
			myStopFunction()
		  }
		}

		function myStopFunction() {
		  clearInterval(myInterval);
		}
	  } else oob.init();
	})
  });
  hpe.fn.resizeable();
</script>